
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  
  <title>HankLiu的博客小屋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="努力去听风的声音，不必在意风的方向。">
<meta property="og:type" content="website">
<meta property="og:title" content="HankLiu的博客小屋">
<meta property="og:url" content="https://hankliu62.github.io/index.html">
<meta property="og:site_name" content="HankLiu的博客小屋">
<meta property="og:description" content="努力去听风的声音，不必在意风的方向。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="HankLiu">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/img/favicon.ico" sizes="16x16">
  
  <link rel="stylesheet" href="/css/style.css?t=1">
  
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
  

<meta name="generator" content="Hexo 7.1.1"></head>

<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner">
    <div id="banner-mask"></div>
  </div>
  <div id="header-outer" class="outer">
    <nav id="upper-nav" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <div class="sub-nav">
        
        
          <a id="nav-github" class="nav-icon" href="https://github.com/hankliu62"></a>
        
      </div>
    </nav>
    <div id="header-title">
      
        <h1 id="blog-title-wrap">
          <a href="/" id="blog-title">HankLiu的博客小屋</a>
        </h1>
      
      
        <h5 class="blog-subtitle-wrap">努力去听风的声音，不必在意风的方向。</h5>
      
    </div>
    <div id="contenedor">
      <ul class="cube">
        <li class="cara"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="100" width="100" viewBox="-50 -50 200 200">
          <circle cx="50" cy="50" r="45" stroke-width="5" stroke="black" stroke-opacity="0.5" fill-opacity="0"></circle>
          <rect id="clockwise" x="47.5" y="27.5" width="5" height="25" rx="2.5" ry="2.5" fill="black" fill-opacity="0.5" transform="rotate(330 50 50)"></rect>
          <rect id="minute" x="48.5" y="16.5" width="3" height="35" rx="1.5" ry="1.5" fill="black" fill-opacity="0.5"></rect>
        </svg></li>
        <li class="cara">P</li>
        <li class="cara">X</li>
        <li class="cara">L</li>
        <li class="cara">C</li>
        <li class="cara">Y</li>
      </ul>
    </div>
    <nav id="main-nav">
      
        <a class="main-nav-link" href="/">主页</a>
      
        <a class="main-nav-link" href="/archives">文章</a>
      
        <a class="main-nav-link" href="/toolkit">小工具</a>
      
        <a class="main-nav-link" href="/resume">小简介</a>
      
        <a class="main-nav-link" href="/about">小关于</a>
      
    </nav>
  </div>
</header>

    <div class="outer">
      <section id="main">
  
    <article id="post-communication-across-browser-tabs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/20/communication-across-browser-tabs/" class="article-date">
  <time datetime="2024-04-20T20:20:20.000Z" itemprop="datePublished">2024-04-20</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/20/communication-across-browser-tabs/">跨浏览器标签页进行通讯的方式简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="跨浏览器标签页进行通讯的方式简介"><a href="#跨浏览器标签页进行通讯的方式简介" class="headerlink" title="跨浏览器标签页进行通讯的方式简介"></a>跨浏览器标签页进行通讯的方式简介</h2><p>在现代 <code>Web</code> 应用程序中，跨浏览器标签页之间进行通讯是一项重要的功能。无论是在多标签页应用程序中同步状态，还是在不同浏览器窗口之间共享数据，实现跨标签页通讯都是必不可少的。在本文中，我们将探讨跨浏览器标签页进行通讯的各种方式，并详细介绍每种方式的 <code>API</code> 和使用场景。</p>
<h3 id="所有方法"><a href="#所有方法" class="headerlink" title="所有方法"></a>所有方法</h3><ol>
<li>使用 <code>Web Storage API</code></li>
<li>使用 <code>Broadcast Channel API</code></li>
<li>使用 <code>SharedWorker</code></li>
<li>使用 <code>Service Worker</code></li>
<li>使用 <code>WebSocket</code></li>
<li>使用 <code>PostMessage API</code></li>
<li>使用 <code>IndexedDB</code></li>
</ol>
<h3 id="Web-Storage-API"><a href="#Web-Storage-API" class="headerlink" title="Web Storage API"></a>Web Storage API</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Web Storage API</code> 提供了一种在客户端存储数据的方法，包括 <code>localStorage</code> 和 <code>sessionStorage</code> 两种方式。它们可以在不同的浏览器标签页之间共享数据，而不受页面刷新或关闭的影响。</li>
<li><strong>优点</strong>：简单易用，支持持久化存储。</li>
<li><strong>缺点</strong>：只能存储字符串类型的数据，且容量有限。</li>
<li><strong>适用场景</strong>：适合存储小型数据，如用户偏好设置或临时状态。</li>
</ul>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>localStorage</strong>: 保存的数据没有过期时间，可以一直存在于浏览器中。</li>
<li><strong>sessionStorage</strong>: 保存的数据在浏览器会话结束时被清除，适合临时存储数据。</li>
</ul>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在同一浏览器的不同标签页中共享数据。</li>
<li>存储用户首选项或状态信息。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Web Storage Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;saveData()&quot;</span>&gt;</span>Save Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;data&#x27;</span>, input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(data);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;Data changed in another tab: &#x27;</span> + event.<span class="property">newValue</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data from Main Page<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(data);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;Data changed in another tab: &#x27;</span> + event.<span class="property">newValue</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。同时，当一个标签页修改了 localStorage 的值，另一个标签页也会收到通知。</p>
<h3 id="Broadcast-Channel-API"><a href="#Broadcast-Channel-API" class="headerlink" title="Broadcast Channel API"></a>Broadcast Channel API</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Broadcast Channel API</code> 允许在不同的浏览器标签页之间进行实时通信，通过创建一个共享的消息通道来传递数据。</li>
<li><strong>优点</strong>：支持实时通信，消息发送和接收都非常简单。</li>
<li><strong>缺点</strong>：不支持 <code>IE</code> 浏览器。</li>
<li><strong>适用场景</strong>：适合需要实时通讯的场景，如多标签页间的数据同步。</li>
</ul>
<h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>BroadcastChannel</strong>: 创建一个用于跨文档通信的通道。</li>
</ul>
<h4 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同的浏览器标签页之间传递消息。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Broadcast Channel Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="string">&#x27;channel&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            channel.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="string">&#x27;channel&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        channel.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">textContent</span> = event.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="SharedWorker"><a href="#SharedWorker" class="headerlink" title="SharedWorker"></a>SharedWorker</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>SharedWorker</code> 允许在多个浏览器上下文之间共享同一个 <code>Worker</code> 实例，提供了一种全局范围的通讯机制。</li>
<li><strong>优点</strong>：支持多标签页之间的实时通信，可以与所有标签页共享相同的数据。</li>
<li><strong>缺点</strong>：不支持 <code>IE</code> 浏览器。</li>
<li><strong>适用场景</strong>：适合需要共享状态或实现实时通讯的场景。</li>
</ul>
<h4 id="API-2"><a href="#API-2" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>SharedWorker</strong>: 创建一个共享的 <code>Web Worker</code> 实例，可以被多个浏览上下文共享。</li>
</ul>
<h4 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同浏览器标签页之间共享数据或进行通讯。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SharedWorker Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="title class_">SharedWorker</span>(<span class="string">&#x27;worker.js&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            worker.<span class="property">port</span>.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        worker.<span class="property">port</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line"><span class="keyword">const</span> ports = [];</span><br><span class="line"></span><br><span class="line">onconnect = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> port = event.<span class="property">ports</span>[<span class="number">0</span>];</span><br><span class="line">    ports.<span class="title function_">push</span>(port);</span><br><span class="line">    port.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> message = event.<span class="property">data</span>;</span><br><span class="line">        ports.<span class="title function_">forEach</span>(<span class="function"><span class="params">port</span> =&gt;</span> port.<span class="title function_">postMessage</span>(message));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h3><h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Service Worker</code> 是一种在浏览器后台运行的脚本，可以拦截和处理网络请求，并实现离线缓存和推送通知等功能。</li>
<li><strong>优点</strong>：支持后台运行，可以拦截网络请求，实现离线缓存和推送通知。</li>
<li><strong>缺点</strong>：只能用于现代浏览器，且需要 <code>HTTPS</code> 支持。</li>
<li><strong>适用场景</strong>：适合需要离线访问或推送通知的场景，如聊天应用或离线应用。</li>
</ul>
<h4 id="API-3"><a href="#API-3" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>Service Worker</strong>: 在后台运行的脚本，可以拦截和处理网络请求，并进行推送通知等功能。</li>
</ul>
<h4 id="使用场景-3"><a href="#使用场景-3" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同标签页之间共享数据或进行通讯。</li>
<li>实现离线缓存和推送通知。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Service Worker Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 注册 Service Worker</span></span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;sw.js&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 发送消息</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            navigator.<span class="property">serviceWorker</span>.<span class="property">controller</span>.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 监听消息</span></span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">serviceWorker</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> message = event.<span class="property">data</span>;</span><br><span class="line">    clients.<span class="title function_">matchAll</span>().<span class="title function_">then</span>(<span class="function"><span class="params">clients</span> =&gt;</span> &#123;</span><br><span class="line">        clients.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> client.<span class="title function_">postMessage</span>(message));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><h4 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>WebSocket</code> 提供了一种在客户端和服务器之间建立持久连接的方式，实现了双向通信。</li>
<li><strong>优点</strong>：支持双向通信，可以实现实时通讯。</li>
<li><strong>缺点</strong>：需要在服务器端实现 <code>WebSocket</code> 服务，且不支持跨域请求。</li>
<li><strong>适用场景</strong>：适合实时通讯场景，如聊天应用或在线游戏。</li>
</ul>
<h4 id="API-4"><a href="#API-4" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>WebSocket</strong>: 在客户端和服务器之间建立持久连接，实现双向通信。</li>
</ul>
<h4 id="使用场景-4"><a href="#使用场景-4" class="headerlink" title="使用场景"></a>使用场景</h4><p>在不同浏览器标签页之间进行实时通讯。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WebSocket</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wss = <span class="keyword">new</span> <span class="title class_">WebSocket</span>.<span class="title class_">Server</span>(&#123; <span class="attr">port</span>: <span class="number">8080</span> &#125;);</span><br><span class="line"></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="params">ws</span> =&gt;</span> &#123;</span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">message</span> =&gt;</span> &#123;</span><br><span class="line">        wss.<span class="property">clients</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (client !== ws &amp;&amp; client.<span class="property">readyState</span> === <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) &#123;</span><br><span class="line">                client.<span class="title function_">send</span>(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            socket.<span class="title function_">send</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="PostMessage-API"><a href="#PostMessage-API" class="headerlink" title="PostMessage API"></a>PostMessage API</h3><h4 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>PostMessage API</code> 允许跨文档之间安全地传递消息，可以实现跨域通信。</li>
<li><strong>优点</strong>：支持跨域通信，使用简单。</li>
<li><strong>缺点</strong>：需要对接收消息的文档进行信任验证，存在安全风险。</li>
<li><strong>适用场景</strong>：适合不同域名之间的数据交换或通信。</li>
</ul>
<h4 id="API-5"><a href="#API-5" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>window.postMessage()</strong>: 向其他窗口发送消息。</li>
</ul>
<h4 id="使用场景-5"><a href="#使用场景-5" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同窗口之间进行跨域通信。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>PostMessage Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> popup = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;another-page.html&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            popup.<span class="title function_">postMessage</span>(input, <span class="string">&#x27;*&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">textContent</span> = event.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。</p>
<h3 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h3><h4 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>IndexedDB</code> 提供了一个异步的、事务型的数据库，适用于存储大量结构化数据。</li>
<li><strong>优点</strong>：支持存储大量结构化数据，数据存储在客户端本地。</li>
<li><strong>缺点</strong>：使用复杂，需要学习 <code>IndexedDB</code> 的 <code>API</code>。</li>
<li><strong>适用场景</strong>：适合需要存储大量结构化数据的场景，如离线应用或数据分析应用。</li>
</ul>
<h4 id="API-6"><a href="#API-6" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>IndexedDB</strong>: 提供了一个异步的、事务型的数据库。</li>
</ul>
<h4 id="使用场景-6"><a href="#使用场景-6" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>存储大量结构化数据，如离线应用程序的数据。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>IndexedDB Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;saveData()&quot;</span>&gt;</span>Save Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&#x27;myDatabase&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        request.<span class="property">onupgradeneeded</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&#x27;data&#x27;</span>, &#123; <span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = request.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readwrite&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            objectStore.<span class="title function_">add</span>(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">data</span>: input &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = request.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readonly&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> request = objectStore.<span class="title function_">get</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">            request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> data = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data from Main Page<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&#x27;myDatabase&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readonly&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> request = objectStore.<span class="title function_">get</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">                request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> data = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在本文中，我们介绍了跨浏览器标签页进行通讯的多种方式，并提供了详细的 <code>API</code> 和使用场景。根据您的具体需求和项目要求</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/" rel="tag">html5</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/20/communication-across-browser-tabs/" data-id="clvhem3u30005rrq6cked2kpg" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-webrtc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/16/webrtc/" class="article-date">
  <time datetime="2024-04-16T16:16:16.000Z" itemprop="datePublished">2024-04-16</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/16/webrtc/">WebRTC:实时通信的未来</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="WebRTC-实时通信的未来"><a href="#WebRTC-实时通信的未来" class="headerlink" title="WebRTC:实时通信的未来"></a>WebRTC:实时通信的未来</h2><h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>在当今数字化的世界中，实时通信变得越来越重要。从视频会议到在线游戏，从远程医疗到物联网设备，人们希望能够立即与其他人或设备进行交流和互动。<code>WebRTC（Web Real-Time Communication）</code> 技术的出现填补了这一需求，为Web应用程序提供了强大的实时通信能力。本文将深入探讨 <code>WebRTC</code> 技术的原理、应用场景以及实现细节，带您了解这一引人注目的技术。</p>
<h3 id="什么是WebRTC？"><a href="#什么是WebRTC？" class="headerlink" title="什么是WebRTC？"></a>什么是WebRTC？</h3><p><code>WebRTC</code> 是一种开放标准的实时通信技术，允许浏览器之间进行点对点的音频、视频和数据传输，而无需任何插件或附加软件。它是由Google、Mozilla和Opera等公司发起的一个开放源代码项目，旨在为Web应用程序提供实时通信的能力。</p>
<h3 id="WebRTC的核心特性"><a href="#WebRTC的核心特性" class="headerlink" title="WebRTC的核心特性"></a>WebRTC的核心特性</h3><ol>
<li><p>实时性<br><code>WebRTC</code> 提供了实时的音频和视频传输能力，使用户可以在几乎没有延迟的情况下进行实时通信。这种实时性对于视频会议、在线教育和远程医疗等应用非常重要。</p>
</li>
<li><p>安全性<br><code>WebRTC</code> 通过使用加密技术来保护通信内容的安全性。它使用 <code>DTLS（Datagram Transport Layer Security）</code>协议来保护数据传输的隐私，并使用 <code>SRTP（Secure Real-time Transport Protocol）</code>协议来加密音频和视频数据。</p>
</li>
<li><p>去中心化<br><code>WebRTC</code> 采用了点对点（<code>P2P</code>）通信模型，即浏览器之间直接进行通信，而不需要经过中间服务器。这种去中心化的通信方式可以提高通信的效率，并减少了对服务器资源的依赖。</p>
</li>
<li><p>跨平台<br><code>WebRTC</code> 可以在各种平台上运行，包括桌面浏览器、移动浏览器和原生应用程序。这使得开发人员可以轻松地创建跨平台的实时通信应用程序。</p>
</li>
</ol>
<h3 id="WebRTC的工作原理"><a href="#WebRTC的工作原理" class="headerlink" title="WebRTC的工作原理"></a>WebRTC的工作原理</h3><p><code>WebRTC（Web Real-Time Communication）</code> 是一项用于实现浏览器之间实时通信的开放标准技术。它允许在不需要额外插件的情况下，通过浏览器直接进行音频、视频和数据传输。<code>WebRTC</code> 技术的出现，极大地促进了在线会议、远程教育、视频直播等领域的发展。下面将深入探讨 <code>WebRTC</code> 的核心技术，包括<strong>媒体获取</strong>、<strong>媒体传输</strong>、<strong>信令交换</strong>以及<strong>NAT穿越</strong>等方面，并结合详细的例子进行说明。</p>
<h4 id="媒体获取（Media-Acquisition）"><a href="#媒体获取（Media-Acquisition）" class="headerlink" title="媒体获取（Media Acquisition）"></a>媒体获取（Media Acquisition）</h4><p>WebRTC 的媒体获取主要涉及使用 <code>getUserMedia</code> <code>API</code> 来获取用户的音频和视频数据。这个 <code>API</code> 允许我们从用户的摄像头和麦克风中获取实时的媒体流，并将其用于后续的处理和传输。</p>
<h5 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">stream</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取到用户的音视频流</span></span><br><span class="line">    <span class="keyword">const</span> videoElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;localVideo&#x27;</span>);</span><br><span class="line">    videoElement.<span class="property">srcObject</span> = stream;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取用户媒体设备失败：&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h5><p>上面的代码演示了如何使用 <code>getUserMedia API</code> 获取用户的音视频流，并将其绑定到一个 <code>&lt;video&gt;</code> 元素上进行实时预览。通过这种方式，我们可以轻松地在浏览器中获取用户的音视频数据，为后续的通信做准备。</p>
<h4 id="媒体传输（Media-Transmission）"><a href="#媒体传输（Media-Transmission）" class="headerlink" title="媒体传输（Media Transmission）"></a>媒体传输（Media Transmission）</h4><p><code>WebRTC</code> 的媒体传输主要涉及使用 <code>RTCPeerConnection</code> 建立点对点的连接，并将音视频数据传输给其他对等方。这个过程涉及到 <code>ICE</code> 候选、会话描述等技术，以确保数据能够安全、高效地传输。</p>
<h5 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个RTCPeerConnection对象</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加ICE候选</span></span><br><span class="line">peerConnection.<span class="property">onicecandidate</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">    <span class="comment">// 发送ICE候选给对方</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加本地流</span></span><br><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">stream</span>) =&gt;</span> &#123;</span><br><span class="line">    stream.<span class="title function_">getTracks</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">track</span>) =&gt;</span> &#123;</span><br><span class="line">      peerConnection.<span class="title function_">addTrack</span>(track, stream);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Offer</span></span><br><span class="line">peerConnection.<span class="title function_">createOffer</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">offer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> peerConnection.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 将Offer发送给对方</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;创建Offer失败：&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h5 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h5><p>上面的代码演示了如何使用 <code>RTCPeerConnection</code> 建立点对点连接，并将本地的音视频流添加到连接中。然后，通过创建一个<code>Offer</code>，并将其发送给对方，以发起一个通信会话。在这个过程中，我们还需要处理 <code>ICE</code> 候选，以便在连接过程中进行 <code>NAT</code> 穿越。</p>
<h4 id="信令交换（Signaling）"><a href="#信令交换（Signaling）" class="headerlink" title="信令交换（Signaling）"></a>信令交换（Signaling）</h4><p><code>WebRTC</code> 的信令交换主要涉及将会话描述、<code>ICE</code> 候选等元数据信息交换给其他对等方，以建立和管理通信会话。这个过程通常需要借助于信令服务器来协调客户端之间的消息传递。</p>
<h5 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立WebSocket连接</span></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听WebSocket消息</span></span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(event.<span class="property">data</span>);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;offer&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 收到对方的Offer</span></span><br><span class="line">    peerConnection.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(message))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 创建并发送Answer</span></span><br><span class="line">        <span class="keyword">return</span> peerConnection.<span class="title function_">createAnswer</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> peerConnection.<span class="title function_">setLocalDescription</span>(answer);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 将Answer发送给对方</span></span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;处理Offer失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;answer&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 收到对方的Answer</span></span><br><span class="line">    peerConnection.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(message))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功建立通信连接！&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;处理Answer失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;candidate&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 收到ICE候选</span></span><br><span class="line">    peerConnection.<span class="title function_">addIceCandidate</span>(<span class="keyword">new</span> <span class="title class_">RTCIceCandidate</span>(message.<span class="property">candidate</span>))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功添加ICE候选！&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;添加ICE候选失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h5 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h5><p>上面的代码演示了如何使用 <code>WebSocket</code> 进行信令交换。客户端通过 <code>WebSocket</code> 连接到信令服务器，并监听来自服务器的消息。当收到对方发送的 <code>Offer</code>、<code>Answer</code> 或 <code>ICE</code> 候选时，客户端需要相应地处理并执行相应的操作，以建立和管理通信会话。</p>
<h4 id="NAT穿越（NAT-Traversal）"><a href="#NAT穿越（NAT-Traversal）" class="headerlink" title="NAT穿越（NAT Traversal）"></a>NAT穿越（NAT Traversal）</h4><p><code>NAT（Network Address Translation）</code> 穿越是指在 <code>NAT</code> 环境下，通过一系列的技术手段实现两个位于私有网络中的计算机或设备之间的直接通信。<code>WebRTC</code> 通过使用 <code>STUN</code> 和 <code>TURN</code> 服务器来实现 <code>NAT</code> 穿越，以确保在各种网络环境下都能够正常进行实时通信。</p>
<h5 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置ICE服务器</span></span><br><span class="line"><span class="keyword">const</span> configuration = &#123;</span><br><span class="line">  <span class="attr">iceServers</span>: [</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;stun:stun.l.google.com:19302&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;turn:your-turn-server.com&#x27;</span>, <span class="attr">username</span>: <span class="string">&#x27;username&#x27;</span>, <span class="attr">credential</span>: <span class="string">&#x27;password&#x27;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建RTCPeerConnection对象</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(configuration);</span><br></pre></td></tr></table></figure>

<h5 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h5><p>上面的代码示例中，我们通过配置 <code>ICE</code> 服务器来实现 <code>NAT</code> 穿越。其中，<code>STUN</code> 服务器用于获取公网 <code>IP</code> 地址和端口，而 <code>TURN</code> 服务器则用于在无法直接通信的情况下进行中转。通过合理配置 <code>ICE</code> 服务器，我们可以在不同的网络环境中都能够顺利地进行实时通信。</p>
<h3 id="WebRTC的应用场景"><a href="#WebRTC的应用场景" class="headerlink" title="WebRTC的应用场景"></a>WebRTC的应用场景</h3><p><code>WebRTC</code> 技术已经被广泛应用于多个领域，包括：</p>
<ol>
<li><p>视频会议<br><code>WebRTC</code> 使得在网页浏览器中进行高清视频会议成为可能，用户可以通过浏览器直接加入会议室，与其他参与者进行实时视频通话。</p>
</li>
<li><p>在线教育<br>教育机构可以利用 <code>WebRTC</code> 技术搭建在线教育平台，让老师和学生之间进行实时的远程教学，实现互动和教学资源共享。</p>
</li>
<li><p>社交应用<br>社交应用程序可以利用 <code>WebRTC</code> 技术实现实时语音和视频通话功能，让用户之间进行更加直观和自然的交流。</p>
</li>
<li><p>远程医疗<br>医疗机构可以利用 <code>WebRTC</code> 技术搭建远程医疗平台，实现医生和患者之间的远程会诊和医疗服务，提高医疗资源的利用效率。</p>
</li>
</ol>
<h3 id="WebRTC的未来发展趋势"><a href="#WebRTC的未来发展趋势" class="headerlink" title="WebRTC的未来发展趋势"></a>WebRTC的未来发展趋势</h3><p>随着实时通信需求的不断增加，<code>WebRTC</code> 技术也在不断发展和完善。未来，我们可以期待以下几个方面的发展趋势：</p>
<ol>
<li><p>网络性能的提升<br>随着网络基础设施的不断改善和网络带宽的增加，<code>WebRTC</code> 技术将能够实现更高质量、更稳定的实时通信体验。</p>
</li>
<li><p>新的应用场景<br>随着 <code>WebRTC</code> 技术的成熟和普及，我们可以预见到它将被应用于更多领域，如工业控制、智能家居和虚拟现实等。</p>
</li>
<li><p>标准化和开放性<br><code>WebRTC</code> 作为一个开放标准的实时通信技术，将继续推动标准化工作的进行，以确保不同厂商和平台之间的互操作性和兼容性。</p>
</li>
<li><p>安全性和隐私保护<br>随着个人隐私和数据安全意识的提高，<code>WebRTC</code> 技术将会加强对通信内容的加密和隐私保护，以确保用户数据的安全性。</p>
</li>
</ol>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><code>WebRTC</code> 技术的出现为实时通信应用提供了强大的支持，使得开发者可以轻松构建具有高质量和稳定性的实时通信应用。随着技术的不断发展和完善，我们有理由相信 <code>WebRTC</code> 将会在未来的数字化世界中扮演越来越重要的角色，为用户带来更丰富、更便捷的通信体验。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webrtc/" rel="tag">webrtc</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/16/webrtc/" data-id="clvhem3vc004jrrq66vlo86xf" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-fontend-optimize-indicators" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/14/fontend-optimize-indicators/" class="article-date">
  <time datetime="2024-04-14T12:12:12.000Z" itemprop="datePublished">2024-04-14</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/14/fontend-optimize-indicators/">Web前端最新优化指标：从FP到FPS的全面解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="Web前端最新优化指标：从FP到FPS的全面解析"><a href="#Web前端最新优化指标：从FP到FPS的全面解析" class="headerlink" title="Web前端最新优化指标：从FP到FPS的全面解析"></a>Web前端最新优化指标：从FP到FPS的全面解析</h2><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>在当今互联网时代，Web前端性能优化是网站开发中至关重要的一环。随着技术的不断发展，出现了一系列新的性能指标，如<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等。本文将深入探讨这些最新的Web前端优化指标，详细介绍获取和优化的方法，并提供丰富的实例和技巧，帮助开发者全面了解和应用于实践中。</p>
<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>随着Web技术的不断发展，用户对网页加载速度和性能的要求越来越高。为了提供更好的用户体验，出现了一系列新的Web前端优化指标，如<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等。本文将深入探讨这些指标的含义、获取方法以及优化技巧，帮助开发者更好地理解和应用于实践中。</p>
<h3 id="DOMContentLoaded-事件"><a href="#DOMContentLoaded-事件" class="headerlink" title="DOMContentLoaded 事件"></a>DOMContentLoaded 事件</h3><p><code>DOMContentLoaded</code> 事件，当 <code>HTML</code> 文档被完全加载和解析完成之后，<code>DOMContentLoaded</code> 事件被触发，无需等待样式表、图像和子框架的完成加载。</p>
<h4 id="获取-DOMContentLoaded-事件的方法："><a href="#获取-DOMContentLoaded-事件的方法：" class="headerlink" title="获取 DOMContentLoaded 事件的方法："></a>获取 DOMContentLoaded 事件的方法：</h4><p>通过监听 <code>document</code> 对象上的 <code>DOMContentLoaded</code> 事件获得：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<h4 id="DOMContentLoaded-事件持续时间"><a href="#DOMContentLoaded-事件持续时间" class="headerlink" title="DOMContentLoaded 事件持续时间"></a>DOMContentLoaded 事件持续时间</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>DOMContentLoaded</code> 事件的开始和结束时间，如<code>performance.timing.domContentLoadedEventEnd</code>和<code>performance.timing.domContentLoadedEventStart</code>，两者相差就为持续时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算规则</span></span><br><span class="line"><span class="keyword">const</span> dclTime = performance.<span class="property">timing</span>.<span class="property">domContentLoadedEventEnd</span> - performance.<span class="property">timing</span>.<span class="property">domContentLoadedEventStart</span></span><br></pre></td></tr></table></figure>

<h3 id="load-事件"><a href="#load-事件" class="headerlink" title="load 事件"></a>load 事件</h3><p><code>load</code> 事件，当页面中依赖的所有资源：DOM、图片、CSS、Flash、javascript 等都加载完后，执行完后会在 <code>window</code> 对象上触发对应的事件，</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><code>window.onload</code> 注册的回调就会在 <code>load</code> 事件触发时候被调用，或者通过 <code>window.addEventListener</code> 来进行监听。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<h4 id="load-事件持续时间"><a href="#load-事件持续时间" class="headerlink" title="load 事件持续时间"></a>load 事件持续时间</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>load</code> 事件的开始和结束时间，如<code>performance.timing.loadEventEnd</code>和<code>performance.timing.loadEventStart</code>，两者相差就为持续时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadTime = performance.<span class="property">timing</span>.<span class="property">loadEventEnd</span> - performance.<span class="property">timing</span>.<span class="property">loadEventStart</span>;</span><br></pre></td></tr></table></figure>

<h3 id="FP（First-Paint）"><a href="#FP（First-Paint）" class="headerlink" title="FP（First Paint）"></a>FP（First Paint）</h3><p>FP是指浏览器首次将像素呈现到屏幕上的时间点，即首次绘制。它标志着页面开始加载的时间，但并不表示页面内容已经完全可见。下面是获取和优化FP的方法：</p>
<h4 id="获取FP的方法："><a href="#获取FP的方法：" class="headerlink" title="获取FP的方法："></a>获取FP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FP时间，如<code>performance.timing.navigationStart</code>和<code>performance.getEntriesByType(&#39;paint&#39;)</code>等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FP时间</span></span><br><span class="line"><span class="keyword">const</span> entries = performance.<span class="title function_">getEntriesByType</span>(<span class="string">&#x27;paint&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">  <span class="comment">// 首次渲染</span></span><br><span class="line">  <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// FP开始时间</span></span><br><span class="line">    <span class="keyword">const</span> fpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FP时间：&quot;</span>, fpTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FP（First-Paint）持续时间"><a href="#FP（First-Paint）持续时间" class="headerlink" title="FP（First Paint）持续时间"></a>FP（First Paint）持续时间</h4><p>FP持续时间是指从页面开始加载到首次绘制内容到屏幕上的时间间隔。可以通过 <code>PerformanceObserver</code> 对象，通过监听 <code>paint</code> 类型来获取，还能获得 <code>FP（First Paint）</code> 所花费的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// 首次渲染</span></span><br><span class="line">    <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// FP开始时间</span></span><br><span class="line">      <span class="keyword">const</span> fpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">      <span class="comment">// 持续时间</span></span><br><span class="line">      <span class="keyword">const</span> duration = entry.<span class="property">duration</span>;</span><br><span class="line">      <span class="comment">// FP结束时间</span></span><br><span class="line">      <span class="keyword">const</span> fpDurationTime = fpTime + duration;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FP持续时间：&quot;</span>, fpDurationTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FP的方法："><a href="#优化FP的方法：" class="headerlink" title="优化FP的方法："></a>优化FP的方法：</h4><p>优化FP可以通过减少页面加载时间和优化渲染流程来实现。例如，通过合并和压缩CSS、JavaScript文件，减少网络请求次数和文件大小，以加快页面加载速度。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 合并和压缩CSS文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 合并和压缩JavaScript文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;scripts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="FCP（First-Contentful-Paint）"><a href="#FCP（First-Contentful-Paint）" class="headerlink" title="FCP（First Contentful Paint）"></a>FCP（First Contentful Paint）</h3><p>FCP是指浏览器首次绘制来自DOM的内容的时间点，即首次内容绘制。它表示页面开始显示内容的时间，但并不表示所有内容都已加载完毕。下面是获取和优化FCP的方法：</p>
<h4 id="获取FCP的方法："><a href="#获取FCP的方法：" class="headerlink" title="获取FCP的方法："></a>获取FCP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FCP时间，如 <code>performance.timing.navigationStart</code> 和 <code>performance.timing.getEntriesByType(&#39;paint&#39;)</code> 等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FP时间</span></span><br><span class="line"><span class="keyword">const</span> entries = performance.<span class="title function_">getEntriesByType</span>(<span class="string">&#x27;paint&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">  <span class="comment">// 首次渲染</span></span><br><span class="line">  <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-contentful-paint&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// FCP开始时间</span></span><br><span class="line">    <span class="keyword">const</span> fcpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FCP时间：&quot;</span>, fcpTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FCP（First-Contentful-Paint）持续时间"><a href="#FCP（First-Contentful-Paint）持续时间" class="headerlink" title="FCP（First Contentful Paint）持续时间"></a>FCP（First Contentful Paint）持续时间</h4><p>FCP持续时间是指从页面开始加载到首次绘制来自DOM的内容的时间间隔。可以通过 <code>PerformanceObserver</code> 对象，通过监听 <code>paint</code> 类型来获取，还能获得 <code>FCP（First Contentful Paint）</code> 所花费的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FCP时间</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// 首次渲染</span></span><br><span class="line">    <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-contentful-paint&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// FCP开始时间</span></span><br><span class="line">      <span class="keyword">const</span> fcpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">      <span class="comment">// 持续时间</span></span><br><span class="line">      <span class="keyword">const</span> duration = entry.<span class="property">duration</span>;</span><br><span class="line">      <span class="comment">// FCP持续时间</span></span><br><span class="line">      <span class="keyword">const</span> fcpDurationTime = fcpTime + duration;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FCP持续时间：&quot;</span>, fcpDurationTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FCP的方法："><a href="#优化FCP的方法：" class="headerlink" title="优化FCP的方法："></a>优化FCP的方法：</h4><p>优化FCP可以通过减少关键资源的加载时间和优化关键路径资源来实现。例如，通过预加载关键资源、懒加载技术和延迟加载非关键资源等。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 预加载关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;critical.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 懒加载非关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;placeholder.jpg&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="FMP（First-Meaningful-Paint）"><a href="#FMP（First-Meaningful-Paint）" class="headerlink" title="FMP（First Meaningful Paint）"></a>FMP（First Meaningful Paint）</h3><p>FMP是指浏览器首次绘制页面主要内容的时间点，即首次有意义的绘制。它表示用户认为页面已经有用的时间点。下面是获取和优化FMP的方法：</p>
<h4 id="获取FMP的方法："><a href="#获取FMP的方法：" class="headerlink" title="获取FMP的方法："></a>获取FMP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FMP时间，如 <code>PerformanceObserver</code> 接口监听 <code>paint</code> 事件，判断首次有意义的绘制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FMP计算比较复杂，lighthouse的计算的大体思路是，将页面中最大布局变化后的第一次渲染事件作为FMP事件，并且计算中考虑到了可视区的因素。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FMP计算过于复杂，没有现成的performance API，如果希望在监控中上报这个指标，可以自己使用MutationObserver计算。</span></span><br></pre></td></tr></table></figure>

<h4 id="FMP（First-Meaningful-Paint）持续时间"><a href="#FMP（First-Meaningful-Paint）持续时间" class="headerlink" title="FMP（First Meaningful Paint）持续时间"></a>FMP（First Meaningful Paint）持续时间</h4><p>FMP持续时间是指从页面开始加载到首次绘制页面主要内容的时间间隔。可以通过监测FMP事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FMP计算过于复杂，没有现成的performance API，如果希望在监控中上报这个指标，可以自己使用MutationObserver计算。</span></span><br></pre></td></tr></table></figure>

<h4 id="优化FMP的方法："><a href="#优化FMP的方法：" class="headerlink" title="优化FMP的方法："></a>优化FMP的方法：</h4><p>优化FMP可以通过减少关键资源的加载时间和提高关键路径资源加载速度来实现。例如，使用HTTP&#x2F;2多路复用和服务器推送技术，以及使用CDN加速关键资源加载。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用CDN加速关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.example.com/scripts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="LCP（Largest-Contentful-Paint）"><a href="#LCP（Largest-Contentful-Paint）" class="headerlink" title="LCP（Largest Contentful Paint）"></a>LCP（Largest Contentful Paint）</h3><p>LCP是指浏览器在视觉上渲染的最大内容元素的时间点，即最大内容渲染时间点。它衡量的是页面主要内容加载完成的时间点。下面是获取和优化LCP的方法：</p>
<h4 id="获取LCP的方法："><a href="#获取LCP的方法：" class="headerlink" title="获取LCP的方法："></a>获取LCP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>LCP</code> 时间，如 <code>PerformanceObserver</code> 接口监听 <code>largest-contentful-paint</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听LCP事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> lcpTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LCP时间：&quot;</span>, lcpTime);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;largest-contentful-paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="LCP（Largest-Contentful-Paint）持续时间"><a href="#LCP（Largest-Contentful-Paint）持续时间" class="headerlink" title="LCP（Largest Contentful Paint）持续时间"></a>LCP（Largest Contentful Paint）持续时间</h4><p>LCP持续时间是指从页面开始加载到最大内容元素被渲染完成的时间间隔。可以通过监测LCP事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 计算最大的内容</span></span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>().<span class="title function_">sort</span>(<span class="function">(<span class="params">pre, next</span>) =&gt;</span> next.<span class="property">size</span> - pre.<span class="property">size</span>);</span><br><span class="line">  <span class="comment">// LCP开始事件</span></span><br><span class="line">  <span class="keyword">const</span> lcpTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="comment">// 持续时间</span></span><br><span class="line">  <span class="keyword">const</span> duration = entries[<span class="number">0</span>].<span class="property">duration</span>;</span><br><span class="line">  <span class="comment">// FCP持续时间</span></span><br><span class="line">  <span class="keyword">const</span> lcpDuration = lcpTime + duration;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;LCP持续时间：&#x27;</span>, lcpDuration);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;largest-contentful-paint&#x27;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化LCP的方法："><a href="#优化LCP的方法：" class="headerlink" title="优化LCP的方法："></a>优化LCP的方法：</h4><p>优化LCP可以通过优化关键路径资源的加载顺序和减少页面主要内容的渲染时间来实现。例如，使用懒加载技术延迟加载非关键内容，以及减少渲染阻塞资源的加载。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用懒加载延迟加载非关键内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;placeholder.jpg&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="TTI（Time-to-Interactive）"><a href="#TTI（Time-to-Interactive）" class="headerlink" title="TTI（Time to Interactive）"></a>TTI（Time to Interactive）</h3><p>TTI是指页面变得可交互的时间点，即用户可以与页面进行交互的时间点。它是衡量页面可用性的重要指标。下面是获取和优化TTI的方法：</p>
<h4 id="获取TTI的方法："><a href="#获取TTI的方法：" class="headerlink" title="获取TTI的方法："></a>获取TTI的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取TTI时间，通过 <code>performance.timing.domInteractive</code> 和 <code>performance.timing.fetchStart</code> 的时间差来获得。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听TTI事件</span></span><br><span class="line"><span class="keyword">const</span> timeToInteractive = performance.<span class="property">timing</span>.<span class="property">domInteractive</span> - performance.<span class="property">timing</span>.<span class="property">fetchStart</span>;</span><br></pre></td></tr></table></figure>

<h4 id="优化TTI的方法："><a href="#优化TTI的方法：" class="headerlink" title="优化TTI的方法："></a>优化TTI的方法：</h4><p>优化TTI可以通过减少主线程阻塞时间和延迟加载非关键资源来实现。例如，通过减少JavaScript执行时间、使用服务端渲染技术和懒加载技术等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用懒加载延迟加载非关键资源</span></span><br><span class="line"><span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">image.<span class="property">src</span> = <span class="string">&quot;image.jpg&quot;</span>;</span><br><span class="line">image.<span class="property">loading</span> = <span class="string">&quot;lazy&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(image);</span><br></pre></td></tr></table></figure>

<h3 id="CLS（Cumulative-Layout-Shift）"><a href="#CLS（Cumulative-Layout-Shift）" class="headerlink" title="CLS（Cumulative Layout Shift）"></a>CLS（Cumulative Layout Shift）</h3><p>CLS是指页面在加载过程中发生的所有不良布局变化的总和，即累积布局偏移。它衡量的是页面的视觉稳定性。发生的每次布局变化中的最大幅度的布局变化得分的指标。为了提供良好的用户体验，站点应该努力使 CLS 分数达到 <strong>0.1</strong> 或更低。下面是获取和优化CLS的方法：</p>
<h4 id="获取CLS的方法："><a href="#获取CLS的方法：" class="headerlink" title="获取CLS的方法："></a>获取CLS的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取CLS值，如 <code>PerformanceObserver</code> 接口监听 <code>layout-shift</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听CLS事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> clsValue = entries.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, entry</span>) =&gt;</span> acc + entry.<span class="property">value</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CLS值：&quot;</span>, clsValue);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;layout-shift&quot;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="CLS（Cumulative-Layout-Shift）持续时间"><a href="#CLS（Cumulative-Layout-Shift）持续时间" class="headerlink" title="CLS（Cumulative Layout Shift）持续时间"></a>CLS（Cumulative Layout Shift）持续时间</h4><p>CLS持续时间是指在页面加载过程中发生的所有布局变化的总和。可以通过监测CLS事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">let</span> clsValue = <span class="number">0</span>;</span><br><span class="line">  entries.<span class="title function_">forEach</span>(<span class="function">(<span class="params">entry</span>) =&gt;</span> &#123;</span><br><span class="line">    clsValue += entry.<span class="property">value</span>;</span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="keyword">const</span> startTime = performance.<span class="property">timing</span>.<span class="property">navigationStart</span>;</span><br><span class="line">  <span class="keyword">const</span> clsDuration = clsValue - startTime;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;CLS持续时间：&#x27;</span>, clsDuration);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;layout-shift&#x27;</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化CLS的方法："><a href="#优化CLS的方法：" class="headerlink" title="优化CLS的方法："></a>优化CLS的方法：</h4><p>优化CLS可以通过避免页面元素的不稳定布局和动态元素的尺寸变化来实现。例如，指定图片和媒体元素的尺寸、避免动态插入内容导致页面布局变化等。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 指定图片和媒体元素的尺寸 */</span></span><br><span class="line"><span class="selector-tag">img</span>, <span class="selector-tag">video</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FID（First-Input-Delay）"><a href="#FID（First-Input-Delay）" class="headerlink" title="FID（First Input Delay）"></a>FID（First Input Delay）</h3><p>FID是指用户首次与页面交互到浏览器响应交互的时间间隔，即首次输入延迟。它衡量的是页面的交互性能。</p>
<p>第一次输入延迟，用于测量可交互性。FID 衡量的是从用户第一次与页面交互（例如，当他们点击链接，点击按钮，或使用自定义的 JavaScript 驱动的控件）到浏览器实际能够开始响应该交互的时间，为了提供良好的用户体验，站点应该努力使 FID 保持在 <strong>100</strong> 毫秒以内。</p>
<p>下面是获取和优化FID的方法：</p>
<h4 id="获取FID的方法："><a href="#获取FID的方法：" class="headerlink" title="获取FID的方法："></a>获取FID的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FID值，如 <code>PerformanceObserver</code> 接口监听 <code>first-input</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听FID事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> fidTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FID值：&quot;</span>, fidTime);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;first-input&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="FID（First-Input-Delay）结束时间"><a href="#FID（First-Input-Delay）结束时间" class="headerlink" title="FID（First Input Delay）结束时间"></a>FID（First Input Delay）结束时间</h4><p>FID持续时间是指从用户首次与页面交互到浏览器响应交互的时间间隔。可以通过监测FID事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听FID事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="comment">// fid开始时间</span></span><br><span class="line">  <span class="keyword">const</span> fidTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="comment">// 持续时间</span></span><br><span class="line">  <span class="keyword">const</span> duration = entries[<span class="number">0</span>].<span class="property">duration</span>;</span><br><span class="line">  <span class="comment">// fid结束时间</span></span><br><span class="line">  <span class="keyword">const</span> fidDurationTime = fidTime + duration;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FID结束时间：&quot;</span>, fidDurationTime);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;first-input&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FID的方法："><a href="#优化FID的方法：" class="headerlink" title="优化FID的方法："></a>优化FID的方法：</h4><p>优化FID可以通过减少主线程阻塞时间和优化JavaScript执行时间来实现。例如，减少长任务的执行时间、优化事件处理程序的性能等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 优化事件处理程序的性能</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;button&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行优化后的代码</span></span><br><span class="line">&#125;, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="FPS（Frames-per-Second）"><a href="#FPS（Frames-per-Second）" class="headerlink" title="FPS（Frames per Second）"></a>FPS（Frames per Second）</h3><p>FPS是指页面在每秒钟内渲染的帧数，即每秒钟刷新的次数。它衡量的是页面的流畅度和动画效果。下面是获取和优化FPS的方法：</p>
<h4 id="获取FPS的方法："><a href="#获取FPS的方法：" class="headerlink" title="获取FPS的方法："></a>获取FPS的方法：</h4><p>可以通过浏览器的性能监控工具或第三方工具来获取页面的FPS值，如 <code>Chrome DevTools</code> 或 <code>WebPageTest</code> 等。</p>
<h4 id="FPS（Frames-per-Second）持续时间"><a href="#FPS（Frames-per-Second）持续时间" class="headerlink" title="FPS（Frames per Second）持续时间"></a>FPS（Frames per Second）持续时间</h4><p>FPS持续时间是指页面在每秒内渲染的帧数。可以通过监测页面的渲染性能并计算平均帧率来获取。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用requestAnimationFrame来监测FPS</span></span><br><span class="line"><span class="keyword">let</span> fps = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> lastTime = performance.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> currentTime = performance.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">const</span> elapsedTime = currentTime - lastTime;</span><br><span class="line">  fps = <span class="number">1000</span> / elapsedTime;</span><br><span class="line">  lastTime = currentTime;</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(loop);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loop</span>();</span><br></pre></td></tr></table></figure>

<h4 id="优化FPS的方法："><a href="#优化FPS的方法：" class="headerlink" title="优化FPS的方法："></a>优化FPS的方法：</h4><p>优化FPS可以通过减少页面渲染的复杂度和优化动画效果来实现。例如，使用CSS3动画代替JavaScript动画、避免频繁的重绘和重排等。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用CSS3动画 */</span></span><br><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: slide-in <span class="number">1s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> slide-in &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>); &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文详细介绍了Web前端最新优化指标，包括<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等，并提供了获取和优化的方法和实例。这些指标不仅帮助开发者更好地评估和优化网页性能，也有助于提升用户体验和网站竞争力。我们可以参考这些指标对网站的性能进行相关的优化。优化是一把双刃剑，有好的一面也有坏的一面，请谨慎优化。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/optimize/" rel="tag">optimize</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/14/fontend-optimize-indicators/" data-id="clvhem3u40008rrq6d68890i0" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-abort-controller" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/12/abort-controller/" class="article-date">
  <time datetime="2024-04-12T10:00:00.000Z" itemprop="datePublished">2024-04-12</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/12/abort-controller/">使用 AbortController 实现异步操作控制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-AbortController-实现异步操作控制"><a href="#使用-AbortController-实现异步操作控制" class="headerlink" title="使用 AbortController 实现异步操作控制"></a>使用 AbortController 实现异步操作控制</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在 <code>JavaScript</code> 中，我们经常需要执行一些异步操作，例如发起网络请求、执行定时任务等。然而，有时候我们希望能够在某些条件下中止这些异步操作，以节省资源或提高用户体验。这时候，<code>AbortController</code> 就派上了用场。</p>
<p><code>AbortController</code> 是一个可以用来控制异步操作的对象，它可以与 <code>Promise</code>、<code>Fetch API</code> 等配合使用，实现在异步操作进行中中止操作的功能。本文将介绍 <code>AbortController</code> 的基本用法，并提供详细的示例来说明其在实际场景中的应用。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p><code>AbortController</code> 提供了两个主要的方法：<code>abort()</code> 和 <code>signal</code> 属性。</p>
<ul>
<li><strong>abort()</strong>: 调用该方法可以中止与 <code>AbortController</code> 相关联的异步操作。</li>
<li><strong>signal</strong>: 这是一个只读属性，它返回一个 <code>AbortSignal</code> 对象，用于监听异步操作的中止状态。<br>下面是一个基本的示例：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听中止信号</span></span><br><span class="line">signal.<span class="title function_">addEventListener</span>(<span class="string">&#x27;abort&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Operation aborted&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5秒后中止操作</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并从中获取了 <code>signal</code> 属性。然后，我们通过 <code>setTimeout()</code> 函数设定了一个 <code>5</code> 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止操作。同时，我们通过 <code>signal.addEventListener()</code> 方法监听了中止信号，并在中止时输出了一条日志。</p>
<h3 id="结合-Fetch-API"><a href="#结合-Fetch-API" class="headerlink" title="结合 Fetch API"></a>结合 Fetch API</h3><p><code>AbortController</code> 最常见的用法之一是与 <code>Fetch API</code> 结合使用，实现中止网络请求的功能。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, &#123; signal &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request aborted&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10秒后中止请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并将其与 <code>Fetch API</code> 中的 <code>signal</code> 属性关联起来。然后，我们发起了一个网络请求，当请求完成时输出了返回的数据，如果请求被中止，则捕获到 <code>AbortError</code> 并输出一条相应的日志。最后，我们设置了一个 10 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止网络请求。</p>
<h3 id="结合-Promise"><a href="#结合-Promise" class="headerlink" title="结合 Promise"></a>结合 Promise</h3><p>除了与 <code>Fetch API</code> 结合使用外，<code>AbortController</code> 还可以与 <code>Promise</code> 结合使用，实现中止 <code>Promise</code> 执行的功能。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">signal</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (signal.<span class="property">aborted</span>) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">DOMException</span>(<span class="string">&#x27;AbortError&#x27;</span>, <span class="string">&#x27;AbortError&#x27;</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;Data fetched successfully&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(signal)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Operation aborted&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5秒后中止操作</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们定义了一个 <code>fetchData()</code> 函数，该函数返回一个 <code>Promise</code> 对象，在一定时间后返回数据或者中止操作。然后，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并将其与 <code>Promise</code> 关联起来。最后，我们设置了一个 <code>5</code> 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止 <code>Promise</code> 执行。</p>
<h3 id="Axios-请求通过-CancelToken-来取消请求"><a href="#Axios-请求通过-CancelToken-来取消请求" class="headerlink" title="Axios 请求通过 CancelToken 来取消请求"></a>Axios 请求通过 CancelToken 来取消请求</h3><p><code>Axios</code> 自带有取消请求的借口，在 <code>Axios</code> 中通过 <code>CancelToken</code> 取消请求发送。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/ 引入 <span class="title class_">Axios</span> 库</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 CancelToken.source 对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CancelToken</span>, axiosInstance &#125; = axios;</span><br><span class="line"><span class="keyword">const</span> source = <span class="title class_">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 Axios 请求</span></span><br><span class="line"><span class="keyword">const</span> request = axiosInstance.<span class="title function_">get</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: source.<span class="property">token</span> <span class="comment">// 传递 CancelToken 对象到请求配置中</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个定时器，在 3 秒后取消请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  source.<span class="title function_">cancel</span>(<span class="string">&#x27;Request canceled due to timeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起请求并处理响应</span></span><br><span class="line">request.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Response:&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request canceled:&#x27;</span>, error.<span class="property">message</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们首先引入 <code>Axios</code> 库，并创建了一个 <code>CancelToken.source</code> 对象 <code>source</code>。然后，我们发起一个 <code>GET</code> 请求，并在请求配置中传递了 <code>cancelToken: source.token</code>，以便 <code>Axios</code> 知道我们要使用哪个 <code>CancelToken</code> 来取消请求。</p>
<p>接着，我们设置了一个定时器，在 <code>3</code> 秒后调用 <code>source.cancel()</code> 方法取消请求，并传递了一个取消原因。最后，我们发起请求，并在 <code>.then()</code> 和 <code>.catch()</code> 方法中分别处理响应和错误。如果请求被取消，我们通过 <code>axios.isCancel(error)</code> 来检查错误类型，并输出相应的日志。</p>
<h3 id="XMLHttpRequest-通过-abort-来取消请求"><a href="#XMLHttpRequest-通过-abort-来取消请求" class="headerlink" title="XMLHttpRequest 通过 abort 来取消请求"></a>XMLHttpRequest 通过 abort 来取消请求</h3><p>在现代浏览器环境中，我们可以使用 <code>XMLHttpRequest（XHR）</code> 对象来发起网络请求，<code>XHR</code> 里面存在 <code>abort</code> 能用来取消这些请求。以下是一个使用XHR取消请求的示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个XHR对象</span></span><br><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听请求状态变化</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 请求完成并且响应状态为200时，处理响应</span></span><br><span class="line">  <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="title class_">XMLHttpRequest</span>.<span class="property">DONE</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Response:&#x27;</span>, xhr.<span class="property">responseText</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备发送请求，但不发送</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://api.example.com/data&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个定时器，在3秒后取消请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  xhr.<span class="title function_">abort</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request canceled&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们首先创建了一个 <code>XMLHttpRequest</code> 对象 <code>xhr</code>，并设置了它的 <code>onreadystatechange</code> 事件处理程序来监听请求状态变化。然后，我们调用 <code>xhr.open()</code> 方法来准备发送一个 <code>GET</code> 请求到指定的 <code>URL</code>，但并不发送请求。接着，我们调用 <code>xhr.send()</code> 方法来实际发送请求。</p>
<p>同时，我们设置了一个定时器，在3秒后调用 <code>xhr.abort()</code> 方法来取消请求。当调用 <code>xhr.abort()</code> 方法时，<code>XHR</code> 对象将会立即终止当前的网络请求。</p>
<p>最后，当请求完成并且响应状态为 <code>200</code> 时，我们通过 <code>xhr.responseText</code> 属性获取响应数据，并输出到控制台。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p><code>AbortController</code> 是一个非常有用的工具，它为我们提供了在异步操作进行中中止操作的能力。通过结合 <code>Fetch API</code>、<code>Promise</code> 等，我们可以在网络请求、定时任务等场景中灵活地使用 <code>AbortController</code>，从而提高代码的可控性和可靠性。希望本文的介绍能够帮助你更好地理解和应用 <code>AbortController</code>。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/" rel="tag">html5</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/12/abort-controller/" data-id="clvhem3tu0000rrq665rghvia" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-optimize-miniprogram" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/10/optimize-miniprogram/" class="article-date">
  <time datetime="2024-04-10T08:50:26.000Z" itemprop="datePublished">2024-04-10</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/10/optimize-miniprogram/">小程序性能优化实践指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="小程序性能优化实践指南"><a href="#小程序性能优化实践指南" class="headerlink" title="小程序性能优化实践指南"></a>小程序性能优化实践指南</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着移动互联网的发展，小程序已经成为了许多企业和开发者的首选平台之一。然而，随着小程序功能的不断丰富和用户需求的增加，小程序的性能优化变得愈发重要。本文将介绍一些常见的小程序性能优化实践，并提供详细的例子来说明如何在实际项目中进行优化。</p>
<h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><p>小程序（或微信小程序）的性能优化是确保小程序在用户设备上以流畅、快速的方式运行的重要方面之一。以下是一些常见的小程序性能指标：</p>
<h4 id="LoadPackage"><a href="#LoadPackage" class="headerlink" title="LoadPackage"></a>LoadPackage</h4><p>指小程序代码包下载阶段。在此阶段，小程序需要从服务器下载代码包以执行后续的逻辑。代码包大小和下载速度会影响小程序的启动性能。</p>
<p>获取方式： 可通过网络监控工具或浏览器开发者工具查看网络请求的时间和代码包大小等信息。</p>
<h4 id="First-Paint-FP"><a href="#First-Paint-FP" class="headerlink" title="First Paint (FP)"></a>First Paint (FP)</h4><p>页面首次绘制是浏览器开始将内容呈现在屏幕上的时间点。此时用户无法与页面交互，但首次绘制仍可显示部分内容，向用户展示页面正在加载。</p>
<p>获取方式： 通过浏览器性能分析工具或 <code>Performance API</code> 来捕获此事件，并了解页面渲染启动时间。</p>
<h4 id="First-Contentful-Paint-FCP"><a href="#First-Contentful-Paint-FCP" class="headerlink" title="First Contentful Paint (FCP)"></a>First Contentful Paint (FCP)</h4><p>页面的第一个内容块被绘制到屏幕上的时间点。用户可以看到页面的某些部分，但是页面尚未完全加载。</p>
<p>获取方式： 通过 <code>Chrome DevTools</code> 的 <code>Performance</code> 面板或 <code>Lighthouse</code> 等工具可以获取该指标。</p>
<h4 id="First-Meaningful-Paint-FMP"><a href="#First-Meaningful-Paint-FMP" class="headerlink" title="First Meaningful Paint (FMP)"></a>First Meaningful Paint (FMP)</h4><p>用户认为有用内容被展示在屏幕上的时间点。FMP 更准确地反映用户感知到的页面加载速度，因为它考虑了页面加载时的实际内容。</p>
<p>获取方式： 通过用户体验监控工具、<code>Web Vitals</code> 库或<code>Chrome User Experience Report</code> 等方式可以收集数据并分析用户感知到的页面加载速度。</p>
<h4 id="Largest-Contentful-Paint-LCP"><a href="#Largest-Contentful-Paint-LCP" class="headerlink" title="Largest Contentful Paint (LCP)"></a>Largest Contentful Paint (LCP)</h4><p>页面中最大的内容元素（如图片、文本等）被绘制到屏幕上且变得可见的时间点。<code>LCP</code> 是衡量用户认为页面已可交互的重要指标之一，优化 <code>LCP</code> 可提升用户体验和页面加载速度。</p>
<p>获取方式： 通过 <code>Chrome DevTools</code> 的 <code>Performance</code> 面板、<code>Web Vitals</code> 库或 <code>PageSpeed Insights</code> 等工具来获取和分析 <code>LCP</code> 数据。</p>
<p>这些指标参数是小程序性能优化的重要参考，通过监控和优化这些参数，可以提升小程序的性能，提升用户体验。</p>
<h3 id="具体措施"><a href="#具体措施" class="headerlink" title="具体措施"></a>具体措施</h3><h4 id="图片优化"><a href="#图片优化" class="headerlink" title="图片优化"></a>图片优化</h4><p>图片是小程序中常见的资源，但过多或未经优化的图片会增加页面加载时间和用户流量消耗。以下是一些图片优化的实践：</p>
<p><strong>使用适当的图片格式：</strong></p>
<ul>
<li><code>JPEG</code> 格式适合照片和渐变色图片。</li>
<li><code>PNG</code> 格式适合图标和带有透明背景的图片。</li>
<li><code>WebP</code> 格式是一种新的图片格式，具有更好的压缩率和质量，但需要注意兼容性。</li>
</ul>
<p><strong>压缩图片大小：</strong></p>
<ul>
<li>使用工具如 <code>TinyPNG</code>、<code>ImageOptim</code> 等对图片进行压缩，减小图片文件大小。</li>
<li>避免在小程序中直接使用大图，尽量将图片压缩至合适的尺寸。</li>
</ul>
<p><strong>懒加载图片：</strong></p>
<ul>
<li>当页面中存在大量图片时，可以使用懒加载技术，延迟加载图片，减少页面加载时间。</li>
<li>通过小程序的 <code>wx.createIntersectionObserver()</code> 方法监听图片元素是否进入视窗，然后动态加载图片。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 示例：图片懒加载</span></span><br><span class="line"><span class="keyword">const</span> observer = wx.<span class="title function_">createIntersectionObserver</span>();</span><br><span class="line">observer.<span class="title function_">relativeToViewport</span>().<span class="title function_">observe</span>(<span class="string">&#x27;.lazy-img&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">intersectionRatio</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> lazyImg = res.<span class="property">dataset</span>.<span class="property">lazyImg</span>;</span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">imgUrl</span>: lazyImg</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 停止观察</span></span><br><span class="line">    observer.<span class="title function_">disconnect</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="数据缓存和请求优化"><a href="#数据缓存和请求优化" class="headerlink" title="数据缓存和请求优化"></a>数据缓存和请求优化</h4><p>小程序中频繁的网络请求会增加用户等待时间和服务器负载，因此优化数据请求和缓存是提升小程序性能的关键。</p>
<p><strong>使用缓存：</strong></p>
<ul>
<li>对于频繁使用的数据，可以使用小程序的本地缓存功能，如 <code>wx.setStorageSync()</code> 和 <code>wx.getStorageSync()</code>，将数据存储在本地缓存中，减少网络请求。</li>
<li>对于需要实时更新的数据，可以设置合适的缓存过期时间，避免数据过期而导致的不一致性。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：数据缓存</span></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;userData&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> data = wx.<span class="title function_">getStorageSync</span>(key);</span><br><span class="line"><span class="keyword">if</span> (data) &#123;</span><br><span class="line">  <span class="comment">// 从缓存中获取数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data from cache:&#x27;</span>, data);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 发起网络请求获取数据</span></span><br><span class="line">  wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/user&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> userData = res.<span class="property">data</span>;</span><br><span class="line">      <span class="comment">// 将数据存入缓存</span></span><br><span class="line">      wx.<span class="title function_">setStorageSync</span>(key, userData);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data from network:&#x27;</span>, userData);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>合并请求：</strong></p>
<ul>
<li>尽量减少网络请求的次数，可以将多个请求合并为一个请求，减少请求的重复和消耗。</li>
<li>使用小程序的 <code>wx.request()</code> 方法发送请求，并通过 <code>Promise.all()</code> 方法等待所有请求完成。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：合并请求</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data1&#x27;</span> &#125;),</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data2&#x27;</span> &#125;),</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data3&#x27;</span> &#125;)</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function">(<span class="params">[res1, res2, res3]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 1:&#x27;</span>, res1.<span class="property">data</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 2:&#x27;</span>, res2.<span class="property">data</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 3:&#x27;</span>, res3.<span class="property">data</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="页面渲染优化"><a href="#页面渲染优化" class="headerlink" title="页面渲染优化"></a>页面渲染优化</h4><p>页面渲染是影响用户体验的重要因素，优化页面渲染可以提高小程序的性能和流畅度。</p>
<p><strong>使用 WXML 和 WXSS：</strong></p>
<ul>
<li>尽量避免使用复杂的 <code>HTML</code> 和 <code>CSS</code> 样式，可以使用小程序的 <code>WXML</code> 和 <code>WXSS</code> 实现相同的效果，减少页面渲染时间。</li>
<li>避免使用嵌套过深的结构，尽量保持页面结构简洁。</li>
</ul>
<p><strong>减少 DOM 操作：</strong></p>
<ul>
<li>减少在页面渲染过程中对 <code>DOM</code> 的操作，例如频繁的节点添加、删除和更新。</li>
<li>使用小程序的数据绑定功能，在数据变化时自动更新页面，避免手动操作 <code>DOM</code>。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：数据绑定</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 更新页面数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">userInfo</span>: res.<span class="property">userInfo</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="代码包体积优化"><a href="#代码包体积优化" class="headerlink" title="代码包体积优化"></a>代码包体积优化</h4><p>当小程序项目过大时，可以将不同功能模块分包加载，按需加载页面和资源，减少初始化时间和页面首次加载时间。</p>
<h5 id="分包策略"><a href="#分包策略" class="headerlink" title="分包策略"></a>分包策略</h5><p>独立分包允许小程序页面独立运行，无需依赖主包或其他分包。当从独立分包页面进入小程序时，用户无需等待主包下载，从而显著提升了启动速度。</p>
<ul>
<li><strong>主包</strong>：包含小程序的初始启动逻辑、基础框架和一些常用页面等内容。用户打开小程序时会首先下载主包。</li>
<li><strong>分包</strong>：除了主包以外的其他代码包，每个分包可以包含若干个页面或组件。分包相对独立于主包运行，可以根据业务逻辑将相关页面或组件划分到不同的分包中。</li>
</ul>
<h5 id="分包异步化"><a href="#分包异步化" class="headerlink" title="分包异步化"></a>分包异步化</h5><p>分包异步化进一步细化了小程序的分包粒度，从页面级别深入到组件甚至文件级别。这使得原本只能放在主包内的部分插件、组件和代码逻辑得以剥离到分包中，并在运行时异步加载。这一技术有效解决了主包过度膨胀的问题，进一步降低了启动时的代码加载量。</p>
<p><strong>app.json 配置：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;subpackages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/goods/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;goods&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p><strong>动态引入：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">loadSubPackage</span>(&#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="string">&#x27;pages/goods/&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="comment">// 分包加载成功后的回调</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="comment">// 分包加载失败处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="分包预下载机制"><a href="#分包预下载机制" class="headerlink" title="分包预下载机制"></a>分包预下载机制</h5><p>尽管分包加载能够提升启动速度，但当用户跳转到分包内页面时，仍需等待分包下载，这可能导致页面切换的延迟。为解决这一问题，需要引入了分包预下载机制。该机制允许小程序在后台预先下载分包，确保用户在首次进入分包页面时无需等待下载，从而提升了页面切换的流畅性。</p>
<p><strong>预下载原理：</strong></p>
<p>分包预下载机制利用小程序框架的预加载能力，在用户打开小程序时提前加载分包资源，使得当用户需要访问对应分包页面时，可以更快地展示内容，减少加载等待时间。</p>
<p>预下载机制通常会在主包的某些关键页面或事件触发时开始执行，提前下载分包所需的资源文件，如 <code>JS</code>、<code>CSS</code>、图片等。</p>
<p><strong>实现步骤：</strong></p>
<ul>
<li><p><code>识别关键页面</code>：需要确定哪些页面是用户经常访问的重要页面，这些页面通常会被定义为关键页面，可以考虑在这些页面触发时启动预下载机制。</p>
</li>
<li><p><code>触发预下载</code>：在合适的时机，例如用户打开小程序时或进入关键页面时，调用相应的预下载函数或方法，开始下载分包资源。</p>
</li>
<li><p><code>资源加载</code>：下载完成后，将分包资源缓存至本地，以便在用户访问分包页面时直接使用已下载的资源，避免重新下载。</p>
</li>
</ul>
<p><strong>实际项目场景：</strong></p>
<ul>
<li><p><code>图片密集页面</code>：对于包含大量图片的分包页面（如相册、产品展示页），通过预下载图片资源可以提高用户体验。</p>
</li>
<li><p><code>复杂交互页面</code>：对于交互复杂的分包页面（如地图、视频播放页），提前加载相关组件和数据能够加快页面展示速度。</p>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>小程序性能优化是一个持续改进的过程，通过合理的设计和优化，可以提高小程序的用户体验和性能表现。本文介绍了一些常见的小程序性能优化实践，包括图片优化、数据缓存和请求优化、页面渲染优化等方面的内容，并提供了详细的示例来说明如何在实际项目中进行优化。希望本文能够帮助开发者更好地优化自己的小程序项目，提升用户满意度和使用体验。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/miniprogram/" rel="tag">miniprogram</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/optimize/" rel="tag">optimize</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/10/optimize-miniprogram/" data-id="clvhem3ue000xrrq6dck6af2y" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-action-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/08/github-action-docker/" class="article-date">
  <time datetime="2024-04-08T13:38:20.000Z" itemprop="datePublished">2024-04-08</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/08/github-action-docker/">使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-GitHub-Actions-自动化部署-Nuxt3-应用到-Docker-容器中"><a href="#使用-GitHub-Actions-自动化部署-Nuxt3-应用到-Docker-容器中" class="headerlink" title="使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中"></a>使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>在当今的软件开发中，自动化部署是提高生产效率和保证代码质量的关键步骤之一。<code>GitHub Actions</code> 是一个强大的持续集成和持续部署工具，而 <code>Docker</code> 则提供了一种轻量级、可移植的容器化解决方案。本文将介绍如何结合 <code>GitHub Actions</code> 和 <code>Docker</code>，自动化部署一个基于 <code>Nuxt.js 3</code> 的应用到 <code>Docker</code> 容器中。</p>
<h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>在开始之前，请确保您已经具备以下环境和工具：</p>
<ul>
<li>一个 <code>GitHub</code> 账号，并且在该账号下创建了一个仓库用于存放您的 <code>Nuxt.js 3</code> 项目。</li>
<li>一个 <code>Docker Hub</code> 账号，用于存放您的 <code>Docker</code> 镜像。</li>
<li>安装了 <code>Docker</code> 和 <code>Docker Compose</code> 的开发环境。</li>
</ul>
<h4 id="步骤一：准备-Nuxt-js-3-项目"><a href="#步骤一：准备-Nuxt-js-3-项目" class="headerlink" title="步骤一：准备 Nuxt.js 3 项目"></a>步骤一：准备 Nuxt.js 3 项目</h4><p>首先，您需要有一个基于 <code>Nuxt.js 3</code> 的项目。如果还没有，可以通过以下命令创建一个新的 <code>Nuxt.js 3</code> 项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Copy code</span><br><span class="line">npx create-nuxt-app@latest my-nuxt-app</span><br></pre></td></tr></table></figure>

<p>按照提示选择项目配置，然后进入项目目录。</p>
<h4 id="步骤二：编写-Dockerfile"><a href="#步骤二：编写-Dockerfile" class="headerlink" title="步骤二：编写 Dockerfile"></a>步骤二：编写 Dockerfile</h4><p>接下来，我们需要创建一个 <code>Dockerfile</code> 文件，用于构建 <code>Docker</code> 镜像。在项目根目录下创建一个名为 <code>Dockerfile</code> 的文件，并添加以下内容：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 Node 18 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 package.json 和 package-lock.json 到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝源代码到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建应用</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Nginx 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 Nuxt.js 应用到 Nginx 静态文件目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/dist /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露 80 端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Nginx</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>该 <code>Dockerfile</code> 文件中定义了两个阶段的构建过程。第一阶段使用 <code>Node 14</code> 作为基础镜像，用于构建 <code>Nuxt.js</code> 应用；第二阶段使用 <code>Nginx</code> 作为基础镜像，用于运行 <code>Nuxt.js</code> 应用。</p>
<h3 id="步骤三：编写-Docker-Compose-文件"><a href="#步骤三：编写-Docker-Compose-文件" class="headerlink" title="步骤三：编写 Docker Compose 文件"></a>步骤三：编写 <code>Docker Compose</code> 文件</h3><p>为了简化 <code>Docker</code> 容器的管理，我们可以使用 <code>Docker Compose</code> 来定义和运行多个容器。在项目根目录下创建一个名为 <code>docker-compose.yml</code> 的文件，并添加以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;3000:80&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NODE_ENV=production</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>

<p>该 <code>Docker Compose</code> 文件定义了一个名为 <code>app</code> 的服务，使用了刚才编写的 <code>Dockerfile</code> 来构建镜像，并将容器的 <code>80</code> 端口映射到宿主机的 <code>3000</code> 端口。另外，设置了 NODE_ENV 环境变量为 <code>production</code>，并且设置容器始终在退出时重新启动。</p>
<h4 id="步骤四：配置-GitHub-Actions"><a href="#步骤四：配置-GitHub-Actions" class="headerlink" title="步骤四：配置 GitHub Actions"></a>步骤四：配置 GitHub Actions</h4><p>接下来，我们将配置 <code>GitHub Actions</code>，使其在每次推送代码到仓库时自动构建并部署应用到 <code>Docker</code> 容器中。</p>
<p>在项目根目录下创建一个名为 <code>.github/workflows</code> 的目录，并在该目录下创建一个名为 <code>deploy.yml</code> 的文件，并添加以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">Docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v1</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Log</span> <span class="string">in</span> <span class="string">to</span> <span class="string">Docker</span> <span class="string">Hub</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_USERNAME</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span> <span class="string">Docker</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">file:</span> <span class="string">./Dockerfile</span></span><br><span class="line">          <span class="attr">push:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_USERNAME</span> <span class="string">&#125;&#125;/my-nuxt-app:latest</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">Docker</span> <span class="string">Compose</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">appleboy/ssh-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">host:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_HOST</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_USERNAME</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">script:</span> <span class="string">docker-compose</span> <span class="string">pull</span> <span class="string">&amp;&amp;</span> <span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure>

<p>该 <code>GitHub Actions</code> 配置文件定义了一个名为 <code>Deploy to Docker</code> 的工作流，在代码推送到 <code>master</code> 分支时触发。它包含了以下几个步骤：</p>
<ul>
<li>检出仓库代码。</li>
<li>设置 <code>Docker Buildx</code>，以便支持多平台构建。</li>
<li>登录到 <code>Docker Hub</code>。</li>
<li>构建并推送 <code>Docker</code> 镜像到 <code>Docker Hub</code>。</li>
<li>使用 <code>SSH</code> 连接到部署目标主机，并执行 <code>docker-compose pull</code> 和 <code>docker-compose up -d</code> 命令来更新容器。</li>
</ul>
<h4 id="步骤五：配置-Secrets"><a href="#步骤五：配置-Secrets" class="headerlink" title="步骤五：配置 Secrets"></a>步骤五：配置 Secrets</h4><p>为了安全地管理敏感信息，如 <code>Docker Hub</code> 和部署目标主机的凭据，我们需要在 <code>GitHub</code> 仓库的 <code>Settings -&gt; Secrets</code> 页面中添加这些凭据。</p>
<p>添加以下凭据：</p>
<ul>
<li><strong>DOCKER_USERNAME</strong>: 您的 <code>Docker Hub</code> 用户名。</li>
<li><strong>DOCKER_PASSWORD</strong>: 您的 <code>Docker Hub</code> 密码或访问令牌。</li>
<li><strong>SSH_HOST</strong>: 部署目标主机的 <code>IP</code> 地址或域名。</li>
<li><strong>SSH_USERNAME</strong>: 部署目标主机的用户名。</li>
<li><strong>SSH_PRIVATE_KEY</strong>: <code>SSH</code> 私钥，用于与部署目标主机建立安全连接。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>通过结合 <code>GitHub Actions</code>、<code>Docker</code> 和 <code>Docker Compose</code>，我们成功实现了一个自动化部署流程，可以在每次代码更新时自动构建并部署 <code>Nuxt.js 3</code> 应用到 <code>Docker</code> 容器中。这种自动化流程可以大大提高开发团队的生产效率，并且确保了部署的一致性和可靠性。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/08/github-action-docker/" data-id="clvhem3u6000brrq63qf3cn7j" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-action-publish-package" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/06/github-action-publish-package/" class="article-date">
  <time datetime="2024-04-06T20:22:20.000Z" itemprop="datePublished">2024-04-06</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/06/github-action-publish-package/">使用 GitHub Action 实现自动化发布 npm 包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-GitHub-Action-实现自动化发布-npm-包"><a href="#使用-GitHub-Action-实现自动化发布-npm-包" class="headerlink" title="使用 GitHub Action 实现自动化发布 npm 包"></a>使用 GitHub Action 实现自动化发布 npm 包</h2><p>在开发 <code>JavaScript</code> 应用程序或库时，发布到 <code>npm</code> 上是一种常见的方式来分享和分发你的代码。手动发布 <code>npm</code> 包可能会变得繁琐和容易出错，因此自动化这个过程是非常有帮助的。</p>
<p><code>GitHub Actions</code> 是一个功能强大的工具，它可以帮助你实现自动化发布 <code>npm</code> 包的流程。在本文中，我们将学习如何使用 <code>GitHub Action</code> 实现自动化发布 <code>npm</code> 包的步骤。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li>确保你有一个 <a href="https://www.npmjs.com/"><code>npm</code> 账号</a>，并且已经登录到 <code>npm</code>。</li>
<li>创建一个 <code>GitHub</code> 仓库用于存储你的 <code>npm</code> 包的代码。</li>
</ol>
<h3 id="设置-GitHub-Action"><a href="#设置-GitHub-Action" class="headerlink" title="设置 GitHub Action"></a>设置 GitHub Action</h3><ol>
<li>在你的 GitHub 仓库中，创建一个名为 <code>.github/workflows/npm-publish.yml</code> 的文件，用于存储 GitHub Action 的配置。</li>
<li>在 <code>npm-publish.yml</code> 中添加以下内容：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Publish</span> <span class="string">to</span> <span class="string">npm</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="comment"># 触发ci/cd的代码分支</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="comment"># 指定操作系统</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># 将代码拉到虚拟机</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">获取源码</span> <span class="string">🛎️</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># 指定node版本</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Node环境版本</span> <span class="string">🗜️</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">18</span></span><br><span class="line">          <span class="attr">registry-url:</span> <span class="string">&#x27;https://registry.npmjs.org&#x27;</span></span><br><span class="line">      <span class="comment"># 依赖缓存策略</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Npm缓存</span> <span class="string">📁</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">cache-dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            **/node_modules</span></span><br><span class="line"><span class="string"></span>          <span class="attr">key:</span> <span class="string">$&#123;&#123;runner.OS&#125;&#125;-$&#123;&#123;hashFiles(&#x27;**/package-lock.json&#x27;)&#125;&#125;</span></span><br><span class="line">      <span class="comment"># 依赖下载</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装依赖</span> <span class="string">📦</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">steps.cache-dependencies.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="comment"># 打包</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">打包</span> <span class="string">🏗️</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="comment"># 测试</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">测试</span> <span class="string">💣</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">test</span></span><br><span class="line">      <span class="comment"># 发布</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">发布</span> <span class="string">🚀</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">publish</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">NPM_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.NPM_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="申请-npm-访问令牌"><a href="#申请-npm-访问令牌" class="headerlink" title="申请 npm 访问令牌"></a>申请 npm 访问令牌</h3><ol>
<li>登录 <code>npm</code> 官网，登录成功后，点开右上角头像，并点击 <code>Access Tokens</code> 选项。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/2b9ae517-3e57-417a-a00d-d9721a25c4c1" alt="image"></p>
<ol start="2">
<li>点开 <code>Generate New Token</code> 下拉框，点击 <code>Classic Token</code> 选项。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/b7bdbfd5-4a5f-483c-a795-08bb29d8f35e" alt="image"></p>
<ol start="3">
<li>创建一个名称为 <code>GITHUB_PUBLISH_TOKEN</code> 的令牌，并选择 <code>publish 发布</code>权限。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/922f2bca-5b37-4863-acd4-121e75e4388a" alt="image"></p>
<ol start="4">
<li>复制新生成的访问令牌。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/0eef68e5-8adf-483e-90dc-94ac12a45db9" alt="image"></p>
<h3 id="配置-npm-访问令牌"><a href="#配置-npm-访问令牌" class="headerlink" title="配置 npm 访问令牌"></a>配置 npm 访问令牌</h3><ol>
<li>进入项目仓库，点击仓库tab选项卡的 <code>Settings</code> ，点开 <code>Secrets and variables</code> 选项卡，点击 <code>Actions</code> 选项，点击对应页面的 <code>&quot;New repository secret&quot;</code> 按钮。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/6d4b0fd4-5f03-4ffc-a464-115a66ebfdcd" alt="image"></p>
<ol start="2">
<li>新建名称为 <code>NPM_TOKEN</code>的 <code>secret</code>, 并将刚刚申请到的<code>GITHUB_PUBLISH_TOKEN</code>填入 <code>secret</code> 字段。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/09de4a85-e1b9-4a10-98e5-1cf8bf2aec9e" alt="image"></p>
<h3 id="发布-npm-包"><a href="#发布-npm-包" class="headerlink" title="发布 npm 包"></a>发布 npm 包</h3><ol>
<li>在你的代码中做任何更改。</li>
<li>提交这些更改并创建一个新的 <code>Release</code>。</li>
<li><code>GitHub Action</code> 将自动触发并自动构建、测试和发布你的 <code>npm</code> 包。</li>
</ol>
<p>通过以上步骤，你已经成功地设置了 <code>GitHub Action</code> 来实现自动化发布 <code>npm</code> 包的流程。现在，每当你创建一个新的 <code>Release</code>，你的代码将自动发布到 <code>npm</code> 上，让你的开发流程更加高效和方便。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/06/github-action-publish-package/" data-id="clvhem3u6000crrq6c5pm9xb1" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-homebrew" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/04/homebrew/" class="article-date">
  <time datetime="2024-04-04T13:56:26.000Z" itemprop="datePublished">2024-04-04</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/04/homebrew/">MacOS 和 Linux 的 Homebrew 安装与卸载</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="MacOS-和-Linux-的-Homebrew-安装与卸载"><a href="#MacOS-和-Linux-的-Homebrew-安装与卸载" class="headerlink" title="MacOS 和 Linux 的 Homebrew 安装与卸载"></a>MacOS 和 Linux 的 Homebrew 安装与卸载</h2><h3 id="Homebrew"><a href="#Homebrew" class="headerlink" title="Homebrew"></a>Homebrew</h3><p>macOS（或 Linux）缺失的软件包的管理器</p>
<h4 id="安装-Homebrew"><a href="#安装-Homebrew" class="headerlink" title="安装 Homebrew"></a>安装 Homebrew</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/bash -c <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>脚本会在执行前暂停，并说明它将做什么。高级安装选项在 <a href="https://docs.brew.sh/Installation">这里</a>。</p>
<h4 id="Homebrew-能干什么"><a href="#Homebrew-能干什么" class="headerlink" title="Homebrew 能干什么?"></a>Homebrew 能干什么?</h4><ol>
<li>使用 <code>Homebrew</code> 安装 <code>Mac</code>（或您的 <code>Linux</code> 系统）没有预装但 <a href="https://formulae.brew.sh/formula/">你需要的东西</a>。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install wget</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><code>Homebrew</code> 会将软件包安装到独立目录，并将其文件软链接至 <code>/opt/homebrew</code> 。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /opt/homebrew</span><br><span class="line">find Cellar</span><br><span class="line"></span><br><span class="line"><span class="comment"># Cellar/wget/1.16.1</span></span><br><span class="line"><span class="comment"># Cellar/wget/1.16.1/bin/wget</span></span><br><span class="line"><span class="comment"># Cellar/wget/1.16.1/share/man/man1/wget.1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">ls</span> -l bin</span><br><span class="line"><span class="comment"># bin/wget -&gt; ../Cellar/wget/1.16.1/bin/wget</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p><code>Homebrew</code> 不会将文件安装到它本身目录之外，所以您可将 <code>Homebrew</code> 安装到任意位置。</p>
</li>
<li><p>轻松创建你自己的 <code>Homebrew</code> 包。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew create https://foo.com/foo-1.0.tgz</span><br><span class="line"><span class="comment"># Created /opt/homebrew/Library/Taps/homebrew/homebrew-core/Formula/foo.rb</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>完全基于 <code>Git</code> 和 <code>Ruby</code>，所以自由修改的同时你仍可以轻松撤销你的变更或与上游更新合并。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew edit wget <span class="comment"># 使用 $EDITOR 编辑!</span></span><br></pre></td></tr></table></figure>

<ol start="6">
<li><code>Homebrew</code> 的配方都是简单的 <code>Ruby</code> 脚本：</li>
</ol>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Wget</span> &lt; <span class="title class_ inherited__">Formula</span></span><br><span class="line">  homepage <span class="string">&quot;https://www.gnu.org/software/wget/&quot;</span></span><br><span class="line">  url <span class="string">&quot;https://ftp.gnu.org/gnu/wget/wget-1.15.tar.gz&quot;</span></span><br><span class="line">  sha256 <span class="string">&quot;52126be8cf1bddd7536886e74c053ad7d0ed2aa89b4b630f76785bac21695fcd&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">def</span> <span class="title function_">install</span></span><br><span class="line">    system <span class="string">&quot;./configure&quot;</span>, <span class="string">&quot;--prefix=<span class="subst">#&#123;prefix&#125;</span>&quot;</span></span><br><span class="line">    system <span class="string">&quot;make&quot;</span>, <span class="string">&quot;install&quot;</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<ol start="7">
<li><p><code>Homebrew</code> 使 <code>macOS</code>（或您的 <code>Linux</code> 系统）更完整。使用 <code>gem</code> 来安装 <code>RubyGems</code>、用 <code>brew</code> 来安装那些依赖包。</p>
</li>
<li><p>“要安装，请拖动此图标……”不会再出现了。使用 <code>Homebrew Cask</code> 安装 <code>macOS</code> 应用程序、字体和插件以及其他非开源软件。</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install --cask firefox</span><br></pre></td></tr></table></figure>

<ol start="9">
<li>制作一个 <code>cask</code> 就像创建一个配方一样简单。</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew create --cask https://foo.com/foo-1.0.dmg</span><br><span class="line"><span class="comment"># Editing /opt/homebrew/Library/Taps/homebrew/homebrew-cask/Casks/foo.rb</span></span><br></pre></td></tr></table></figure>

<h3 id="国内源安装"><a href="#国内源安装" class="headerlink" title="国内源安装"></a>国内源安装</h3><p>国内安装 <code>Homebrew</code> 可能很慢，所以我们推荐使用国内的源来进行安装</p>
<h4 id="macOS"><a href="#macOS" class="headerlink" title="macOS"></a>macOS</h4><ul>
<li>常规安装（推荐）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br></pre></td></tr></table></figure>

<ul>
<li>极速安装（精简版）：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot; speed</span><br></pre></td></tr></table></figure>

<ul>
<li>卸载</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/HomebrewUninstall.sh)&quot;</span><br></pre></td></tr></table></figure>

<h3 id="Linux"><a href="#Linux" class="headerlink" title="Linux"></a>Linux</h3><ul>
<li><p>安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm Homebrew.sh; wget https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh; bash Homebrew.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>卸载</p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm HomebrewUninstall.sh; wget https://gitee.com/cunkai/HomebrewCN/raw/master/HomebrewUninstall.sh; bash HomebrewUninstall.sh</span><br></pre></td></tr></table></figure>

<h3 id="macOS-常见错误说明"><a href="#macOS-常见错误说明" class="headerlink" title="macOS 常见错误说明"></a>macOS 常见错误说明</h3><blockquote>
<p><a href="https://brew.sh/blog/">官方表示只支持最新的三个Mac os版本</a>,老的Mac系统可以试试MacPorts。</p>
</blockquote>
<blockquote>
<p>首先确保运行的<code>/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/ **cunkai** /HomebrewCN/raw/master/Homebrew.sh)&quot;</code> 中间那个 <strong>cunkai</strong> 不是别的。</p>
</blockquote>
<p><strong>1.</strong> 如果遇到安装软件报错 <strong>404</strong> ，切换网络如果还不行：</p>
<p>查看下官方更新记录<code>https://brew.sh/blog/</code> 如果近期有更新，可以发我邮箱<a href="mailto:&#x63;&#x75;&#x6e;&#107;&#97;&#105;&#x2e;&#x77;&#x61;&#x6e;&#x67;&#x40;&#102;&#x6f;&#x78;&#109;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#x6d;">&#x63;&#x75;&#x6e;&#107;&#97;&#105;&#x2e;&#x77;&#x61;&#x6e;&#x67;&#x40;&#102;&#x6f;&#x78;&#109;&#97;&#x69;&#x6c;&#46;&#x63;&#111;&#x6d;</a>。我看看是否官方修改了某些代码。</p>
<p><strong>2.</strong> 不小心改动了brew文件夹里面的内容，如何重置，运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew update-reset</span><br></pre></td></tr></table></figure>

<p><strong>3.</strong> 报错提示中如果有  <strong>git -c xxxxxxx xxx xxx</strong>  等类似语句。</p>
<p>  如果有这种提示，把报错中提供的解决语句（git -C ….）逐句运行一般就可以解决。</p>
<p><strong>4.</strong> 如果遇到报错中含有errno  <strong>54</strong>  &#x2F;  <strong>443</strong>  &#x2F; 的问题：</p>
<p>  这种一般切换源以后没有问题，因为都是公益服务器，不稳定性很大。</p>
<p><strong>5.</strong> 检测到你不是最新系统，需要自动升级 Ruby 后失败的：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">HOMEBREW_BOTTLE_DOMAIN=https://mirrors.ustc.edu.cn/homebrew-bottles</span><br><span class="line"></span><br><span class="line">rm -rf /Users/$(whoami)/Library/Caches/Homebrew/</span><br><span class="line"></span><br><span class="line">brew update</span><br></pre></td></tr></table></figure>

<p><strong>6.</strong> 如果报错  <strong>command not found : brew</strong></p>
<p>先运行此命令<code>/usr/local/Homebrew/bin/brew -v</code> ，如果是ARM架构的芯片运行<code>/opt/homebrew/bin/brew -v</code> 看是否能出来Homebrew的版本号。</p>
<p>如果能用就是电脑PATH配置问题，重启终端运行 <code>echo $PATH</code> 打印出来自己分析一下。</p>
<p><strong>7.</strong> Error: Running Homebrew as root is extremely dangerous and no longer supported.<br>As Homebrew does not drop privileges on installation you would be giving all<br> <strong>build scripts full access to your system.</strong></p>
<p>此报错原因是执行过su命令，把账户切换到了root权限，退出root权限即可。一般关闭终端重新打开即可，或者输入命令exit回车 或者su - 用户名</p>
<p><strong>8.</strong> &#x2F;usr&#x2F;local&#x2F;bin&#x2F;brew:  <strong>bad interpreter: &#x2F;bin&#x2F;bash^M: no such file or directory</strong></p>
<p><code>git config --global core.autocrlf</code></p>
<p>如果显示true那就运行下面这句话可以解决：</p>
<p><code>git config --global core.autocrlf input</code></p>
<p>运行完成后，需要重新运行安装脚本。</p>
<p><strong>9.</strong> from &#x2F;usr&#x2F;local&#x2F;Homebrew&#x2F;Library&#x2F;Homebrew&#x2F; <strong>brew.rb:23:in &#96;<main>‘</strong></p>
<p><code>brew update-reset</code></p>
<p><strong>10.</strong> M1芯片电脑运行which brew如果显示&#x2F;usr&#x2F;local&#x2F;Homebrew&#x2F;bin&#x2F;brew</p>
<p>解决方法，手动删除&#x2F;usr&#x2F;local目录，重新安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/zsh -c &quot;$(curl -fsSL https://gitee.com/cunkai/HomebrewCN/raw/master/Homebrew.sh)&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>11.</strong> The x86_64 architecture is required<br>这句话意思是，这个软件不支持M1芯片，只支持x86_64架构的CPU。</p>
<p><strong>12.</strong> Warning: No remote ‘origin’ in &#x2F;usr&#x2F;local&#x2F;Homebrew&#x2F;Library&#x2F;Taps&#x2F;homebrew&#x2F;homebrew-cask, skipping update!</p>
<p>看评论区说解决方法（我未测试）：<a href="https://gitee.com/cunkai/HomebrewCN/issues/I5A7RV">https://gitee.com/cunkai/HomebrewCN/issues/I5A7RV</a></p>
<p><strong>13.</strong> fatal: not in a git directory   Error: Command failed with exit 128: git</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git config --global http.sslVerify false</span><br></pre></td></tr></table></figure>

<p><strong>14.</strong> &#x2F;usr&#x2F;local&#x2F;Homebrew&#x2F;Library&#x2F;Homebrew&#x2F;cmd&#x2F;vendor-install.sh:1ine245:.&#x2F;3.1.4&#x2F;bin&#x2F;ruby:BadCPUtype inexecutable</p>
<p>如果你是苹果的M芯片有这种报错，说明你电脑有两个brew，简单粗暴的方法是删除<code>/usr/local/Homebrew</code>目录，保留<code>/opt/homebrew</code>即可。<br>（提示：如何去指定访达，屏幕左上角找到前往-&gt;前往文件夹然后输入<code>/usr/local</code>回车把Homebrew删除即可。反之如果你是英特尔处理器就保留<code>/usr/local</code>下的去opt目录删除）<br>温和的方法是分别运行下面三句话，看看是否包含<code>/usr/local/Homebrew</code>的字符串，删掉整行保存。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">open $&#123;HOME&#125;/.zprofile</span><br><span class="line">open $HOME/.bash_profile</span><br><span class="line">open $&#123;HOME&#125;/.profile</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/04/homebrew/" data-id="clvhem3ua000lrrq6coks0bu1" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-emoji" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/01/github-emoji/" class="article-date">
  <time datetime="2024-04-01T23:02:26.000Z" itemprop="datePublished">2024-04-01</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/01/github-emoji/">Emoji 大全</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="Emoji-大全"><a href="#Emoji-大全" class="headerlink" title="Emoji 大全"></a>Emoji 大全</h2><p>记录下 Emoji 表情大全，方便以后拷贝使用</p>
<p>下面内容可以直接复制来用，emoji 不是图片，所以可以任意字号展示,这里只是一部分，并不是全部：</p>
<blockquote>
<p>😀😃😄😁😆😅🤣😂🙂🙃😉😊😇🥰😍🤩😘😚😙😋😛😜🤪😝🤑🤗🤭🤫🤔🤐🤨😐😑😶😏😒🙄😬🤥😌😔😪🤤😴😷🤒🤕🤢🤮🤧🥵🥶🥴😵🤯🤠🥳😎🤓🧐😕😟🙁☹️😮😯😲😳🥺😦😧😨😰😥😢😭😱😖😣😞😓😩😫🥱😤😡😠🤬</p>
</blockquote>
<blockquote>
<p>👶🧒👦👧🧑👱👨🧔👨‍🦰👨‍🦱👨‍🦳👨‍🦲👩👩‍🦰🧑👩‍🦱🧑👩‍🦳🧑👩‍🦲🧑👱‍♀️👱‍♂️🧓👴👵🙍🙍‍♂️🙍‍♀️🙎🙎‍♂️🙎‍♀️🙅🙅‍♂️🙅‍♀️🙆🙆‍♂️🙆‍♀️💁💁‍♂️💁‍♀️🙋🙋‍♂️🙋‍♀️🧏🧏‍♂️🧏‍♀️🙇🙇‍♂️🙇‍♀️🤦‍♂️🤦‍♀️🤷‍♀️👨‍⚕️👩‍⚕️👨‍🎓👩‍🎓🧑‍🏫</p>
</blockquote>
<blockquote>
<p>👋🤚🖐️✋🖖👌🤏✌️🤞🤟🤘🤙👈👉👆🖕👇☝️👍👎✊👊🤛🤜👏🙌👐🤲🤝🙏✍️💅🤳💪</p>
</blockquote>
<blockquote>
<p>👣👀👁️👄💋👂🦻👃👅🧠🦷🦴💪🦾🦿🦵🦶👓🕶️🥽🥼🦺👔👕👖🧣🧤🧥🧦👗👘🥻🩱🩲🩳👙👚👛👜👝🎒👞👟🥾🥿👠👡🩰👢👑👒🎩🎓🧢⛑️💄💅💍💼🌂☂️💈🛀🛌💥💫💦💨</p>
</blockquote>
<blockquote>
<p>⬆️➡️⬇️⬅️↩️↪️⤴️⤵️🔃🔄🔙🔚🔛🔜🔝🛐⚛️🕉️✡️️☯️✝️☦️☪️☮️🕎🔯♈♉♊♋♌♍♎♏♐♑♒♓⛎🔀🔁🔂▶️⏩⏭️⏯️◀️⏪⏮️🔼⏫🔽⏬⏸️⏹️⏺️⏏️🎦✖️➕➖➗♾️⁉️❓❔❕❗💱💲⚕️♻️️🔱📛🔰⭕✅☑️✔️❌❎➰➿✳️✴️❇️#️⃣*️⃣0️⃣1️⃣2️⃣3️⃣4️⃣5️⃣6️⃣7️⃣8️⃣9️⃣🔟🅰️🆎🅱️🆑🉐🈚🈲🉑🈸🈴🈳㊗️㊙️🈺🈵🔴🟠🟡🟢🔵🟣🟤⚫⚪🟥🟧🟨🟩🟦🟪🟫⬛⬜◼️◻️◾◽▪️▫️🔶🔷🔸🔹🔺🔻💠🔘🔳🔲🏁🚩🎌🏴🏳️🏳️‍🌈🏳️‍⚧️🏴‍☠️</p>
</blockquote>
<blockquote>
<p>🙈🙉🙊💥💫💦💨🐵🐒🦍🦧🐶🐕🦮🐕‍🦺🐩🐺🦊🦝🐱🐈🐈‍⬛🦁🐯🐅🐆🐴🐎🦄🦓🦌🐮🐂🐃🐄🐷🐖🐗🐽🐏🐑🐐🐪🐫🦙🦒🐘🦏🦛🐭🐁🐀🐹🐰🐇🐿️🦔🦇🐻🐻‍❄️🐨🐼🦥🦦🦨🦘🦡🐾🦃🐔🐓🐣🐤🐥🐦🐧🕊️🦅🦆🦢🦉🦩🦚🦜🐸🐊🐢🦎🐍🐲🐉🦕🦖🐳🐋🐬🐟🐠🐡🦈🐙🐚🐌🦋🐛🐜🐝🐞🦗🕷️🕸️🦂🦟🦠🦀🦞🦐🦑</p>
</blockquote>
<blockquote>
<p>💐🌸💮🏵️🌹🥀🌺🌻🌼🌷🌱🌲🌳🌴🌵🌾🌿☘️🍀🍁🍂🍃</p>
</blockquote>
<blockquote>
<p>🌍🌎🌏🌐🌑🌒🌓🌔🌕🌖🌗🌘🌙🌚🌛🌜☀️🌝🌞⭐🌟🌠☁️⛅⛈️🌤️🌥️🌦️🌧️🌨️🌩️🌪️🌫️🌬️🌈☂️☔⚡❄️☃️⛄☄️🔥💧🌊</p>
</blockquote>
<blockquote>
<p>🍇🍈🍉🍊🍋🍌🍍🥭🍎🍏🍐🍑🍒🍓🥝🍅🥥🥑🍆🥔🥕🌽🌶️🥒🥬🥦🧄🧅🍄🥜🌰🍞🥐🥖🥨🥯🥞🧇🧀🍖🍗🥩🥓🍔🍟🍕🌭🥪🌮🌯🥙🧆🥚🍳🥘🍲🥣🥗🍿🧈🧂🥫🍱🍘🍙🍚🍛🍜🍝🍠🍢🍣🍤🍥🥮🍡🥟🥠🥡🦪🍦🍧🍨🍩🍪🎂🍰🧁🥧🍫🍬🍭🍮🍯🍼🥛☕🍵🍶🍾🍷🍸🍹🍺🍻🥂🥃🥤🧃🧉🧊🥢🍽️🍴🥄</p>
</blockquote>
<blockquote>
<p>🧗‍♀️🤺🏇⛷️🏂🏌️🏌️‍♂️🏌️‍♀️🏄🏄‍♂️🏄‍♀️🚣‍♀️🏊‍♀️⛹️⛹️‍♂️⛹️‍♀️🏋️🏋️‍♂️🚴🚵‍♀️🤸🤼‍♀️🤽🤾‍♀️🤹🧘‍♀️🎪🛹🛼🛶🎗️🎟️🎫🎖️🏆🏅🥇🥈🥉⚽⚾🥎🏀🏐🏈🏉🎾🥏🎳🏏🏑🏒🥍🏓🏸🥊🥋🥅⛳⛸️🎣🎽🎿🛷🥌🎯🎱🎮🎰🎲🧩♟️🎭🎨🧵🧶🎼🎤🎧🎷🎸🎹🎺🎻🥁🎬🏹</p>
</blockquote>
<blockquote>
<p>😈👿👹👺💀☠👻👽👾💣</p>
</blockquote>
<blockquote>
<p>👣🎠🎡🎢🚣🏔️⛰️🌋🗻🏕️🏖️🏜️🏝️🏞️🏟️🏛️🏗️🏘️🏚️🏠🏡🏢🏣🏤🏥🏦🏨🏩🏪🏫🏬🏭🏯🏰💒🗼🗽⛪🕌🛕🕍⛩🕋⛲⛺🌁🌃🏙️🌄🌅🌆🌇🌉🎠🎡🎢🚂🚃🚄🚅🚆🚇🚈🚉🚊🚝🚞🚋🚌🚍🚎🚐🚑🚒🚓🚔🚕🚖🚗🚘🚙🚚🚛🚜🏎️🏍️🛵🛺🚲🛴🚏🛣️🛤️⛽🚨🚥🚦🚧⚓⛵🚤🛳️⛴️🛥️🚢✈️🛩️🛫🛬🪂💺🚁🚟🚠🚡🛰️🚀🛸🪐🌠🌌⛱️🎆🎇🎑💴💵💶💷🗿🛂🛃🛄🛅🧭</p>
</blockquote>
<blockquote>
<p>💌💎🔪💈🚪🚽🚿🛁⌛⏳⌚⏰🎈🎉🎊🎎🎏🎐🎀🎁📯📻📱📲☎📞📟📠🔋🔌💻💽💾💿📀🎥📺📷📹📼🔍🔎🔬🔭📡💡🔦🏮📔📕📖📗📘📙📚📓📃📜📄📰📑🔖💰💴💵💶💷💸💳✉📧📨📩📤📥📦📫📪📬📭📮📝📁📂📅📆📇📈📉📊📋📌📍📎📏📐✂🔒🔓🔏🔐🔑🔨🔫🔧🔩🔗💉💊🚬🔮🚩🎌💦💨<br>💘❤💓💔💕💖💗💙💚💛💜💝💞💟</p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/01/github-emoji/" data-id="clvhem3u8000errq67ov612eq" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-vitepress-blog-guide" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/03/29/vitepress-blog-guide/" class="article-date">
  <time datetime="2024-03-29T12:20:26.000Z" itemprop="datePublished">2024-03-29</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/03/29/vitepress-blog-guide/">使用VitePress搭建个人博客</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-VitePress-搭建个人博客"><a href="#使用-VitePress-搭建个人博客" class="headerlink" title="使用 VitePress 搭建个人博客"></a>使用 VitePress 搭建个人博客</h2><p>随着互联网的迅猛发展，内容创作与分享已成为人们日常生活的重要组成部分。博客网站作为内容分享的重要平台，其构建工具的选择对于内容创作者来说至关重要。以前构建 <code>github pages</code> 内容博客站点，我们一般使用 <code>Hexo</code> 框架，但其构建速度相对较慢，博客风格依赖于 <code>hexo-theme</code>，大多数 <code>hexo-theme</code> 的开发都使用 <code>ejs</code> 模板引擎，不熟悉而且使用起来相对麻烦。而随着 <code>VitePress</code> 的出现，其构建速度也得到了优化，而且以 <code>Vite</code> 为基础，构建速度更快，更适合于构建博客站点，支持使用 <code>Vue</code> 进行定制化开发，很方便的创建自定义风格的博客站点。</p>
<h3 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h3><p><code>VitePress</code> 是由 <code>Vue.js</code> 驱动的静态网站生成器，专为技术文档和博客设计。它结合了 <code>Vite</code> 的快速冷启动和 <code>Vue.js</code> 的组件化开发优势，为用户提供了一个快速、简单且优雅的博客搭建方案。使用 <code>VitePress</code> ，您可以轻松创建、发布和管理博客内容，同时还能够享受到 <code>Vue.js</code> 带来的丰富交互体验。</p>
<h3 id="特点"><a href="#特点" class="headerlink" title="特点"></a>特点</h3><ol>
<li><strong>高效构建：</strong> <code>VitePress</code> 利用 <code>Vite</code> 的高速构建特性，实现了快速的页面加载和实时预览功能，大大提高了内容创作的效率。</li>
<li><strong>Markdown支持：</strong> <code>VitePress</code> 原生支持 <code>Markdown</code> 语法，让您能够轻松编写格式化的文章内容，无需担心排版问题。</li>
<li><strong>Vue.js集成：</strong> 作为 <code>Vue.js</code> 驱动的生成器， <code>VitePress</code> 允许您在博客中嵌入 <code>Vue</code> 组件，实现丰富的交互效果和动态内容。</li>
<li><strong>主题定制：</strong> <code>VitePress</code> 提供了丰富的主题选项，您可以根据自己的喜好和需求定制博客的外观风格。</li>
<li><strong>部署简便：</strong> 生成的静态网站可以方便地部署到各种平台，如 <code>GitHub Pages</code> 、 <code>Netlify</code> 等，无需额外的服务器配置。</li>
</ol>
<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><h4 id="安装-Homebrew"><a href="#安装-Homebrew" class="headerlink" title="安装 Homebrew"></a>安装 <code>Homebrew</code></h4><p><code>Homebrew</code> 是一种开源包管理器，主要用于 <code>macOS</code> 和 <code>Linux</code> 系统，可以理解为一个命令行版本的应用商店</p>
<p><code>Homebrew</code> 是基于Ruby的，所以安装过程也是很简单的，把下面的代码粘贴到 <code>Terminal</code> 中执行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e <span class="string">&quot;<span class="subst">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>&quot;</span></span><br></pre></td></tr></table></figure>

<p>查看安装是否成功:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew --version</span><br></pre></td></tr></table></figure>

<p>如下图所示表示安装成功</p>
<p><img src="https://user-images.githubusercontent.com/8088864/30236069-ba7e712e-9544-11e7-910a-7ec04c1d5579.png" alt="image"></p>
<h4 id="通过-nvm-安装指定版本的-Node"><a href="#通过-nvm-安装指定版本的-Node" class="headerlink" title="通过 nvm 安装指定版本的 Node"></a>通过 <code>nvm</code> 安装指定版本的 <code>Node</code></h4><ol>
<li>安装 <code>nvm</code></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install nvm</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>配置 <code>nvm</code></li>
</ol>
<p>配置 <code>nvm</code> 在 <code>shell</code> 中可以使用 <code>nvm</code> 命令，修改<code>~/.bash_profile</code>文件，如果不存在，新建<code> .bash_profile</code>文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">vim .bash_profile</span><br></pre></td></tr></table></figure>

<p>在文件中添加如下命令:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">export NVM_DIR=~/.nvm</span><br><span class="line">source $(brew --prefix nvm)/nvm.sh</span><br></pre></td></tr></table></figure>

<p>重新 <code>source</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> .bash_profile</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>安装 <code>Node</code></li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nvm ls-remote</span><br><span class="line"><span class="comment"># 安装node 18</span></span><br><span class="line">nvm install 18</span><br></pre></td></tr></table></figure>

<p>其他的 <code>nvm</code> 命令</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nvm ls-remote 查看 所有的node可用版本</span><br><span class="line"></span><br><span class="line">nvm install xxx 下载你想要的版本</span><br><span class="line"></span><br><span class="line">nvm use xxx 使用指定版本的node</span><br><span class="line"></span><br><span class="line">nvm <span class="built_in">alias</span> default xxx 每次启动终端都使用该版本的node</span><br></pre></td></tr></table></figure>

<h4 id="通过-npm-全局安装-VitePress"><a href="#通过-npm-全局安装-VitePress" class="headerlink" title="通过 npm 全局安装 VitePress"></a>通过 <code>npm</code> 全局安装 <code>VitePress</code></h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g vitepress</span><br></pre></td></tr></table></figure>

<h3 id="使用VitePress制作博客网站"><a href="#使用VitePress制作博客网站" class="headerlink" title="使用VitePress制作博客网站"></a>使用VitePress制作博客网站</h3><h4 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h4><ol>
<li>初始化个人博客项目</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> my-blog</span><br><span class="line"><span class="built_in">cd</span> my-blog</span><br><span class="line">npm init -y</span><br><span class="line">yarn add vitepress --dev</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/dc34ca12-aaf2-443b-a73e-d93f217e8be7" alt="image"></p>
<ol start="2">
<li>使用 <code>VitePress</code> 命令初始化配置</li>
</ol>
<p>设置配置文件的名称和路径，标题，描述，主题和基本配置相关信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vitepress init</span><br><span class="line"></span><br><span class="line">yarn add vue --dev</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/d425e214-8add-4f0f-aae1-2229a47a0430" alt="image"></p>
<h4 id="编写文章"><a href="#编写文章" class="headerlink" title="编写文章"></a>编写文章</h4><p>在项目的根目录下找到一个名为docs的文件夹，这将作为你的博客内容的根目录。然后，在docs文件夹中修改以下文件：</p>
<ul>
<li>index.md：作为博客的主页。</li>
<li>_sidebar.md：定义侧边栏的导航菜单。</li>
<li>其他以.md结尾的Markdown文件：作为博客的具体文章。</li>
</ul>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/d3be51ea-7da3-4731-9030-523173399276" alt="image"></p>
<h4 id="配置VitePress"><a href="#配置VitePress" class="headerlink" title="配置VitePress"></a>配置VitePress</h4><p>在项目的根目录下找到一个名为docs的文件夹，里面存在 <code>.vitepress/config.mts</code> 的文件，用于配置 <code>VitePress</code> 的行为。以下是一个基本的配置示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// vitepress.config.js</span></span><br><span class="line"><span class="variable language_">module</span>.<span class="property">exports</span> = &#123;</span><br><span class="line">  <span class="attr">title</span>: <span class="string">&#x27;HankLiu的博客小屋&#x27;</span>, <span class="comment">// 博客的标题</span></span><br><span class="line">  <span class="attr">description</span>: <span class="string">&#x27;努力去听风的声音，不必在意风的方向。&#x27;</span>, <span class="comment">// 博客的描述</span></span><br><span class="line">  <span class="attr">themeConfig</span>: &#123;</span><br><span class="line">    <span class="attr">nav</span>: [ <span class="comment">// 导航栏配置</span></span><br><span class="line">      &#123; <span class="attr">text</span>: <span class="string">&#x27;主页&#x27;</span>, <span class="attr">link</span>: <span class="string">&#x27;/&#x27;</span> &#125;,</span><br><span class="line">      <span class="comment">// 其他导航项...</span></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="attr">sidebar</span>: &#123; <span class="comment">// 侧边栏配置</span></span><br><span class="line">      <span class="string">&#x27;/&#x27;</span>: [ <span class="comment">// 主页侧边栏</span></span><br><span class="line">        <span class="string">&#x27;&#x27;</span>, <span class="comment">// 主页链接</span></span><br><span class="line">        <span class="comment">// 其他文章链接...</span></span><br><span class="line">      ],</span><br><span class="line">      <span class="comment">// 其他页面的侧边栏配置...</span></span><br><span class="line">    &#125;,</span><br><span class="line"></span><br><span class="line">    <span class="attr">socialLinks</span>: [ <span class="comment">// 社交链接配置</span></span><br><span class="line">      &#123; <span class="attr">icon</span>: <span class="string">&#x27;github&#x27;</span>, <span class="attr">link</span>: <span class="string">&#x27;https://github.com/xxx&#x27;</span> &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 其他配置...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="启动预览"><a href="#启动预览" class="headerlink" title="启动预览"></a>启动预览</h4><p>运行 <code>VitePress</code> 命令，本地启动博客预览。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn docs:dev</span><br></pre></td></tr></table></figure>

<p>这将启动一个本地开发服务器，你可以在浏览器中访问 <code>http://localhost:5173/</code> 来查看你的博客网站。</p>
<h5 id="报错-getaddrinfo-ENOTFOUND-localhost"><a href="#报错-getaddrinfo-ENOTFOUND-localhost" class="headerlink" title="报错 getaddrinfo ENOTFOUND localhost"></a>报错 <code>getaddrinfo ENOTFOUND localhost</code></h5><p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/c8d10f7c-0cc3-4e30-bea1-ab9e9f5770f0" alt="image"></p>
<p><code>getaddrinfo ENOTFOUND localhost</code> 错误表明 <code>Node.js</code> 在尝试解析主机名 <code>localhost</code> 对应的 <code>IP</code> 地址时失败了。这通常意味着 <code>localhost</code> 无法被解析，可能是因为 <code>DNS</code> 解析问题或者本地 <code>DNS</code> 缓存出现问题。</p>
<p>检查 <code>/etc/hosts</code> 文件（在 Unix-like 系统中）或 <code>C:\Windows\System32\drivers\etc\hosts</code>（在 Windows 中），确保 <code>localhost</code> 正确地指向 <code>127.0.0.1</code></p>
<p>解决方法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo vim /etc/hosts</span><br><span class="line"><span class="comment"># 添加一行：127.0.0.1 localhost</span></span><br><span class="line">sudo killall -HUP mDNSResponder</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/805bf9c4-2e98-4333-9a2d-2faab5002d33" alt="image"></p>
<h4 id="生成静态网站"><a href="#生成静态网站" class="headerlink" title="生成静态网站"></a>生成静态网站</h4><p>当你的博客网站开发完成后，可以使用以下命令来构建生产版本的网站：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn docs:build</span><br></pre></td></tr></table></figure>

<p>构建完成后，<code>VitePress</code> 将在 <code>docs/.vitepress/dist</code> 文件夹中生成静态文件。你可以将这些文件部署到你选择的任何Web服务器上，或者将它们上传到诸如 <code>GitHub Pages</code> 之类的服务上。</p>
<h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p><code>VitePress</code> 作为一款专为内容创作者设计的博客构建工具，凭借其高效、便捷的特性，为内容创作者提供了一个理想的博客搭建方案。无论是个人博客还是企业技术文档， <code>VitePress</code> 都能够帮助您快速搭建起一个美观、实用的博客网站，让您的内容更好地传播和分享。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vitepress/" rel="tag">vitepress</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/03/29/vitepress-blog-guide/" data-id="clvhem3uo001frrq64maaa5s2" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/04/20/communication-across-browser-tabs/">跨浏览器标签页进行通讯的方式简介</a>
          </li>
        
          <li>
            <a href="/2024/04/16/webrtc/">WebRTC:实时通信的未来</a>
          </li>
        
          <li>
            <a href="/2024/04/14/fontend-optimize-indicators/">Web前端最新优化指标：从FP到FPS的全面解析</a>
          </li>
        
          <li>
            <a href="/2024/04/12/abort-controller/">使用 AbortController 实现异步操作控制</a>
          </li>
        
          <li>
            <a href="/2024/04/10/optimize-miniprogram/">小程序性能优化实践指南</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/" rel="tag">canvas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csrf/" rel="tag">csrf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debugging/" rel="tag">debugging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/" rel="tag">github pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interview/" rel="tag">interview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/loader/" rel="tag">loader</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/miniprogram/" rel="tag">miniprogram</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/" rel="tag">mobile</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimize/" rel="tag">optimize</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reptile/" rel="tag">reptile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/service-worker/" rel="tag">service worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/translate/" rel="tag">translate</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vitepress/" rel="tag">vitepress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webrtc/" rel="tag">webrtc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webworker/" rel="tag">webworker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weinre/" rel="tag">weinre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yuv/" rel="tag">yuv</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 HankLiu, Inc. All rights reserved.<br>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
    <a href="/toolkit" class="mobile-nav-link">小工具</a>
  
    <a href="/resume" class="mobile-nav-link">小简介</a>
  
    <a href="/about" class="mobile-nav-link">小关于</a>
  
  <a href="#search" class="mobile-nav-link st-search-show-outputs">Search</a>
</nav>
  

<!-- totop start -->
<div id="totop">
	<a title="To Top"></a>
</div>
<!-- totop end -->

<!-- swiftype search start -->

<!-- swiftype search end -->



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/lrsjng.jquery-qrcode/0.12.0/jquery.qrcode.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


</div>
</body>
</html>
