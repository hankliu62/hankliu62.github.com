
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  
  <title>HankLiu的博客小屋</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="努力去听风的声音，不必在意风的方向。">
<meta property="og:type" content="website">
<meta property="og:title" content="HankLiu的博客小屋">
<meta property="og:url" content="https://hankliu62.github.io/index.html">
<meta property="og:site_name" content="HankLiu的博客小屋">
<meta property="og:description" content="努力去听风的声音，不必在意风的方向。">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="HankLiu">
<meta name="twitter:card" content="summary">
  
  
    <link rel="icon" href="/img/favicon.ico" sizes="16x16">
  
  <link rel="stylesheet" href="/css/style.css?t=1">
  
    <link href="//fonts.useso.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->
  
  

<meta name="generator" content="Hexo 7.1.1"></head>

<body>
<div id="container">
  <div id="wrap">
    <header id="header">
  <div id="banner">
    <div id="banner-mask"></div>
  </div>
  <div id="header-outer" class="outer">
    <nav id="upper-nav" class="inner">
      <a id="main-nav-toggle" class="nav-icon"></a>
      <div class="sub-nav">
        
        
          <a id="nav-github" class="nav-icon" href="https://github.com/hankliu62"></a>
        
      </div>
    </nav>
    <div id="header-title">
      
        <h1 id="blog-title-wrap">
          <a href="/" id="blog-title">HankLiu的博客小屋</a>
        </h1>
      
      
        <h5 class="blog-subtitle-wrap">努力去听风的声音，不必在意风的方向。</h5>
      
    </div>
    <div id="contenedor">
      <ul class="cube">
        <li class="cara"><svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="100" width="100" viewBox="-50 -50 200 200">
          <circle cx="50" cy="50" r="45" stroke-width="5" stroke="black" stroke-opacity="0.5" fill-opacity="0"></circle>
          <rect id="clockwise" x="47.5" y="27.5" width="5" height="25" rx="2.5" ry="2.5" fill="black" fill-opacity="0.5" transform="rotate(330 50 50)"></rect>
          <rect id="minute" x="48.5" y="16.5" width="3" height="35" rx="1.5" ry="1.5" fill="black" fill-opacity="0.5"></rect>
        </svg></li>
        <li class="cara">P</li>
        <li class="cara">X</li>
        <li class="cara">L</li>
        <li class="cara">C</li>
        <li class="cara">Y</li>
      </ul>
    </div>
    <nav id="main-nav">
      
        <a class="main-nav-link" href="/">主页</a>
      
        <a class="main-nav-link" href="/archives">文章</a>
      
        <a class="main-nav-link" href="/toolkit">小工具</a>
      
        <a class="main-nav-link" href="/resume">小简介</a>
      
        <a class="main-nav-link" href="/about">小关于</a>
      
    </nav>
  </div>
</header>

    <div class="outer">
      <section id="main">
  
    <article id="post-typescript-config" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/05/12/typescript-config/" class="article-date">
  <time datetime="2024-05-12T08:12:06.000Z" itemprop="datePublished">2024-05-12</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/05/12/typescript-config/">TypeScript 配置详解</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="TypeScript-配置详解"><a href="#TypeScript-配置详解" class="headerlink" title="TypeScript 配置详解"></a>TypeScript 配置详解</h2><p>TypeScript 是一种由微软开发的开源编程语言，它是 JavaScript 的一个超集，添加了可选的静态类型和基于类的面向对象编程。</p>
<p>在 TypeScript 项目中，<code>tsconfig.json</code> 是一个用于配置 TypeScript 编译器的配置文件。通过配置 <code>tsconfig.json</code> 文件，我们可以指定编译器如何处理 TypeScript 代码，并设置一些编译选项来满足项目的需求。</p>
<p>以下是一个典型的 <code>tsconfig.json</code> 配置示例，我们将逐个字段进行详细解释：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="comment">/* 通用编译选项 */</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">/* 基本选项 */</span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;es5&quot;</span><span class="punctuation">,</span>                       <span class="comment">// 指定 ECMAScript 目标版本: &#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES6&#x27;/&#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;, or &#x27;ESNEXT&#x27;</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;commonjs&quot;</span><span class="punctuation">,</span>                  <span class="comment">// 指定使用模块: &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27; or &#x27;es2015&#x27;</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>                             <span class="comment">// 指定要包含在编译中的库文件</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                       <span class="comment">// 允许编译 javascript 文件</span></span><br><span class="line">    <span class="attr">&quot;checkJs&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                       <span class="comment">// 报告 javascript 文件中的错误</span></span><br><span class="line">    <span class="attr">&quot;jsx&quot;</span><span class="punctuation">:</span> <span class="string">&quot;preserve&quot;</span><span class="punctuation">,</span>                     <span class="comment">// 指定 jsx 代码的生成: &#x27;preserve&#x27;, &#x27;react-native&#x27;, &#x27;react&#x27; or &#x27;react-jsx&#x27;等</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                   <span class="comment">// 生成相应的 &#x27;.d.ts&#x27; 文件</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                     <span class="comment">// 生成相应的 &#x27;.map&#x27; 文件</span></span><br><span class="line">    <span class="attr">&quot;outFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                       <span class="comment">// 将输出文件合并为一个文件</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                        <span class="comment">// 指定输出目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                       <span class="comment">// 用来控制输出目录结构 --outDir.</span></span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                <span class="comment">// 删除编译后的所有的注释</span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                        <span class="comment">// 不生成输出文件</span></span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                 <span class="comment">// 从 tslib 导入辅助工具函数</span></span><br><span class="line">    <span class="attr">&quot;isolatedModules&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>               <span class="comment">// 将每个文件作为单独的模块 （与 &#x27;ts.transpileModule&#x27; 类似）.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 严格的类型检查选项 */</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                        <span class="comment">// 启用所有严格类型检查选项</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                 <span class="comment">// 在表达式和声明上有隐含的 any 类型时报错</span></span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>              <span class="comment">// 启用严格的 null 检查</span></span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                <span class="comment">// 当 this 表达式值为 any 类型的时候，生成一个错误</span></span><br><span class="line">    <span class="attr">&quot;alwaysStrict&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                  <span class="comment">// 以严格模式检查每个模块，并在每个文件里加入 &#x27;use strict&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 额外的检查 */</span></span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                <span class="comment">// 有未使用的变量时，抛出错误</span></span><br><span class="line">    <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>            <span class="comment">// 有未使用的参数时，抛出错误</span></span><br><span class="line">    <span class="attr">&quot;noImplicitReturns&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>             <span class="comment">// 并不是所有函数里的代码都有返回值时，抛出错误</span></span><br><span class="line">    <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>    <span class="comment">// 报告 switch 语句的 fallthrough 错误。（即，不允许 switch 的 case 语句贯穿）</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 模块解析选项 */</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span>            <span class="comment">// 选择模块解析策略： &#x27;node&#x27; (Node.js) or &#x27;classic&#x27; (TypeScript pre-1.6)</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                       <span class="comment">// 用于解析非相对模块名称的基目录</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span>                           <span class="comment">// 模块名到基于 baseUrl 的路径映射的列表</span></span><br><span class="line">    <span class="attr">&quot;rootDirs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>                        <span class="comment">// 根文件夹列表，其组合内容表示项目运行时的结构内容</span></span><br><span class="line">    <span class="attr">&quot;typeRoots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>                       <span class="comment">// 包含类型声明的文件列表</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span>                           <span class="comment">// 需要包含的类型声明文件名列表</span></span><br><span class="line">    <span class="attr">&quot;allowSyntheticDefaultImports&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>  <span class="comment">// 允许从没有设置默认导出的模块中默认导入。</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* Source Map Options */</span></span><br><span class="line">    <span class="attr">&quot;sourceRoot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                    <span class="comment">// 指定调试器应该找到 TypeScript 文件而不是源文件的位置</span></span><br><span class="line">    <span class="attr">&quot;mapRoot&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span>                       <span class="comment">// 指定调试器应该找到映射文件而不是生成文件的位置</span></span><br><span class="line">    <span class="attr">&quot;inlineSourceMap&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>               <span class="comment">// 生成单个 soucemaps 文件，而不是将 sourcemaps 生成不同的文件</span></span><br><span class="line">    <span class="attr">&quot;inlineSources&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>                 <span class="comment">// 将代码与 sourcemaps 生成到一个文件中，要求同时设置了 --inlineSourceMap 或 --sourceMap 属性</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 其他选项 */</span></span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span>        <span class="comment">// 启用装饰器</span></span><br><span class="line">    <span class="attr">&quot;emitDecoratorMetadata&quot;</span><span class="punctuation">:</span> <span class="literal"><span class="keyword">true</span></span>          <span class="comment">// 为装饰器提供元数据的支持</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">/* 其他配置选项 */</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>                <span class="comment">// 需要编译的文件路径</span></span><br><span class="line">  <span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;dist&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span>        <span class="comment">// 不需要编译的文件路径</span></span><br><span class="line">  <span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./base.tsconfig.json&quot;</span><span class="punctuation">,</span>          <span class="comment">// 继承另一个配置文件</span></span><br><span class="line">  <span class="attr">&quot;references&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./packages/core&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span>  <span class="comment">// 引用其他 TypeScript 项目</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>现在，让我们详细了解每个配置选项的含义和可选值。</p>
<h3 id="compilerOptions-字段"><a href="#compilerOptions-字段" class="headerlink" title="compilerOptions 字段"></a>compilerOptions 字段</h3><ul>
<li><p><code>target</code>: 编译后的 JavaScript 目标版本。可选值包括 <code>&quot;es3&quot;</code>, <code>&quot;es5&quot;</code>, <code>&quot;es6&quot;/&quot;es2015&quot;</code>, <code>&quot;es2016&quot;</code>, <code>&quot;es2017&quot;</code>, <code>&quot;es2018&quot;</code>, <code>&quot;es2019&quot;</code>, <code>&quot;es2020&quot;</code>, <code>&quot;esnext&quot;</code>。</p>
</li>
<li><p><code>module</code>: 生成模块代码的模块系统。可选值包括 <code>&quot;commonjs&quot;</code>, <code>&quot;amd&quot;</code>, <code>&quot;system&quot;</code>, <code>&quot;umd&quot;</code>, <code>&quot;es2015&quot;</code>。</p>
</li>
<li><p><code>lib</code>: 编译时需要引入的库文件。例如，<code>[&quot;es5&quot;, &quot;dom&quot;, &quot;es2015.promise&quot;]</code> 表示编译时将引入 ES5、DOM 和 Promise 相关的库文件。</p>
</li>
<li><p><code>allowJs</code>: 允许编译 JavaScript 文件。设置为 <code>true</code> 表示允许编译 JavaScript 文件。</p>
</li>
<li><p><code>checkJs</code>: 对 JavaScript 文件进行类型检查。设置为 <code>true</code> 表示在编译 JavaScript 文件时进行类型检查。</p>
</li>
<li><p><code>jsx</code>: 支持 JSX 语法，并指定 JSX 转换方式。可选值包括  <code>&quot;preserve&quot;</code>, <code>&quot;react&quot;</code>, <code>&quot;react-native&quot;</code>, <code>&quot;react-jsx&quot;</code>, <code>&quot;react-jsxdev&quot;</code>, <code>&quot;react-native&quot;</code>, <code>&quot;react-native-svg&quot;</code>等。</p>
</li>
<li><p><code>declaration</code>: 生成对外部使用者的声明文件。设置为 <code>true</code> 表示生成 <code>.d.ts</code> 文件。</p>
</li>
<li><p><code>sourceMap</code>: 生成源映射文件。设置为 <code>true</code> 表示生成 <code>.map</code> 文件。</p>
</li>
<li><p><code>outDir</code>: 编译输出目录。指定编译后的 JavaScript 文件的输出目录。</p>
</li>
<li><p><code>rootDir</code>: 源代码根目录。用来控制输出目录结构。</p>
</li>
<li><p><code>removeComments</code>: 删除生成文件中的注释。设置为 <code>true</code> 表示删除编译后的所有注释。</p>
</li>
<li><p><code>noEmit</code>: 不生成编译结果。设置为 <code>true</code> 表示不生成输出文件。</p>
</li>
<li><p><code>strict</code>: 启用所有严格类型检查选项。设置为 <code>true</code> 表示启用所有严格类型检查选项。</p>
</li>
</ul>
<h3 id="2-include-和-exclude-字段"><a href="#2-include-和-exclude-字段" class="headerlink" title="2. include 和 exclude 字段"></a>2. include 和 exclude 字段</h3><p>include 和 exclude 字段用于指定要包含和排除的文件或目录。它们可以是字符串或字符串数组。例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/**/*&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;exclude&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;node_modules&quot;</span><span class="punctuation">,</span> <span class="string">&quot;**/*.spec.ts&quot;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-extends-字段"><a href="#3-extends-字段" class="headerlink" title="3. extends 字段"></a>3. extends 字段</h3><p>extends 字段用于继承另一个配置文件的设置。例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;extends&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./baseConfig.json&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="4-files-和-references-字段"><a href="#4-files-和-references-字段" class="headerlink" title="4. files 和 references 字段"></a>4. files 和 references 字段</h3><p>files 字段用于显式地指定要编译的文件列表。references 字段用于指定项目之间的引用关系。例如：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;files&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="string">&quot;src/main.ts&quot;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line"><span class="attr">&quot;references&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span> <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span> <span class="string">&quot;../otherProject&quot;</span> <span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p>以上是 TypeScript 中 <code>tsconfig.json</code> 配置文件的详细解释和说明。根据项目的需要，可以灵活配置编译选项，以满足项目的需求。</p>
<h3 id="TypeScript-编译"><a href="#TypeScript-编译" class="headerlink" title="TypeScript 编译"></a>TypeScript 编译</h3><p>好的 <code>IDE</code> 支持对 <code>TypeScript</code> 的即时编译。但是，如果你想在使用 <code>tsconfig.json</code> 时从命令行手动运行 <code>TypeScript</code> 编译器，你可以通过以下方式：</p>
<ul>
<li>运行 <code>tsc</code>，它会在当前目录或者是父级目录寻找 <code>tsconfig.json</code> 文件。</li>
<li>运行 <code>tsc -p ./path-to-project-directory</code>。当然，这个路径可以是绝对路径，也可以是相对于当前目录的相对路径。</li>
</ul>
<p>你甚至可以使用 <code>tsc -w</code> 来启用 <code>TypeScript</code> 编译器的观测模式，在检测到文件改动之后，它将重新编译。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过对 tsconfig.json 配置文件的详细解释，我们可以更好地理解和配置 TypeScript 项目。合理地配置 tsconfig.json 可以提高项目的开发效率和代码质量，使得 TypeScript 的强大功能得以充分发挥。希望本文能够帮助读者更加深入地了解 TypeScript 的配置选项和使用方法。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/typeScript/" rel="tag">typeScript</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/05/12/typescript-config/" data-id="clw71kuuk001gqqoq0vmge4mw" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-action-auto-git-tag" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/05/02/github-action-auto-git-tag/" class="article-date">
  <time datetime="2024-05-02T18:12:20.000Z" itemprop="datePublished">2024-05-02</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/05/02/github-action-auto-git-tag/">使用 GitHub Actions 自动推送 Git Tag</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-GitHub-Actions-自动推送-Git-Tag"><a href="#使用-GitHub-Actions-自动推送-Git-Tag" class="headerlink" title="使用 GitHub Actions 自动推送 Git Tag"></a>使用 GitHub Actions 自动推送 Git Tag</h2><p><code>GitHub Actions</code> 是 <code>GitHub</code> 提供的一项功能，用于实现自动化工作流程，可以帮助您自动执行多种任务，例如构建、测试、部署等。其中，自动推送 <code>Git Tag</code> 是一个常见的用例，特别是当您希望将版本号从项目的 <code>package.json</code> 文件中提取并自动发布为 <code>Git Tag</code> 时。</p>
<p><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub Actions Logo"></p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><p>在开始之前，您需要确保您具备以下条件：</p>
<ol>
<li>一个 <code>GitHub</code> 账号，并且您拥有要推送标签的仓库的写权限。</li>
<li>项目使用了 <code>Git</code> 来进行版本控制，并且 <code>package.json</code> 文件中包含了版本号信息。</li>
<li>对 <code>GitHub Actions</code> 有一定的了解，包括如何编写和配置工作流文件。</li>
</ol>
<h3 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h3><p>下面是实现自动推送 <code>Git Tag</code> 的详细步骤：</p>
<h4 id="1-创建-Workflow-文件"><a href="#1-创建-Workflow-文件" class="headerlink" title="1. 创建 Workflow 文件"></a>1. 创建 Workflow 文件</h4><p>首先，在您的 GitHub 仓库中创建一个新的 <code>Workflow</code> 文件，该文件将定义自动化工作流程。您可以在 <code>.github/workflows</code> 目录下创建一个 YAML 格式的文件，例如 <code>push-tag.yml</code>。</p>
<h4 id="2-编写-Workflow-文件"><a href="#2-编写-Workflow-文件" class="headerlink" title="2. 编写 Workflow 文件"></a>2. 编写 Workflow 文件</h4><p>在 <code>Workflow</code> 文件中，我们需要定义一个工作流程，该工作流程将在满足特定条件时触发，并执行推送标签的操作。下面是一个示例 <code>Workflow</code> 文件的内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Push</span> <span class="string">Tag</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">push-tag:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Get</span> <span class="string">version</span> <span class="string">from</span> <span class="string">package.json</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">version</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">echo</span> <span class="string">&quot;VERSION=$(node -p &#x27;require(`./package.json`).version&#x27;)&quot;</span> <span class="string">&gt;&gt;</span> <span class="string">$GITHUB_ENV</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Push</span> <span class="string">tag</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line"><span class="string">          git config --local user.email &quot;action@github.com&quot;</span></span><br><span class="line"><span class="string">          git config --local user.name &quot;GitHub Action&quot;</span></span><br><span class="line"><span class="string">          git tag -a v$&#123;&#123; env.VERSION &#125;&#125; -m &quot;Auto-generated tag from GitHub Actions&quot;</span></span><br><span class="line"><span class="string">          git push origin v$&#123;&#123; env.VERSION &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中：</p>
<ul>
<li>定义了一个名为 <code>Push Tag</code> 的工作流，它将在推送到 <code>master</code> 分支时触发。</li>
<li>创建了一个名为 <code>push-tag</code> 的 <code>job</code>，它在 <code>Ubuntu</code> 环境中运行。</li>
<li>工作流程包含三个步骤：检出仓库、从 <code>package.json</code> 文件中获取版本号、推送标签到远程仓库。</li>
<li>使用 <code>echo</code> 命令将从 <code>package.json</code> 文件中获取的版本号写入到环境文件中，该环境文件由 <code>GitHub Actions</code> 自动读取。</li>
<li>然后使用 <code>env</code> 关键字来获取环境变量中的版本号，并使用该版本号创建标签和推送标签。</li>
</ul>
<h4 id="3-提交并部署-Workflow-文件"><a href="#3-提交并部署-Workflow-文件" class="headerlink" title="3. 提交并部署 Workflow 文件"></a>3. 提交并部署 Workflow 文件</h4><p>将编写好的 <code>Workflow</code> 文件提交到您的 <code>GitHub</code> 仓库中，并等待 <code>GitHub Actions</code> 自动触发工作流程。当您推送代码到 <code>master</code> 分支时，<code>GitHub Actions</code> 将自动运行该工作流程，并根据 <code>package.json</code> 文件中的版本号创建并推送一个新的 <code>Git Tag</code>。</p>
<p><img src="https://cdn.jsdelivr.net/gh/devicons/devicon/icons/github/github-original.svg" alt="GitHub Actions Workflow"></p>
<h3 id="GitHub-Actions-YAML-配置参数"><a href="#GitHub-Actions-YAML-配置参数" class="headerlink" title="GitHub Actions YAML 配置参数"></a>GitHub Actions YAML 配置参数</h3><p><code>GitHub Actions</code> 的 <code>YAML</code> 文件用于定义工作流程，其中包含了触发条件、作业配置和任务步骤等信息。以下是对 <code>YAML</code> 文件中常用字段的解释：</p>
<ol>
<li><p><code>name</code>: 定义工作流程的名称。</p>
</li>
<li><p><code>on</code>: 定义触发工作流程的事件。可以是以下任何一个或组合：</p>
<ul>
<li><code>push</code>: 当代码推送到仓库时触发。</li>
<li><code>pull_request</code>: 当创建或更新拉取请求时触发。</li>
<li><code>schedule</code>: 按计划执行工作流程。</li>
<li><code>workflow_dispatch</code>: 通过 <code>GitHub UI</code> 或 <code>API</code> 手动触发。</li>
</ul>
</li>
<li><p><code>jobs</code>: 定义工作流程中的作业列表，每个作业可以包含一个或多个步骤。</p>
<ul>
<li><code>name</code>: 定义作业的名称。</li>
<li><code>runs-on</code>: 指定作业运行的操作系统环境，例如 <code>ubuntu-latest</code>、<code>macos-latest</code>、<code>windows-latest</code> 等。</li>
<li><code>steps</code>: 定义作业中的任务步骤列表。</li>
</ul>
</li>
<li><p><code>steps</code>: 定义作业中的任务步骤列表，每个步骤可以是一个预定义的操作或自定义的命令。</p>
<ul>
<li><code>name</code>: 定义步骤的名称。</li>
<li><code>uses</code>: 指定要使用的预定义操作。例如 <code>actions/checkout@v2</code> 表示使用 <code>GitHub</code> 提供的 <code>checkout</code> 操作。</li>
<li><code>run</code>: 指定要执行的自定义命令。可以是单个命令或多行脚本。</li>
</ul>
</li>
</ol>
<p>以下是一个简单的 <code>GitHub Actions YAML</code> 文件示例：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">project</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Run</span> <span class="string">tests</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">test</span></span><br></pre></td></tr></table></figure>

<p>在这个示例中，工作流程名为 <code>CI</code>，当代码推送到 <code>main</code> 分支时触发。工作流程包含一个名为 <code>build</code> 的作业，该作业在 <code>ubuntu-latest</code> 环境中运行。作业中包含一系列步骤，依次为检出仓库、安装依赖、构建项目和运行测试。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>通过使用 <code>GitHub Actions</code>，您可以轻松地实现自动推送 <code>Git Tag</code> 的功能，并且可以从项目的 <code>package.json</code> 文件中自动提取版本号。这样，您就可以自动化管理软件包的发布流程，提高开发效率，同时确保版本控制的一致性和可追踪性。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tag/" rel="tag">tag</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/05/02/github-action-auto-git-tag/" data-id="clw71kuu1000bqqoqg2j6d7ue" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-react-fiber-struct" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/24/react-fiber-struct/" class="article-date">
  <time datetime="2024-04-24T10:52:26.000Z" itemprop="datePublished">2024-04-24</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/24/react-fiber-struct/">浅入解析 React Fiber 结构</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h3 id="浅入解析-React-Fiber-结构"><a href="#浅入解析-React-Fiber-结构" class="headerlink" title="浅入解析 React Fiber 结构"></a>浅入解析 React Fiber 结构</h3><p>React Fiber 是 React 中用于表示组件树的一种数据结构，它的设计和实现是 React 中的一项重要内容。本文将深入探讨 React Fiber 的结构，包括其所有属性及其含义，并对属性中的对象类型进行详细说明和解释。通过阅读本文，读者将更好地理解 React Fiber 的内部机制。</p>
<h3 id="React-18-Fiber-结构概述"><a href="#React-18-Fiber-结构概述" class="headerlink" title="React@18+ Fiber 结构概述"></a>React@18+ Fiber 结构概述</h3><p>在 React 中，每个组件都对应一个 Fiber 对象，用于表示组件树中的一个节点。以下是 Fiber 对象的结构定义：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Fiber</span> = &#123;</span><br><span class="line">  <span class="attr">tag</span>: <span class="title class_">WorkTag</span>,</span><br><span class="line">  <span class="attr">key</span>: <span class="literal">null</span> | <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">elementType</span>: <span class="built_in">string</span> | <span class="title class_">FunctionComponent</span> | <span class="title class_">ClassComponent</span> | <span class="title class_">HostComponent</span> | <span class="title class_">SuspenseComponent</span> | ...,</span><br><span class="line">  <span class="attr">type</span>: <span class="built_in">string</span> | <span class="title class_">FunctionComponent</span> | <span class="title class_">ClassComponent</span> | <span class="title class_">HostComponent</span> | <span class="title class_">SuspenseComponent</span> | ...,</span><br><span class="line">  <span class="attr">stateNode</span>: <span class="title class_">HTMLElement</span> | <span class="title class_">Component</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">return</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">child</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">sibling</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">index</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">ref</span>: <span class="title class_">RefObject</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">pendingProps</span>: <span class="built_in">any</span>,</span><br><span class="line">  <span class="attr">memoizedProps</span>: <span class="built_in">any</span>,</span><br><span class="line">  <span class="attr">updateQueue</span>: <span class="title class_">UpdateQueue</span>&lt;<span class="built_in">any</span>&gt; | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">memoizedState</span>: <span class="title class_">Hook</span> | <span class="title class_">StateObject</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">dependencies</span>: <span class="title class_">Dependencies</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">mode</span>: <span class="title class_">TypeOfMode</span>,</span><br><span class="line">  <span class="attr">effectTag</span>: <span class="title class_">SideEffectTag</span>,</span><br><span class="line">  <span class="attr">nextEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">firstEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">lastEffect</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="attr">lanes</span>: <span class="title class_">Lanes</span>,</span><br><span class="line">  <span class="attr">childLanes</span>: <span class="title class_">Lanes</span>,</span><br><span class="line">  <span class="attr">alternate</span>: <span class="title class_">Fiber</span> | <span class="literal">null</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>根据提供的 Fiber 类型定义，下面是完整的 Fiber 节点的属性列表：</p>
<ol>
<li><p><strong>tag</strong>：</p>
<ul>
<li>标识 Fiber 节点的类型，如 <code>HostComponent</code>、<code>ClassComponent</code>、<code>FunctionComponent</code> 等。</li>
</ul>
</li>
<li><p><strong>key</strong>：</p>
<ul>
<li>用于在DOM更新期间识别节点。可以是字符串类型或 null。</li>
</ul>
</li>
<li><p><strong>elementType</strong>：</p>
<ul>
<li>元素类型，通常是 <code>React.createElement()</code> 中传递的类型，用于保持节点的身份。</li>
</ul>
</li>
<li><p><strong>type</strong>：</p>
<ul>
<li>节点的具体类型，与 elementType 相似，但对于 ClassComponent 等需要再次处理。</li>
</ul>
</li>
<li><p><strong>stateNode</strong>：</p>
<ul>
<li>与此 Fiber 节点关联的实际 DOM 节点、组件实例或其他实体。</li>
</ul>
</li>
<li><p><strong>return</strong>：</p>
<ul>
<li>指向此节点的父节点。</li>
</ul>
</li>
<li><p><strong>child</strong>：</p>
<ul>
<li>指向此节点的第一个子节点。</li>
</ul>
</li>
<li><p><strong>sibling</strong>：</p>
<ul>
<li>指向此节点的下一个兄弟节点。</li>
</ul>
</li>
<li><p><strong>index</strong>：</p>
<ul>
<li>表示节点在兄弟节点中的位置索引。</li>
</ul>
</li>
<li><p><strong>ref</strong>：</p>
<ul>
<li>表示与此节点关联的 ref，可以是函数、字符串或 RefObject 对象。</li>
</ul>
</li>
<li><p><strong>refCleanup</strong>：</p>
<ul>
<li>用于清理 ref 的函数。</li>
</ul>
</li>
<li><p><strong>pendingProps</strong>：</p>
<ul>
<li>待处理的属性，即将应用于此节点的属性。</li>
</ul>
</li>
<li><p><strong>memoizedProps</strong>：</p>
<ul>
<li>表示此节点最近一次渲染时应用的属性。</li>
</ul>
</li>
<li><p><strong>updateQueue</strong>：</p>
<ul>
<li>包含了所有待处理的更新操作。</li>
</ul>
</li>
<li><p><strong>memoizedState</strong>：</p>
<ul>
<li>上一次渲染时的状态。如果组件使用了 Hooks，那么 memoizedState 就应该是一个链表结构，每个节点表示一个 Hook 的状态值。如果组件是类组件，则 memoizedState 应该是该组件在上一次渲染时的状态对象。</li>
</ul>
</li>
<li><p><strong>dependencies</strong>：</p>
<ul>
<li>表示此节点更新所依赖的上下文、Props、State等信息。</li>
</ul>
</li>
<li><p><strong>mode</strong>：</p>
<ul>
<li>表示当前渲染模式，如并发模式。</li>
</ul>
</li>
<li><p><strong>flags</strong>：</p>
<ul>
<li>描述 Fiber 节点和其子树的一些属性的位标志，用于标记节点需要执行的操作。</li>
</ul>
</li>
<li><p><strong>subtreeFlags</strong>：</p>
<ul>
<li>描述 Fiber 子树的属性的位标志，用于标记节点需要执行的操作。</li>
</ul>
</li>
<li><p><strong>deletions</strong>：</p>
<ul>
<li>用于存储要删除的 Fiber 节点。</li>
</ul>
</li>
<li><p><strong>lanes</strong>：</p>
<ul>
<li>表示此节点的调度优先级。</li>
</ul>
</li>
<li><p><strong>childLanes</strong>：</p>
<ul>
<li>表示此节点子树中的调度优先级。</li>
</ul>
</li>
<li><p><strong>alternate</strong>：</p>
<ul>
<li>指向上一次渲染时与当前 Fiber 节点对应的 Fiber 节点。</li>
</ul>
</li>
<li><p><strong>actualDuration</strong>：</p>
<ul>
<li>当前渲染阶段的实际持续时间，用于性能分析。</li>
</ul>
</li>
<li><p><strong>actualStartTime</strong>：</p>
<ul>
<li>当前渲染阶段的开始时间，用于性能分析。</li>
</ul>
</li>
<li><p><strong>selfBaseDuration</strong>：</p>
<ul>
<li>最近一次渲染阶段的持续时间，不包括子节点。</li>
</ul>
</li>
<li><p><strong>treeBaseDuration</strong>：</p>
<ul>
<li>所有子节点渲染阶段持续时间的总和。</li>
</ul>
</li>
<li><p><strong>_debugInfo</strong>：</p>
<ul>
<li>用于调试的附加信息。</li>
</ul>
</li>
<li><p><strong>_debugOwner</strong>：</p>
<ul>
<li>指向此节点的拥有者。</li>
</ul>
</li>
<li><p><strong>_debugIsCurrentlyTiming</strong>：</p>
<ul>
<li>标志位，指示当前是否正在记录渲染时间。</li>
</ul>
</li>
<li><p><strong>_debugNeedsRemount</strong>：</p>
<ul>
<li>标志位，指示是否需要重新挂载组件。</li>
</ul>
</li>
<li><p><strong>_debugHookTypes</strong>：</p>
<ul>
<li>用于调试的 hook 类型信息。</li>
</ul>
</li>
</ol>
<p>这些属性组成了 Fiber 节点的完整表示，用于 React 内部的渲染和更新过程。</p>
<h3 id="属性详解"><a href="#属性详解" class="headerlink" title="属性详解"></a>属性详解</h3><h4 id="tag"><a href="#tag" class="headerlink" title="tag"></a>tag</h4><p>tag 属性表示 Fiber 节点的类型，其值可以是以下几种之一：</p>
<ul>
<li><strong>HostRoot:</strong> 表示根节点。</li>
<li><strong>FunctionComponent:</strong> 表示函数组件。</li>
<li><strong>ClassComponent:</strong> 表示类组件。</li>
<li><strong>HostComponent:</strong> 表示 DOM 元素。</li>
<li><strong>ContextProvider:</strong> 表示 Context 提供者。</li>
<li><strong>ContextConsumer:</strong> 表示 Context 消费者。</li>
<li><strong>SuspenseComponent:</strong> 表示 Suspense 组件。</li>
<li><strong>DehydratedFragment:</strong> 表示脱水片段。</li>
</ul>
<h4 id="memoizedState"><a href="#memoizedState" class="headerlink" title="memoizedState"></a>memoizedState</h4><p>memoizedState 属性表示组件在上一次渲染时的状态，其类型根据组件的具体情况而定。如果组件使用了 Hooks，那么 memoizedState 就应该是一个链表结构，每个节点表示一个 Hook 的状态值。如果组件是类组件，则 memoizedState 应该是该组件在上一次渲染时的状态对象。memoizedState 具体的属性如下所示</p>
<ul>
<li><strong>memoizedState:</strong> 组件的记忆状态，即上次渲染时的状态。</li>
<li><strong>next:</strong> 指向下一个 hook 节点的指针。</li>
</ul>
<h4 id="flags"><a href="#flags" class="headerlink" title="flags"></a>flags</h4><p>flags 属性用于标记节点需要执行的操作，其值是一个位掩码，描述 Fiber 节点的不同状态和行为，并在调度和渲染过程中起着重要作用，包含以下几种标记：</p>
<p>这里有一些重要的标志位和常量的含义：</p>
<ul>
<li><strong>NoFlags:</strong> 用于表示没有任何状态或行为。</li>
<li><strong>Update:</strong> 表示组件需要更新。</li>
<li><strong>Placement:</strong> 表示组件需要被放置到 DOM 树中。</li>
<li><strong>ChildDeletion:</strong> 表示组件的子节点被删除。</li>
<li><strong>Callback:</strong> 表示需要执行回调函数。</li>
<li><strong>Visibility:</strong> 表示组件的可见性发生变化。</li>
<li><strong>Ref:</strong> 表示组件的引用发生变化。</li>
<li><strong>Snapshot:</strong> 表示需要获取组件的快照。</li>
<li><strong>Passive:</strong> 表示组件处于被动模式。</li>
<li><strong>StoreConsistency:</strong> 表示需要保持状态的一致性。</li>
</ul>
<blockquote>
<p>以前使用 <code>effectTag</code> 属性来表示副作用。</p>
</blockquote>
<h3 id="源码解析"><a href="#源码解析" class="headerlink" title="源码解析"></a>源码解析</h3><p>React Fiber 的源码位于 React 源码库中的 <code>react-reconciler</code> 模块。读者可以在该模块中找到 Fiber 结构的定义以及相关的操作和算法实现。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>本文浅入解析了 React Fiber 结构，介绍了其所有属性及其含义，并对对象类型的属性进行了进一步说明和解释。通过深入理解 Fiber 结构，可以更好地理解 React 内部的工作原理，并能够更加高效地使用 React 进行开发。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/react/" rel="tag">react</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/24/react-fiber-struct/" data-id="clw71kuue0012qqoqed0bdkn6" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-communication-across-browser-tabs" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/20/communication-across-browser-tabs/" class="article-date">
  <time datetime="2024-04-20T20:20:20.000Z" itemprop="datePublished">2024-04-20</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/20/communication-across-browser-tabs/">跨浏览器标签页进行通讯的方式简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="跨浏览器标签页进行通讯的方式简介"><a href="#跨浏览器标签页进行通讯的方式简介" class="headerlink" title="跨浏览器标签页进行通讯的方式简介"></a>跨浏览器标签页进行通讯的方式简介</h2><p>在现代 <code>Web</code> 应用程序中，跨浏览器标签页之间进行通讯是一项重要的功能。无论是在多标签页应用程序中同步状态，还是在不同浏览器窗口之间共享数据，实现跨标签页通讯都是必不可少的。在本文中，我们将探讨跨浏览器标签页进行通讯的各种方式，并详细介绍每种方式的 <code>API</code> 和使用场景。</p>
<h3 id="所有方法"><a href="#所有方法" class="headerlink" title="所有方法"></a>所有方法</h3><ol>
<li>使用 <code>Web Storage API</code></li>
<li>使用 <code>Broadcast Channel API</code></li>
<li>使用 <code>SharedWorker</code></li>
<li>使用 <code>Service Worker</code></li>
<li>使用 <code>WebSocket</code></li>
<li>使用 <code>PostMessage API</code></li>
<li>使用 <code>IndexedDB</code></li>
</ol>
<h3 id="Web-Storage-API"><a href="#Web-Storage-API" class="headerlink" title="Web Storage API"></a>Web Storage API</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Web Storage API</code> 提供了一种在客户端存储数据的方法，包括 <code>localStorage</code> 和 <code>sessionStorage</code> 两种方式。它们可以在不同的浏览器标签页之间共享数据，而不受页面刷新或关闭的影响。</li>
<li><strong>优点</strong>：简单易用，支持持久化存储。</li>
<li><strong>缺点</strong>：只能存储字符串类型的数据，且容量有限。</li>
<li><strong>适用场景</strong>：适合存储小型数据，如用户偏好设置或临时状态。</li>
</ul>
<h4 id="API"><a href="#API" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>localStorage</strong>: 保存的数据没有过期时间，可以一直存在于浏览器中。</li>
<li><strong>sessionStorage</strong>: 保存的数据在浏览器会话结束时被清除，适合临时存储数据。</li>
</ul>
<h4 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在同一浏览器的不同标签页中共享数据。</li>
<li>存储用户首选项或状态信息。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Web Storage Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;saveData()&quot;</span>&gt;</span>Save Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(<span class="string">&#x27;data&#x27;</span>, input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(data);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;Data changed in another tab: &#x27;</span> + event.<span class="property">newValue</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data from Main Page<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> data = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(data);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;storage&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;Data changed in another tab: &#x27;</span> + event.<span class="property">newValue</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。同时，当一个标签页修改了 localStorage 的值，另一个标签页也会收到通知。</p>
<h3 id="Broadcast-Channel-API"><a href="#Broadcast-Channel-API" class="headerlink" title="Broadcast Channel API"></a>Broadcast Channel API</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Broadcast Channel API</code> 允许在不同的浏览器标签页之间进行实时通信，通过创建一个共享的消息通道来传递数据。</li>
<li><strong>优点</strong>：支持实时通信，消息发送和接收都非常简单。</li>
<li><strong>缺点</strong>：不支持 <code>IE</code> 浏览器。</li>
<li><strong>适用场景</strong>：适合需要实时通讯的场景，如多标签页间的数据同步。</li>
</ul>
<h4 id="API-1"><a href="#API-1" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>BroadcastChannel</strong>: 创建一个用于跨文档通信的通道。</li>
</ul>
<h4 id="使用场景-1"><a href="#使用场景-1" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同的浏览器标签页之间传递消息。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Broadcast Channel Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="string">&#x27;channel&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            channel.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> channel = <span class="keyword">new</span> <span class="title class_">BroadcastChannel</span>(<span class="string">&#x27;channel&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        channel.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">textContent</span> = event.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="SharedWorker"><a href="#SharedWorker" class="headerlink" title="SharedWorker"></a>SharedWorker</h3><h4 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>SharedWorker</code> 允许在多个浏览器上下文之间共享同一个 <code>Worker</code> 实例，提供了一种全局范围的通讯机制。</li>
<li><strong>优点</strong>：支持多标签页之间的实时通信，可以与所有标签页共享相同的数据。</li>
<li><strong>缺点</strong>：不支持 <code>IE</code> 浏览器。</li>
<li><strong>适用场景</strong>：适合需要共享状态或实现实时通讯的场景。</li>
</ul>
<h4 id="API-2"><a href="#API-2" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>SharedWorker</strong>: 创建一个共享的 <code>Web Worker</code> 实例，可以被多个浏览上下文共享。</li>
</ul>
<h4 id="使用场景-2"><a href="#使用场景-2" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同浏览器标签页之间共享数据或进行通讯。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>SharedWorker Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> worker = <span class="keyword">new</span> <span class="title class_">SharedWorker</span>(<span class="string">&#x27;worker.js&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            worker.<span class="property">port</span>.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        worker.<span class="property">port</span>.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// worker.js</span></span><br><span class="line"><span class="keyword">const</span> ports = [];</span><br><span class="line"></span><br><span class="line">onconnect = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> port = event.<span class="property">ports</span>[<span class="number">0</span>];</span><br><span class="line">    ports.<span class="title function_">push</span>(port);</span><br><span class="line">    port.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">const</span> message = event.<span class="property">data</span>;</span><br><span class="line">        ports.<span class="title function_">forEach</span>(<span class="function"><span class="params">port</span> =&gt;</span> port.<span class="title function_">postMessage</span>(message));</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="Service-Worker"><a href="#Service-Worker" class="headerlink" title="Service Worker"></a>Service Worker</h3><h4 id="简介-3"><a href="#简介-3" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>Service Worker</code> 是一种在浏览器后台运行的脚本，可以拦截和处理网络请求，并实现离线缓存和推送通知等功能。</li>
<li><strong>优点</strong>：支持后台运行，可以拦截网络请求，实现离线缓存和推送通知。</li>
<li><strong>缺点</strong>：只能用于现代浏览器，且需要 <code>HTTPS</code> 支持。</li>
<li><strong>适用场景</strong>：适合需要离线访问或推送通知的场景，如聊天应用或离线应用。</li>
</ul>
<h4 id="API-3"><a href="#API-3" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>Service Worker</strong>: 在后台运行的脚本，可以拦截和处理网络请求，并进行推送通知等功能。</li>
</ul>
<h4 id="使用场景-3"><a href="#使用场景-3" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同标签页之间共享数据或进行通讯。</li>
<li>实现离线缓存和推送通知。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Service Worker Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 注册 Service Worker</span></span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">serviceWorker</span>.<span class="title function_">register</span>(<span class="string">&#x27;sw.js&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 发送消息</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            navigator.<span class="property">serviceWorker</span>.<span class="property">controller</span>.<span class="title function_">postMessage</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="comment">// 监听消息</span></span></span><br><span class="line"><span class="language-javascript">        navigator.<span class="property">serviceWorker</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// sw.js</span></span><br><span class="line">self.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> message = event.<span class="property">data</span>;</span><br><span class="line">    clients.<span class="title function_">matchAll</span>().<span class="title function_">then</span>(<span class="function"><span class="params">clients</span> =&gt;</span> &#123;</span><br><span class="line">        clients.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> client.<span class="title function_">postMessage</span>(message));</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="WebSocket"><a href="#WebSocket" class="headerlink" title="WebSocket"></a>WebSocket</h3><h4 id="简介-4"><a href="#简介-4" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>WebSocket</code> 提供了一种在客户端和服务器之间建立持久连接的方式，实现了双向通信。</li>
<li><strong>优点</strong>：支持双向通信，可以实现实时通讯。</li>
<li><strong>缺点</strong>：需要在服务器端实现 <code>WebSocket</code> 服务，且不支持跨域请求。</li>
<li><strong>适用场景</strong>：适合实时通讯场景，如聊天应用或在线游戏。</li>
</ul>
<h4 id="API-4"><a href="#API-4" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>WebSocket</strong>: 在客户端和服务器之间建立持久连接，实现双向通信。</li>
</ul>
<h4 id="使用场景-4"><a href="#使用场景-4" class="headerlink" title="使用场景"></a>使用场景</h4><p>在不同浏览器标签页之间进行实时通讯。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// server.js</span></span><br><span class="line"><span class="keyword">const</span> <span class="title class_">WebSocket</span> = <span class="built_in">require</span>(<span class="string">&#x27;ws&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> wss = <span class="keyword">new</span> <span class="title class_">WebSocket</span>.<span class="title class_">Server</span>(&#123; <span class="attr">port</span>: <span class="number">8080</span> &#125;);</span><br><span class="line"></span><br><span class="line">wss.<span class="title function_">on</span>(<span class="string">&#x27;connection&#x27;</span>, <span class="function"><span class="params">ws</span> =&gt;</span> &#123;</span><br><span class="line">    ws.<span class="title function_">on</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">message</span> =&gt;</span> &#123;</span><br><span class="line">        wss.<span class="property">clients</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">client</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (client !== ws &amp;&amp; client.<span class="property">readyState</span> === <span class="title class_">WebSocket</span>.<span class="property">OPEN</span>) &#123;</span><br><span class="line">                client.<span class="title function_">send</span>(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>WebSocket Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> socket = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            socket.<span class="title function_">send</span>(input);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        socket.<span class="property">onmessage</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(event.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入消息并发送，在另一个页面中接收并显示消息。</p>
<h3 id="PostMessage-API"><a href="#PostMessage-API" class="headerlink" title="PostMessage API"></a>PostMessage API</h3><h4 id="简介-5"><a href="#简介-5" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>PostMessage API</code> 允许跨文档之间安全地传递消息，可以实现跨域通信。</li>
<li><strong>优点</strong>：支持跨域通信，使用简单。</li>
<li><strong>缺点</strong>：需要对接收消息的文档进行信任验证，存在安全风险。</li>
<li><strong>适用场景</strong>：适合不同域名之间的数据交换或通信。</li>
</ul>
<h4 id="API-5"><a href="#API-5" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>window.postMessage()</strong>: 向其他窗口发送消息。</li>
</ul>
<h4 id="使用场景-5"><a href="#使用场景-5" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>在不同窗口之间进行跨域通信。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>PostMessage Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;sendMessage()&quot;</span>&gt;</span>Send Message<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> popup = <span class="variable language_">window</span>.<span class="title function_">open</span>(<span class="string">&#x27;another-page.html&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">sendMessage</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            popup.<span class="title function_">postMessage</span>(input, <span class="string">&#x27;*&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;message&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;message&#x27;</span>, <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;message&#x27;</span>).<span class="property">textContent</span> = event.<span class="property">data</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;);</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。</p>
<h3 id="IndexedDB"><a href="#IndexedDB" class="headerlink" title="IndexedDB"></a>IndexedDB</h3><h4 id="简介-6"><a href="#简介-6" class="headerlink" title="简介"></a>简介</h4><ul>
<li><strong>简介</strong>：<code>IndexedDB</code> 提供了一个异步的、事务型的数据库，适用于存储大量结构化数据。</li>
<li><strong>优点</strong>：支持存储大量结构化数据，数据存储在客户端本地。</li>
<li><strong>缺点</strong>：使用复杂，需要学习 <code>IndexedDB</code> 的 <code>API</code>。</li>
<li><strong>适用场景</strong>：适合需要存储大量结构化数据的场景，如离线应用或数据分析应用。</li>
</ul>
<h4 id="API-6"><a href="#API-6" class="headerlink" title="API"></a>API</h4><ul>
<li><strong>IndexedDB</strong>: 提供了一个异步的、事务型的数据库。</li>
</ul>
<h4 id="使用场景-6"><a href="#使用场景-6" class="headerlink" title="使用场景"></a>使用场景</h4><ul>
<li>存储大量结构化数据，如离线应用程序的数据。</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- index.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>IndexedDB Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;input&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;saveData()&quot;</span>&gt;</span>Save Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&#x27;myDatabase&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        request.<span class="property">onupgradeneeded</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = db.<span class="title function_">createObjectStore</span>(<span class="string">&#x27;data&#x27;</span>, &#123; <span class="attr">keyPath</span>: <span class="string">&#x27;id&#x27;</span> &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">saveData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;input&#x27;</span>).<span class="property">value</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = request.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readwrite&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            objectStore.<span class="title function_">add</span>(&#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">data</span>: input &#125;);</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> db = request.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readonly&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> request = objectStore.<span class="title function_">get</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">            request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> data = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="title function_">alert</span>(data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- another-page.html --&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>Another Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">&quot;getData()&quot;</span>&gt;</span>Get Data from Main Page<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">function</span> <span class="title function_">getData</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">const</span> request = indexedDB.<span class="title function_">open</span>(<span class="string">&#x27;myDatabase&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> db = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> transaction = db.<span class="title function_">transaction</span>(<span class="string">&#x27;data&#x27;</span>, <span class="string">&#x27;readonly&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> objectStore = transaction.<span class="title function_">objectStore</span>(<span class="string">&#x27;data&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">const</span> request = objectStore.<span class="title function_">get</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">                request.<span class="property">onsuccess</span> = <span class="function"><span class="params">event</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">const</span> data = event.<span class="property">target</span>.<span class="property">result</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">alert</span>(data.<span class="property">data</span>);</span></span><br><span class="line"><span class="language-javascript">                &#125;;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在一个页面中输入数据并保存，然后在另一个页面中点击按钮获取数据。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>在本文中，我们介绍了跨浏览器标签页进行通讯的多种方式，并提供了详细的 <code>API</code> 和使用场景。根据您的具体需求和项目要求</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html/" rel="tag">html</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/" rel="tag">html5</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/20/communication-across-browser-tabs/" data-id="clw71kuty0005qqoq74e684ft" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-webrtc" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/16/webrtc/" class="article-date">
  <time datetime="2024-04-16T16:16:16.000Z" itemprop="datePublished">2024-04-16</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/16/webrtc/">WebRTC:实时通信的未来</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h2><p>在当今数字化的世界中，实时通信变得越来越重要。从视频会议到在线游戏，从远程医疗到物联网设备，人们希望能够立即与其他人或设备进行交流和互动。<code>WebRTC（Web Real-Time Communication）</code> 技术的出现填补了这一需求，为Web应用程序提供了强大的实时通信能力。本文将深入探讨 <code>WebRTC</code> 技术的原理、应用场景以及实现细节，带您了解这一引人注目的技术。</p>
<h2 id="什么是WebRTC？"><a href="#什么是WebRTC？" class="headerlink" title="什么是WebRTC？"></a>什么是WebRTC？</h2><p><code>WebRTC</code> 是一种开放标准的实时通信技术，允许浏览器之间进行点对点的音频、视频和数据传输，而无需任何插件或附加软件。它是由Google、Mozilla和Opera等公司发起的一个开放源代码项目，旨在为Web应用程序提供实时通信的能力。</p>
<h2 id="WebRTC的核心特性"><a href="#WebRTC的核心特性" class="headerlink" title="WebRTC的核心特性"></a>WebRTC的核心特性</h2><ol>
<li><p>实时性<br><code>WebRTC</code> 提供了实时的音频和视频传输能力，使用户可以在几乎没有延迟的情况下进行实时通信。这种实时性对于视频会议、在线教育和远程医疗等应用非常重要。</p>
</li>
<li><p>安全性<br><code>WebRTC</code> 通过使用加密技术来保护通信内容的安全性。它使用 <code>DTLS（Datagram Transport Layer Security）</code>协议来保护数据传输的隐私，并使用 <code>SRTP（Secure Real-time Transport Protocol）</code>协议来加密音频和视频数据。</p>
</li>
<li><p>去中心化<br><code>WebRTC</code> 采用了点对点（<code>P2P</code>）通信模型，即浏览器之间直接进行通信，而不需要经过中间服务器。这种去中心化的通信方式可以提高通信的效率，并减少了对服务器资源的依赖。</p>
</li>
<li><p>跨平台<br><code>WebRTC</code> 可以在各种平台上运行，包括桌面浏览器、移动浏览器和原生应用程序。这使得开发人员可以轻松地创建跨平台的实时通信应用程序。</p>
</li>
</ol>
<h2 id="名词和方法解释"><a href="#名词和方法解释" class="headerlink" title="名词和方法解释"></a>名词和方法解释</h2><h3 id="RTCPeerConnection"><a href="#RTCPeerConnection" class="headerlink" title="RTCPeerConnection"></a>RTCPeerConnection</h3><p><code>RTCPeerConnection</code> 是 <code>WebRTC API</code> 中的一个关键接口，用于在两个对等端之间建立点对点连接。它提供了一种实现浏览器之间实时音视频通信的方式，允许在不同浏览器之间直接传输数据，而无需通过服务器。通过 <code>RTCPeerConnection</code>，用户可以在浏览器中创建一个实时通信的会话，并在其中发送和接收音频、视频或其他任何类型的数据。</p>
<h4 id="作用"><a href="#作用" class="headerlink" title="作用"></a>作用</h4><p><code>RTCPeerConnection</code> 的主要作用包括：</p>
<ol>
<li><p>建立和管理对等连接：<code>RTCPeerConnection</code> 提供了一种方法来建立和管理两个浏览器之间的点对点连接，使它们可以直接通信，无需通过中间服务器。</p>
</li>
<li><p>处理媒体流：它允许用户将本地音频、视频或数据流发送到远程对等端，并从远程对等端接收相应的媒体流。</p>
</li>
<li><p>网络协商和协议处理：<code>RTCPeerConnection</code> 处理与 <code>ICE</code>、<code>SDP</code> 等相关的网络协商和协议处理，以确保对等连接的正确建立和维护。</p>
</li>
<li><p>实现信号传输和媒体传输：它还负责在对等连接之间传输信令消息和媒体数据，以确保通信的顺利进行。</p>
</li>
</ol>
<h4 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h4><p><code>RTCPeerConnection</code> 构造函数包含的1个参数，一个 <code>RTCConfiguration</code> 对象，用于指定配置参数。这个对象包含以下属性：</p>
<ul>
<li><strong>iceServers</strong>：一个 <code>RTCIceServer</code> 对象数组，用于指定 <code>ICE</code> 服务器信息。<ul>
<li><code>urls</code>：<code>ICE</code> 服务器的 <code>URL</code> 或 <code>URL</code> 数组。</li>
<li><code>username</code> (可选)：<code>ICE</code> 服务器的用户名。</li>
<li><code>credential</code> (可选)：<code>ICE</code> 服务器的密码。</li>
</ul>
</li>
<li><strong>iceTransportPolicy</strong> (可选)：一个枚举值，用于指定 <code>ICE</code> 传输策略，默认为 <code>&quot;all&quot;</code>，目前支持的值有 <code>&quot;all&quot;</code> | <code>&quot;relay&quot;</code>。</li>
<li><strong>bundlePolicy</strong> (可选)：一个枚举值，用于指定 <code>SDP</code> 处理策略，默认为 <code>&quot;balanced&quot;</code>，目前支持的值有 <code>&quot;balanced&quot;</code> | <code>&quot;max-bundle&quot;</code> | <code>&quot;max-compat&quot;</code>。</li>
<li><strong>rtcpMuxPolicy</strong> (可选)：一个枚举值，用于指定 <code>RTCP</code> 复用策略，默认为 <code>&quot;require&quot;</code>，目前支持的值有 <code>&quot;require&quot;</code>。</li>
<li><strong>peerIdentity</strong> (可选)：<code>PEER</code> 身份验证，默认为 null。</li>
<li><strong>certificates</strong> (可选)：一个 <code>RTCCertificate</code> 对象数组，用于指定本地证书数组。</li>
<li><strong>iceCandidatePoolSize</strong> (可选)：一个数值，指定 <code>ICE</code> 候选地址池的大小。</li>
</ul>
<h4 id="属性和方法"><a href="#属性和方法" class="headerlink" title="属性和方法"></a>属性和方法</h4><ol>
<li><strong>restartIce()</strong></li>
</ol>
<p><code>restartIce()</code> 方法用于在 <code>WebRTC</code> 对等连接中重新启动 <code>ICE</code> 连接过程。<code>ICE（Interactive Connectivity Establishment）</code>是一种用于建立对等连接的网络协议，它可以帮助确定网络上的最佳路径，以确保数据能够在两个 <code>RTCPeerConnection</code> 之间进行有效传输。</p>
<p>重新启动 <code>ICE</code> 连接过程通常在网络连接发生变化或连接质量变差时使用，以尝试建立更稳定的连接。这可能包括重新检测网络接口、重新收集 <code>ICE</code> 候选项、更新 <code>ICE Agent</code> 状态等操作。</p>
<p><code>restartIce()</code> 方法不接受任何参数，调用该方法将触发 <code>ICE</code> 连接重新启动过程。在调用此方法之后，<code>ICE Agent</code> 将重新开始收集候选项并尝试建立新的 <code>ICE</code> 连接。</p>
<p>下面是一个示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 重新启动 ICE 连接过程</span></span><br><span class="line">peerConnection.<span class="title function_">restartIce</span>();</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>setLocalDescription</strong><br><code>setLocalDescription()</code> 方法用于将本地描述（即 SDP，Session Description Protocol）设置为 <code>RTCPeerConnection</code> 对象的本地描述。本地描述包含了当前对等连接的配置信息，例如媒体类型、编解码器、传输协议等。</li>
</ol>
<p>通常情况下，当我们创建一个新的对等连接时，会先通过调用 <code>createOffer()</code> 或 <code>createAnswer()</code> 方法生成一个 SDP 描述，并将其设置为本地描述。然后，我们将本地描述发送给远程对等方，远程对等方通过调用 <code>setRemoteDescription()</code> 方法将其应用到对等连接中。这样，两个对等方就可以根据各自的本地描述进行协商，建立一条可靠的连接。</p>
<p>以下是一个简单的示例，展示了如何使用 <code>setLocalDescription()</code> 方法：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 RTCPeerConnection</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 SDP offer</span></span><br><span class="line">peerConnection.<span class="title function_">createOffer</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">offer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 设置本地描述为 SDP offer</span></span><br><span class="line">    <span class="keyword">return</span> peerConnection.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Local description set successfully.&quot;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error setting local description:&quot;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，我们首先创建了一个 SDP offer，然后调用 <code>setLocalDescription()</code> 方法将其设置为本地描述。成功设置本地描述后，我们会在控制台输出成功的消息。如果设置本地描述失败，则会捕获到错误并输出错误消息。</p>
<ol start="3">
<li><strong>setRemoteDescription</strong><br><code>setRemoteDescription()</code> 方法用于将远程对等连接的描述信息设置到本地对等连接中。这个描述信息通常是由远程对等方通过 SDP（Session Description Protocol）提供的，包含了远程对等方的媒体信息和网络连接信息。</li>
</ol>
<p>在 WebRTC 中，当本地对等连接收到远程对等方发送的 SDP offer 或 answer 时，需要通过 <code>setRemoteDescription()</code> 方法将其设置到本地对等连接中，以便进行后续的连接协商和媒体交换。</p>
<p>以下是一个简单的示例，展示了如何使用 <code>setRemoteDescription()</code> 方法将远程对等连接的描述信息设置到本地对等连接中：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设 remoteDescription 是远程对等连接的描述信息（SDP offer 或 answer）</span></span><br><span class="line"><span class="keyword">const</span> remoteDescription = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;offer&#x27;</span>, <span class="comment">// 描述类型为 SDP offer</span></span><br><span class="line">  <span class="attr">sdp</span>: <span class="string">&#x27;...&#x27;</span>     <span class="comment">// SDP offer 的内容</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置远程对等连接的描述信息到本地对等连接中</span></span><br><span class="line">peerConnection.<span class="title function_">setRemoteDescription</span>(remoteDescription)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Remote description set successfully.&#x27;</span>);</span><br><span class="line">    <span class="comment">// 在这里可以继续进行后续的连接协商或媒体交换操作</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error setting remote description:&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，我们假设 <code>remoteDescription</code> 是远程对等连接的描述信息，包含了描述的类型（这里假设为 SDP offer）和 SDP offer 的内容。然后，我们通过 <code>setRemoteDescription()</code> 方法将这个描述信息设置到本地对等连接中。如果设置成功，则会打印日志表示远程描述已成功设置，否则会捕获到错误并输出错误消息。</p>
<ol start="4">
<li><strong>addTransceiver</strong></li>
</ol>
<p><code>addTransceiver()</code> 方法用于向对等连接中添加新的媒体传输通道（<code>RTCRtpTransceiver</code>）。它的参数包括：</p>
<ul>
<li><strong>trackOrKind</strong>：要添加到传输通道的媒体轨道（<code>MediaStreamTrack</code>）或媒体类型（<code>string</code>）。如果是 <code>MediaStreamTrack</code> 类型，则表示要添加的具体媒体轨道。如果是 <code>string</code> 类型，则表示要添加的媒体类型，如 <code>&quot;audio&quot;</code> 或 <code>&quot;video&quot;</code>。</li>
<li><strong>init</strong>（可选）：一个可选的 <code>RTCRtpTransceiverInit</code> 对象，用于配置传输通道的初始化选项。该对象包括以下属性：<ul>
<li><code>direction</code>：传输通道的传输方向，可以是 <code>&quot;sendrecv&quot;</code>、<code>&quot;sendonly&quot;</code>、<code>&quot;recvonly&quot;</code> 或 <code>&quot;inactive&quot;</code>。</li>
<li><code>streams</code>：一个包含了要与传输通道关联的 <code>MediaStream</code> 对象的数组。</li>
<li><code>sendEncodings</code>：一个包含了与传输通道相关联的编码设置的数组，用于配置传输的编码参数。</li>
</ul>
</li>
</ul>
<p>该方法返回一个 <code>RTCRtpTransceiver</code> 对象，表示新添加的传输通道。这个传输通道可以用于控制和管理新添加的媒体流的传输。通过使用 <code>addTransceiver()</code> 方法，您可以动态地向对等连接中添加新的媒体轨道，从而实现更灵活和动态的媒体流管理。</p>
<h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h4><ol>
<li><strong>onnegotiationneeded</strong></li>
</ol>
<p><code>onnegotiationneeded</code> 事件是 <code>WebRTC</code> 中的一个事件，它在需要重新协商（<code>negotiation</code>）时触发。当需要创建或重新创建对等连接时（例如添加或删除数据流或轨道，或者更改连接配置），就会触发此事件。</p>
<p>在此事件触发时，通常会调用 <code>createOffer()</code> 或 <code>createAnswer()</code> 方法来生成一个新的 <code>SDP</code>（会话描述协议）以进行协商。然后，这个新的 <code>SDP</code> 将被传递给远程 <code>RTCPeerConnection</code>，以更新对等连接的配置。</p>
<p>以下是一个示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">peerConnection.<span class="property">onnegotiationneeded</span> = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> offer = <span class="keyword">await</span> peerConnection.<span class="title function_">createOffer</span>();</span><br><span class="line">    <span class="keyword">await</span> peerConnection.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">    <span class="comment">// 将 SDP 发送给远程 `RTCPeerConnection`</span></span><br><span class="line">    <span class="title function_">sendOfferToRemotePeer</span>(offer);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error creating offer:&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>在实际应用中，您可以根据需要在 <code>onnegotiationneeded</code> 事件中执行其他操作，例如创建或更新对等连接的配置，以确保连接的稳定性和可靠性。</p>
<ol start="2">
<li><strong>onicecandidate</strong><br><code>onicecandidate</code> 事件在 <code>ICE（Interactive Connectivity Establishment）</code>协商过程中生成 <code>ICE</code> 候选时触发。<code>ICE</code> 候选用于发现网络路径和连接两个 <code>RTCPeerConnection</code> 之间的传输地址。当本地 <code>RTCPeerConnection</code> 发现一个新的 <code>ICE</code> 候选时，会触发 <code>onicecandidate</code> 事件，并将候选信息传递给应用程序。</li>
</ol>
<p>通常，在收到 <code>ICE</code> 候选后，应用程序会将候选信息发送给远程 <code>RTCPeerConnection</code>，以便远程 <code>RTCPeerConnection</code> 能够知道如何直接与本地 <code>RTCPeerConnection</code> 进行通信。</p>
<p>以下是一个简单的示例，展示了如何使用 <code>onicecandidate</code> 事件处理程序：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建 RTCPeerConnection</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置 onicecandidate 事件处理程序</span></span><br><span class="line">peerConnection.<span class="property">onicecandidate</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (event.<span class="property">candidate</span>) &#123;</span><br><span class="line">    <span class="comment">// 将 ICE 候选发送给远程 `RTCPeerConnection`</span></span><br><span class="line">    <span class="title function_">sendIceCandidateToRemotePeer</span>(event.<span class="property">candidate</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// 所有 ICE 候选已发送</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;All ICE candidates have been sent.&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 开始 ICE 协商过程</span></span><br><span class="line">peerConnection.<span class="title function_">createOffer</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">offer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 设置本地描述</span></span><br><span class="line">    <span class="keyword">return</span> peerConnection.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&quot;Error creating offer:&quot;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<p>在上面的示例中，<code>onicecandidate</code> 事件处理程序将在每次发现新的 ICE 候选时被触发。在处理程序中，我们检查 <code>event.candidate</code> 是否存在，如果存在则将候选信息发送给远程 <code>RTCPeerConnection</code>。当 <code>event.candidate</code> 为 <code>null</code> 时，表示所有的 ICE 候选已经发现并发送完毕。</p>
<h3 id="RTCIceCandidate"><a href="#RTCIceCandidate" class="headerlink" title="RTCIceCandidate"></a>RTCIceCandidate</h3><p><code>RTCIceCandidate</code> 是 <code>WebRTC</code> 中的一个接口，表示 <code>ICE (Interactive Connectivity Establishment)</code> 候选者，用于描述网络中的地址信息，以帮助建立对等连接。以下是关于 <code>RTCIceCandidate</code> 接口的详细解释：</p>
<p><code>RTCIceCandidate</code> 表示一个 <code>ICE</code> 候选者，包含了描述网络地址的相关信息。</p>
<p><code>RTCIceCandidate</code> 是 <code>WebRTC</code> 中用于建立对等连接的关键组成部分，用于确定连接双方的网络地址和传输协议。</p>
<h4 id="参数-1"><a href="#参数-1" class="headerlink" title="参数"></a>参数</h4><p><code>RTCIceCandidate</code> 接口具体的参数如下所示：</p>
<ul>
<li><strong>candidate</strong>：描述 <code>ICE</code> 候选者的字符串，通常是以 <code>SDP (Session Description Protocol)</code> 格式表示的。该字符串包含了 <code>ICE</code> 候选者的网络地址、传输协议、优先级等信息。</li>
<li><strong>sdpMid</strong>：候选者所对应的媒体流的标识符，用于区分不同的媒体流。</li>
<li><strong>sdpMLineIndex</strong>：候选者所在的媒体流的索引，表示候选者属于媒体流描述中的哪一行。</li>
</ul>
<h4 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h4><p>下面是一个简单的例子，展示了如何创建一个 <code>RTCIceCandidate</code> 对象，并将其添加到 <code>RTCPeerConnection</code> 中。<code>ICE</code> 候选者通常是通过信令服务器交换的，用于建立对等连接并进行网络地址交换。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 Websocket 中收到的远端 RTCPeerConnection 的 ICE 候选者的的信息</span></span><br><span class="line"><span class="keyword">const</span> remoteIceCandidateInfo = &#123;</span><br><span class="line">  <span class="attr">candidate</span>: <span class="string">&#x27;candidate:1838085505 1 udp 2122260223 192.168.1.101 52041 typ host generation 0&#x27;</span>,</span><br><span class="line">  <span class="attr">sdpMid</span>: <span class="string">&#x27;audio&#x27;</span>,</span><br><span class="line">  <span class="attr">sdpMLineIndex</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个新的 ICE 候选者对象</span></span><br><span class="line"><span class="keyword">const</span> iceCandidate = <span class="keyword">new</span> <span class="title class_">RTCIceCandidate</span>(remoteIceCandidateInfo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将 ICE 候选者添加到本地的 PeerConnection</span></span><br><span class="line">peerConnection.<span class="title function_">addIceCandidate</span>(iceCandidate)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ICE 候选者添加成功&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;添加 ICE 候选者时出错：&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="RTCSessionDescription"><a href="#RTCSessionDescription" class="headerlink" title="RTCSessionDescription"></a>RTCSessionDescription</h3><p><code>RTCSessionDescription</code> 是 WebRTC API 中的一个重要接口，用于表示会话描述协议 (SDP) 中的一部分。SDP 是一种用于描述媒体会话的文本协议，包含了媒体流的相关信息，如编解码器、媒体类型、媒体格式、网络传输协议等。</p>
<p>在 WebRTC 中，<code>RTCSessionDescription</code> 主要用于描述通信会话中的两个关键部分：</p>
<ol>
<li><p><strong>描述远程媒体的信息</strong>：当一个端点（通常是浏览器）接收到来自远程端点（如另一个浏览器或媒体服务器）的 SDP 描述时，它会使用 <code>RTCSessionDescription</code> 对象来表示该描述。这个描述包含了远程端点发送的媒体流的相关信息，如编解码器、媒体类型、网络地址等。</p>
</li>
<li><p><strong>描述本地媒体的信息</strong>：同样地，当一个端点想要向远程端点发送媒体流时，它会创建一个 <code>RTCSessionDescription</code> 对象，其中包含了本地媒体流的描述信息。这个描述会随后通过信令传输给远程端点，以便它能够了解到本地端点要发送的媒体流的相关信息。</p>
</li>
</ol>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><p><code>RTCSessionDescription</code> 是 WebRTC 中用于描述会话信息的对象。它有两个主要属性：</p>
<ul>
<li><p><strong>type</strong>：描述会话的类型，通常是 <code>&quot;offer&quot;</code>、<code>&quot;answer&quot;</code> 或 <code>&quot;pranswer&quot;</code> 中的一个。</p>
<ul>
<li><code>&quot;offer&quot;</code>：表示发起一个会话描述，通常由发送方生成并发送给接收方。</li>
<li><code>&quot;answer&quot;</code>：表示响应一个会话描述，接收方收到 <code>&quot;offer&quot;</code> 后生成的响应。</li>
<li><code>&quot;pranswer&quot;</code>：表示暂时的会话描述，用于表示正在协商会话的过程中，尚未达成最终协议的描述。</li>
</ul>
</li>
<li><p><strong>sdp</strong>：会话描述协议 (SDP) 的文本内容，包含了媒体流的相关信息，如编解码器、媒体类型、传输协议等。</p>
</li>
</ul>
<h4 id="案例-1"><a href="#案例-1" class="headerlink" title="案例"></a>案例</h4><p>举个例子，一个典型的 <code>RTCSessionDescription</code> 对象可以看起来像这样：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 远端收到的Offer描述</span></span><br><span class="line"><span class="keyword">const</span> sessionDescription = &#123;</span><br><span class="line">  <span class="attr">type</span>: <span class="string">&#x27;offer&#x27;</span>,</span><br><span class="line">  <span class="attr">sdp</span>: <span class="string">&#x27;v=0\no=- 123456789 0 IN IP4 127.0.0.1\ns=...\nt=0 0\n...&#x27;</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// `setRemoteDescription()` 是 WebRTC 中 `RTCPeerConnection` 接口提供的方法之一，用于设置远端描述。它的作用是将远端的 Session Description（会话描述）应用到本地的 `RTCPeerConnection` 对象上，以建立或更新连接所需的各种参数和配置。</span></span><br><span class="line"><span class="comment">// 是一个异步操作，因为它可能需要与远端进行交互，解析和验证会话描述信息，并根据描述信息更新本地连接的状态。</span></span><br><span class="line">peerConnection.<span class="title function_">setRemoteDescription</span>(sessionDescription)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理成功设置远端描述后的逻辑</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理设置远端描述失败的逻辑</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="RTCCertificate"><a href="#RTCCertificate" class="headerlink" title="RTCCertificate"></a>RTCCertificate</h3><p><code>RTCCertificate</code> 是用于配置和管理 <code>WebRTC</code> 连接所使用的安全证书的接口。它可以用来指定本地端点的安全凭证，以确保通信的安全性和可靠性。</p>
<p><code>RTCCertificate</code> 接口本身并没有提供直接创建证书的方法。相反，<code>WebRTC API</code> 中的 <code>RTCPeerConnection.generateCertificate()</code> 方法用于生成新的证书。这个方法返回一个 <code>Promise</code>，在解析时会返回一个新的 <code>RTCCertificate</code> 实例，或者在生成证书时出现错误时返回一个错误对象。</p>
<h4 id="属性和方法-1"><a href="#属性和方法-1" class="headerlink" title="属性和方法"></a>属性和方法</h4><p><code>RTCCertificate</code> 接口没有提供构造函数来创建新的证书，而是通过 <code>createOffer()</code>、<code>createAnswer()</code> 等方法间接使用。它的主要属性和方法包括：</p>
<ul>
<li><code>expires</code>：表示证书的到期时间，以 <code>UNIX</code> 时间戳表示。</li>
<li><code>getFingerprints()</code>：返回一个包含证书指纹信息的数组。</li>
</ul>
<h4 id="案例-2"><a href="#案例-2" class="headerlink" title="案例"></a>案例</h4><p>以下是一个使用 <code>RTCPeerConnection.generateCertificate()</code> 方法生成证书的示例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// RSASSA-PKCS1-v1_5 算法</span></span><br><span class="line"><span class="keyword">let</span> stdRSACertificate = &#123;</span><br><span class="line">  <span class="comment">// name: 必需，指定生成证书所使用的算法名称。目前支持的值有 &quot;RSASSA-PKCS1-v1_5&quot;、&quot;RSA-PSS&quot; 和 &quot;ECDSA&quot;。</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;RSASSA-PKCS1-v1_5&quot;</span>,</span><br><span class="line">  <span class="comment">// modulusLength: 对于 RSA 算法，指定生成的 RSA 密钥的长度（以位为单位）。可选值为 1024、2048、4096 等。默认为 2048。</span></span><br><span class="line">  <span class="attr">modulusLength</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="comment">// publicExponent: 对于 RSA 算法，指定生成的 RSA 密钥的公共指数。可选值为 3、65537 等。默认为 65537。</span></span><br><span class="line">  <span class="attr">publicExponent</span>: <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">1</span>, <span class="number">0</span>, <span class="number">1</span>]),</span><br><span class="line">  <span class="comment">// hash: 对于 RSA 算法，指定用于签名的散列算法。可选值为 &quot;SHA-1&quot;、&quot;SHA-256&quot;、&quot;SHA-384&quot; 等。默认为 &quot;SHA-256&quot;。</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="string">&quot;SHA-256&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RSA-PSS 算法</span></span><br><span class="line"><span class="keyword">let</span> stdRSAPSSCertificate = &#123;</span><br><span class="line">  <span class="comment">// name: 必需，指定生成证书所使用的算法名称。目前支持的值有 &quot;RSASSA-PKCS1-v1_5&quot;、&quot;RSA-PSS&quot; 和 &quot;ECDSA&quot;。</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;RSA-PSS&#x27;</span>,</span><br><span class="line">  <span class="comment">// modulusLength: RSA 公钥的模数长度，即 N 的位数。一般来说，这个值越大，密钥的安全性就越高。典型的值为 2048 或 4096。</span></span><br><span class="line">  <span class="attr">modulusLength</span>: <span class="number">2048</span>,</span><br><span class="line">  <span class="comment">// publicExponent: RSA 公钥的指数部分，通常选择一个较小的质数，如 65537 (0x10001)。</span></span><br><span class="line">  <span class="attr">publicExponent</span>: <span class="keyword">new</span> <span class="title class_">Uint8Array</span>([<span class="number">0x01</span>, <span class="number">0x00</span>, <span class="number">0x01</span>]), <span class="comment">// 对应于十进制的65537</span></span><br><span class="line">  <span class="comment">// hash: 用于生成签名的哈希算法，如 SHA-256、SHA-384、SHA-512 等。</span></span><br><span class="line">  <span class="attr">hash</span>: <span class="string">&#x27;SHA-256&#x27;</span>,</span><br><span class="line">  <span class="comment">// saltLength: 签名中所使用的盐的长度，通常设置为哈希算法的输出长度。</span></span><br><span class="line">  <span class="attr">saltLength</span>: <span class="number">32</span> <span class="comment">// 假设使用32字节的盐</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ECDSA 算法</span></span><br><span class="line"><span class="keyword">let</span> stdECDSACertificate = &#123;</span><br><span class="line">  <span class="comment">// name: 必需，指定生成证书所使用的算法名称。目前支持的值有 &quot;RSASSA-PKCS1-v1_5&quot;、&quot;RSA-PSS&quot; 和 &quot;ECDSA&quot;。</span></span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;ECDSA&quot;</span>,</span><br><span class="line">  <span class="comment">// namedCurve 是用于指定生成椭圆曲线数字签名算法 (ECDSA) 证书时所使用的椭圆曲线的参数。目前支持的值有 &quot;P-256&quot;、&quot;P-384&quot; 和 &quot;P-521&quot;。</span></span><br><span class="line">  <span class="attr">namedCurve</span>: <span class="string">&quot;P-256&quot;</span>,</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 RTCPeerConnection.generateCertificate() 方法生成新的证书</span></span><br><span class="line"><span class="keyword">const</span> certificatePromise = <span class="title class_">RTCPeerConnection</span>.<span class="title function_">generateCertificate</span>(stdECDSACertificate);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 处理生成证书的结果</span></span><br><span class="line">certificatePromise.<span class="title function_">then</span>(<span class="function">(<span class="params">certificate</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 生成证书成功，可以使用 certificate 对象</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;New certificate generated:&#x27;</span>, certificate);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 在这里可以使用生成的证书进行后续操作，例如创建 RTCPeerConnection 实例</span></span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 生成证书失败，输出错误信息</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error generating certificate:&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="RTCRtpTransceiver"><a href="#RTCRtpTransceiver" class="headerlink" title="RTCRtpTransceiver"></a>RTCRtpTransceiver</h3><p><code>RTCRtpTransceiver</code> 接口表示一个媒体传输通道，用于在 <code>WebRTC</code> 对等连接（<code>RTCPeerConnection</code>）中传输媒体流。每个传输通道可以处理一个或多个媒体流的发送和接收。</p>
<p><code>RTCRtpTransceiver</code> 接口通常由 <code>RTCPeerConnection</code> 对象的 <code>addTransceiver()</code> 方法创建，并在对等连接的创建和管理过程中使用。它提供了灵活的控制选项，使您能够更好地管理对等连接中的媒体流传输。</p>
<h4 id="属性-1"><a href="#属性-1" class="headerlink" title="属性"></a>属性</h4><p><code>RTCRtpTransceiver</code> 表示 <code>WebRTC</code> 对等连接（<code>RTCPeerConnection</code>）中的一个媒体传输通道，该对象包含的属性和方法如下所示：</p>
<ul>
<li><code>mid</code>：传输通道的标识符（MediaStream ID），在 SDP 中用于唯一标识传输通道。</li>
<li><code>receiver</code>：与传输通道相关联的接收器对象（<code>RTCReceiver</code>），用于接收远程媒体流。</li>
<li><code>sender</code>：与传输通道相关联的发送器对象（<code>RTCSender</code>），用于发送本地媒体流。</li>
<li><code>direction</code>：传输通道的传输方向，可以是 <code>&quot;sendrecv&quot;</code>、<code>&quot;sendonly&quot;</code>、<code>&quot;recvonly&quot;</code> 或 <code>&quot;inactive&quot;</code>。</li>
<li><code>currentDirection</code>：当前传输通道的传输方向。</li>
<li><code>stopped</code>：指示传输通道是否已停止的布尔值。</li>
</ul>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><ul>
<li><code>setCodecPreferences(codecs)</code>：设置传输通道的编解码器偏好，<code>codecs</code> 是通过 <code>RTCRtpSender.getCapabilities</code> 和 <code>RTCRtpReceiver.getCapabilities</code> 静态方法获得的编解码器。</li>
<li><code>stop()</code>：停止传输通道，不再发送或接收媒体流。</li>
</ul>
<p><code>RTCRtpSender</code> 和 <code>RTCRtpReceiver</code> 是 WebRTC API 中用于发送和接收媒体流的对象。</p>
<h3 id="RTCRtpSender："><a href="#RTCRtpSender：" class="headerlink" title="RTCRtpSender："></a>RTCRtpSender：</h3><p><code>RTCRtpSender</code> 接口表示 <code>RTCPeerConnection</code> 中的媒体发送器。它负责发送媒体流到远程对等方。</p>
<h4 id="属性-2"><a href="#属性-2" class="headerlink" title="属性"></a>属性</h4><ul>
<li><code>track</code>：成员属性，代表当前与 <code>RTCRtpSender</code> 相关联的 <code>MediaStreamTrack</code> 对象。可以是音频轨道或视频轨道。</li>
</ul>
<h4 id="方法-1"><a href="#方法-1" class="headerlink" title="方法"></a>方法</h4><ul>
<li><p><code>getParameters()</code>：成员方法，返回一个 <code>RTCRtpSendParameters</code> 对象，该对象包含了当前发送器的参数信息，如编码器设置等。</p>
</li>
<li><p><code>setParameters(parameters)</code>：成员方法，用于设置发送器的参数，例如修改编码器设置等。参数 <code>parameters</code> 是一个包含新参数的 <code>RTC RtpSendParameters</code> 对象。</p>
</li>
<li><p><code>replaceTrack(newTrack)</code>：成员方法，用于替换当前发送器的媒体轨道。可以用于在运行时更改发送的媒体类型（例如切换摄像头）。</p>
</li>
<li><p><code>getCapabilities(kind)</code>：静态方法，用于获取特定类型（音频或视频）的编解码器能力信息。参数 <code>kind</code> 可以是 “audio” 或 “video”。</p>
</li>
</ul>
<h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><p>以下是关于如何使用 <code>getCapabilities</code> 方法来获取编解码器能力信息的示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取视频编解码器能力信息</span></span><br><span class="line"><span class="keyword">const</span> videoCapabilities = <span class="title class_">RTCRtpSender</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;video&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Video Codecs:&quot;</span>, videoCapabilities.<span class="property">codecs</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取音频编解码器能力信息</span></span><br><span class="line"><span class="keyword">const</span> audioCapabilities = <span class="title class_">RTCRtpSender</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;audio&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Audio Codecs:&quot;</span>, audioCapabilities.<span class="property">codecs</span>);</span><br></pre></td></tr></table></figure>

<p>这段代码中，我们首先使用 <code>RTCRtpSender.getCapabilities</code> 方法来获取视频和音频编解码器的能力信息。然后，我们打印出返回的 <code>codecs</code> 属性，其中包含了关于支持的编解码器的详细信息，例如编解码器的类型、编码器和解码器参数等。</p>
<h3 id="RTCRtpReceiver："><a href="#RTCRtpReceiver：" class="headerlink" title="RTCRtpReceiver："></a>RTCRtpReceiver：</h3><p><code>RTCRtpReceiver</code> 接口表示 <code>RTCPeerConnection</code> 中的媒体接收器。它负责接收远程对等方发送的媒体流。</p>
<h4 id="属性-3"><a href="#属性-3" class="headerlink" title="属性"></a>属性</h4><ul>
<li><code>track</code>：属性，代表当前与 <code>RTCRtpReceiver</code> 相关联的 <code>MediaStreamTrack</code> 对象。可以是音频轨道或视频轨道。</li>
</ul>
<h4 id="方法-2"><a href="#方法-2" class="headerlink" title="方法"></a>方法</h4><ul>
<li><p><code>getParameters()</code>：成员方法，返回一个 <code>RTC RtpReceiveParameters</code> 对象，该对象包含了当前接收器的参数信息，如解码器设置等。</p>
</li>
<li><p><code>getContributingSources()</code>：成员方法，返回一个包含贡献源信息的数组，表示当前接收器接收到的媒体流的贡献者。</p>
</li>
<li><p><code>getStats()</code>：成员方法，返回一个 Promise，该 Promise 在解析后会提供有关接收器的统计信息。</p>
</li>
<li><p><code>getCapabilities(kind)</code>：静态方法，用于获取特定类型（音频或视频）的编解码器能力信息。参数 <code>kind</code> 可以是 “audio” 或 “video”。</p>
</li>
</ul>
<h4 id="示例-1"><a href="#示例-1" class="headerlink" title="示例"></a>示例</h4><p>以下是一个使用 <code>RTCRtpReceiver.getCapabilities</code> 方法来获取音频和视频编解码器能力信息的示例代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取视频编解码器能力信息</span></span><br><span class="line"><span class="keyword">const</span> videoCapabilities = <span class="title class_">RTCRtpReceiver</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;video&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Video Codecs:&quot;</span>, videoCapabilities.<span class="property">codecs</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取音频编解码器能力信息</span></span><br><span class="line"><span class="keyword">const</span> audioCapabilities = <span class="title class_">RTCRtpReceiver</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;audio&#x27;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Audio Codecs:&quot;</span>, audioCapabilities.<span class="property">codecs</span>);</span><br></pre></td></tr></table></figure>

<p>这段代码中，我们使用 <code>RTCRtpReceiver.getCapabilities</code> 方法来获取音频和视频编解码器的能力信息。在真实使用当中，我们可以设置传输的音视频的编解码器<br>然后，我们打印出返回的 <code>codecs</code> 属性，其中包含了关于支持的编解码器的详细信息，例如编解码器的类型、编码器和解码器参数等。</p>
<h3 id="其他名词术语解释"><a href="#其他名词术语解释" class="headerlink" title="其他名词术语解释"></a>其他名词术语解释</h3><p>当涉及到 WebRTC 和实时通信时，以下术语是很常见的：</p>
<ul>
<li><p><strong>SDP（Session Description Protocol）</strong>：会话描述协议，用于描述多媒体会话的参数，例如编解码器信息、媒体流传输方式等。在 WebRTC 中，SDP 用于建立和管理对等连接。</p>
</li>
<li><p><strong>RTCP（Real-Time Control Protocol）</strong>：实时控制协议，是用于在 RTP（实时传输协议）会话中提供控制和监控功能的协议。RTCP 主要用于传输统计信息和控制信息。</p>
</li>
<li><p><strong>RTP（Real-Time Transport Protocol）</strong>：实时传输协议，是一种用于在 IP 网络上传输多媒体数据的协议。RTP 通常与 RTCP 一起使用，用于在网络上传输音频和视频流。</p>
</li>
<li><p><strong>ICE（Interactive Connectivity Establishment）</strong>：交互式连接建立，是一种用于在两个设备之间建立网络连接的技术。ICE 使用一系列技术（包括 STUN、TURN 和 ICE）来克服网络地址转换（NAT）和防火墙等网络障碍。</p>
</li>
</ul>
<p>这些术语在 WebRTC 中起着至关重要的作用，它们共同构建了实时通信系统的基础。</p>
<h2 id="WebRTC的工作原理"><a href="#WebRTC的工作原理" class="headerlink" title="WebRTC的工作原理"></a>WebRTC的工作原理</h2><p><code>WebRTC（Web Real-Time Communication）</code> 是一项用于实现浏览器之间实时通信的开放标准技术。它允许在不需要额外插件的情况下，通过浏览器直接进行音频、视频和数据传输。<code>WebRTC</code> 技术的出现，极大地促进了在线会议、远程教育、视频直播等领域的发展。下面将深入探讨 <code>WebRTC</code> 的核心技术，包括<strong>媒体获取</strong>、<strong>媒体传输</strong>、<strong>信令交换</strong>以及<strong>NAT穿越</strong>等方面，并结合详细的例子进行说明。</p>
<h3 id="摄像头媒体获取（Media-Acquisition）"><a href="#摄像头媒体获取（Media-Acquisition）" class="headerlink" title="摄像头媒体获取（Media Acquisition）"></a>摄像头媒体获取（Media Acquisition）</h3><p><code>navigator.mediaDevices.getUserMedia()</code> 是 WebRTC 提供的方法之一，用于从用户的摄像头和麦克风中获取媒体流。它允许 Web 应用程序访问用户的音视频设备，并将其转换为可用于实时通信、音视频录制等目的的媒体流。</p>
<h4 id="示例代码"><a href="#示例代码" class="headerlink" title="示例代码"></a>示例代码</h4><p>以下是关于 <code>navigator.mediaDevices.getUserMedia()</code> 方法的例子：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">stream</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 获取到用户的音视频流</span></span><br><span class="line">    <span class="keyword">const</span> videoElement = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;localVideo&#x27;</span>);</span><br><span class="line">    videoElement.<span class="property">srcObject</span> = stream;</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;获取用户媒体设备失败：&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数说明"><a href="#参数说明" class="headerlink" title="参数说明"></a>参数说明</h4><ul>
<li><code>constraints</code> 是一个可选参数，用于指定获取媒体流的约束条件。</li>
<li>可以包含两个属性：<ul>
<li><code>video</code>：指定是否捕获视频。可以是布尔值或包含视频约束的对象。</li>
<li><code>audio</code>：指定是否捕获音频。可以是布尔值或包含音频约束的对象。</li>
</ul>
</li>
</ul>
<h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><ul>
<li><code>getUserMedia()</code> 方法返回一个 <code>Promise</code> 对象。</li>
<li>如果用户授权并成功获取媒体流，则 <code>Promise</code> 对象的 <code>then</code> 回调函数会被调用，并传递一个 <code>MediaStream</code> 对象作为参数，其中包含捕获的视频和&#x2F;或音频轨道。</li>
<li>如果用户拒绝权限或获取媒体流失败，则 <code>Promise</code> 对象的 <code>catch</code> 回调函数会被调用，并传递一个 <code>Error</code> 对象作为参数，其中包含错误的详细信息。</li>
</ul>
<h4 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h4><p>获取到媒体流后，您可以将其用于各种用途，例如：</p>
<ul>
<li>在 <code>&lt;video&gt;</code> 元素中播放捕获的视频流。</li>
<li>将视频流传输到远程对等端，实现实时视频通话或视频会议。</li>
<li>对音频流进行处理、录制或转发等操作。</li>
</ul>
<h4 id="权限和安全性"><a href="#权限和安全性" class="headerlink" title="权限和安全性"></a>权限和安全性</h4><ul>
<li>浏览器通常会在第一次调用 <code>getUserMedia()</code> 方法时向用户请求音视频设备的权限。</li>
<li>用户需要允许或拒绝权限请求，以控制是否允许网站访问其摄像头和麦克风。</li>
<li>为了保护用户隐私和安全，浏览器会限制某些情况下的媒体设备访问，例如当网页位于不安全的上下文中时。</li>
</ul>
<p>总的来说，<code>navigator.mediaDevices.getUserMedia()</code> 方法为开发者提供了一种方便的方式来获取用户的音视频流，从而实现各种实时音视频通信、录制和处理等功能。</p>
<h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>上面的代码演示了如何使用 <code>getUserMedia API</code> 获取用户的音视频流，并将其绑定到一个 <code>&lt;video&gt;</code> 元素上进行实时预览。通过这种方式，我们可以轻松地在浏览器中获取用户的音视频数据，为后续的通信做准备。</p>
<h3 id="桌面媒体获取（Media-Acquisition）"><a href="#桌面媒体获取（Media-Acquisition）" class="headerlink" title="桌面媒体获取（Media Acquisition）"></a>桌面媒体获取（Media Acquisition）</h3><p><code>navigator.mediaDevices.getDisplayMedia()</code> 是 WebRTC 提供的方法之一，用于获取屏幕共享流。它允许用户捕获屏幕上的内容并将其转换为媒体流，以便在 Web 应用程序中进行处理和展示。</p>
<h4 id="示例代码-1"><a href="#示例代码-1" class="headerlink" title="示例代码"></a>示例代码</h4><p>让我们详细解释一下这个方法的用法和相关概念：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getDisplayMedia</span>(constraints)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">stream</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理媒体流</span></span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 处理错误</span></span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="参数说明-1"><a href="#参数说明-1" class="headerlink" title="参数说明"></a>参数说明</h4><ul>
<li><code>constraints</code> 是一个可选参数，用于指定获取屏幕共享流的约束条件。</li>
<li>可以包含两个属性：<ul>
<li><code>video</code>：指定是否捕获视频。默认值为 <code>true</code>。</li>
<li><code>audio</code>：指定是否捕获音频。默认值为 <code>false</code>。</li>
</ul>
</li>
</ul>
<h4 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h4><ul>
<li><code>getDisplayMedia()</code> 方法返回一个 <code>Promise</code> 对象。</li>
<li>如果用户授权并成功获取屏幕共享流，则 <code>Promise</code> 对象的 <code>then</code> 回调函数会被调用，并传递一个 <code>MediaStream</code> 对象作为参数，其中包含屏幕共享的视频和&#x2F;或音频轨道。</li>
<li>如果用户拒绝权限或获取屏幕共享流失败，则 <code>Promise</code> 对象的 <code>catch</code> 回调函数会被调用，并传递一个 <code>Error</code> 对象作为参数，其中包含错误的详细信息。</li>
</ul>
<h4 id="用途-1"><a href="#用途-1" class="headerlink" title="用途"></a>用途</h4><p>获取到媒体流后，您可以将其用于各种用途，例如：</p>
<ul>
<li>在 <code>&lt;video&gt;</code> 元素中播放屏幕共享内容。</li>
<li>将屏幕共享流传输到远程对等端，实现屏幕共享功能。</li>
<li>对媒体流进行处理、录制或转发等操作。</li>
</ul>
<h4 id="权限和安全性-1"><a href="#权限和安全性-1" class="headerlink" title="权限和安全性"></a>权限和安全性</h4><ul>
<li>浏览器通常会在第一次调用 <code>getDisplayMedia()</code> 方法时向用户请求屏幕共享权限。</li>
<li>用户需要允许或拒绝权限请求，以控制是否允许网站捕获屏幕内容。</li>
<li>为了保护用户隐私和安全，浏览器会限制某些情况下的屏幕共享，例如当网页位于不安全的上下文中时。</li>
</ul>
<h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p><code>navigator.mediaDevices.getDisplayMedia()</code> 方法为开发者提供了一种方便的方式来获取屏幕共享流，从而实现屏幕录制、远程教学、视频会议等各种实时协作和分享功能。</p>
<h3 id="媒体传输（Media-Transmission）"><a href="#媒体传输（Media-Transmission）" class="headerlink" title="媒体传输（Media Transmission）"></a>媒体传输（Media Transmission）</h3><p><code>WebRTC</code> 的媒体传输主要涉及使用 <code>RTCPeerConnection</code> 建立点对点的连接，并将音视频数据传输给其他 <code>RTCPeerConnection</code>。这个过程涉及到 <code>ICE</code> 候选、会话描述等技术，以确保数据能够安全、高效地传输。</p>
<h4 id="示例代码-2"><a href="#示例代码-2" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个RTCPeerConnection对象</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加ICE候选</span></span><br><span class="line">peerConnection.<span class="property">onicecandidate</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> candidateObject = &#123;&#125;;</span><br><span class="line">  <span class="keyword">const</span> candidate = event.<span class="property">candidate</span>;</span><br><span class="line">  <span class="keyword">if</span> (!candidate) &#123;</span><br><span class="line">    log.<span class="title function_">debug</span>(<span class="string">&#x27;message: Gathered all candidates and sending END candidate&#x27;</span>);</span><br><span class="line">    candidateObject = &#123;</span><br><span class="line">      <span class="attr">sdpMLineIndex</span>: -<span class="number">1</span>,</span><br><span class="line">      <span class="attr">sdpMid</span>: <span class="string">&#x27;end&#x27;</span>,</span><br><span class="line">      <span class="attr">candidate</span>: <span class="string">&#x27;end&#x27;</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    candidateObject = &#123;</span><br><span class="line">      <span class="attr">sdpMLineIndex</span>: candidate.<span class="property">sdpMLineIndex</span>,</span><br><span class="line">      <span class="attr">sdpMid</span>: candidate.<span class="property">sdpMid</span>,</span><br><span class="line">      <span class="attr">candidate</span>: candidate.<span class="property">candidate</span>,</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">if</span> (!candidateObject.<span class="property">candidate</span>.<span class="title function_">match</span>(<span class="regexp">/a=/</span>)) &#123;</span><br><span class="line">      candidateObject.<span class="property">candidate</span> = <span class="string">`a=<span class="subst">$&#123;candidateObject.candidate&#125;</span>`</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 发送ICE候选给对方</span></span><br><span class="line">  socket.<span class="title function_">sendSDP</span>(</span><br><span class="line">    <span class="string">&#x27;connectionMessage&#x27;</span>,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">roomId</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: &#123;</span><br><span class="line">        <span class="attr">type</span>: <span class="string">&#x27;candidate&#x27;</span>,</span><br><span class="line">        <span class="attr">candidate</span>: candidateObject</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">browser</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加本地流</span></span><br><span class="line">navigator.<span class="property">mediaDevices</span>.<span class="title function_">getUserMedia</span>(&#123; <span class="attr">video</span>: <span class="literal">true</span>, <span class="attr">audio</span>: <span class="literal">true</span> &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">stream</span>) =&gt;</span> &#123;</span><br><span class="line">    stream.<span class="title function_">getTracks</span>().<span class="title function_">forEach</span>(<span class="function">(<span class="params">track</span>) =&gt;</span> &#123;</span><br><span class="line">      peerConnection.<span class="title function_">addTrack</span>(track, stream);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建Offer</span></span><br><span class="line">peerConnection.<span class="title function_">createOffer</span>()</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">(<span class="params">offer</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> peerConnection.<span class="title function_">setLocalDescription</span>(offer);</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 将Offer发送给对方</span></span><br><span class="line">    socket.<span class="title function_">sendSDP</span>(</span><br><span class="line">      <span class="string">&#x27;connectionMessage&#x27;</span>,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">roomId</span>: <span class="string">&#x27;xxx&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: &#123;</span><br><span class="line">          <span class="attr">type</span>: peerConnection.<span class="property">localDescription</span>.<span class="property">type</span>,</span><br><span class="line">          <span class="attr">sdp</span>: peerConnection.<span class="property">localDescription</span>.<span class="property">sdp</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">browser</span>: <span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">      &#125;</span><br><span class="line">    );</span><br><span class="line">  &#125;)</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;创建Offer失败：&#x27;</span>, error);</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h4><p>上面的代码演示了如何使用 <code>RTCPeerConnection</code> 建立点对点连接，并将本地的音视频流添加到连接中。然后，通过创建一个<code>Offer</code>，并将其发送给对方，以发起一个通信会话。在这个过程中，我们还需要处理 <code>ICE</code> 候选，以便在连接过程中进行 <code>NAT</code> 穿越。</p>
<h3 id="信令交换（Signaling）"><a href="#信令交换（Signaling）" class="headerlink" title="信令交换（Signaling）"></a>信令交换（Signaling）</h3><p><code>WebRTC</code> 的信令交换主要涉及将会话描述、<code>ICE</code> 候选等元数据信息交换给其他 <code>RTCPeerConnection</code>，以建立和管理通信会话。这个过程通常需要借助于信令服务器来协调客户端之间的消息传递。</p>
<h4 id="示例代码-3"><a href="#示例代码-3" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 建立WebSocket连接</span></span><br><span class="line"><span class="keyword">const</span> ws = <span class="keyword">new</span> <span class="title class_">WebSocket</span>(<span class="string">&#x27;ws://localhost:8080&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听WebSocket消息</span></span><br><span class="line">ws.<span class="property">onmessage</span> = <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> message = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(event.<span class="property">data</span>).<span class="property">msg</span>;</span><br><span class="line">  <span class="comment">// 当收到远端的Offer时，我们需要设置远端描述，并生成一个Answer，添加到本地描述里面，然后在通过WebSocket发生给远端，让对方设置的远端描述里面。</span></span><br><span class="line">  <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;offer&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 收到对方的Offer</span></span><br><span class="line">    peerConnection.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(message))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 创建并发送Answer</span></span><br><span class="line">        <span class="keyword">return</span> peerConnection.<span class="title function_">createAnswer</span>();</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">(<span class="params">answer</span>) =&gt;</span> &#123;</span><br><span class="line">        peerConnection.<span class="title function_">setLocalDescription</span>(answer);</span><br><span class="line">        <span class="keyword">return</span> answer</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 将Answer发送给对方</span></span><br><span class="line">        socket.<span class="title function_">sendSDP</span>(</span><br><span class="line">          <span class="string">&#x27;connectionMessage&#x27;</span>,</span><br><span class="line">          &#123; <span class="attr">roomId</span>: <span class="string">&#x27;xxx&#x27;</span>, <span class="attr">msg</span>: answer, <span class="attr">browser</span>: <span class="string">&#x27;xxx&#x27;</span> &#125;</span><br><span class="line">        );</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;处理Offer失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;answer&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 当收到远端的Answer时，设置到远端描述，建立通信连接成功！</span></span><br><span class="line">    <span class="comment">// 收到对方的Answer</span></span><br><span class="line">    peerConnection.<span class="title function_">setRemoteDescription</span>(<span class="keyword">new</span> <span class="title class_">RTCSessionDescription</span>(message))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功建立通信连接！&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;处理Answer失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (message.<span class="property">type</span> === <span class="string">&#x27;candidate&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// 收到远端的ICE候选描述信息时，需要创建RTCIceCandidate对象，然后调用addIceCandidate方法添加ICE候选</span></span><br><span class="line">    <span class="keyword">const</span> candidateParams = <span class="keyword">typeof</span> (message.<span class="property">candidate</span>) === <span class="string">&#x27;object&#x27;</span> ? message.<span class="property">candidate</span> : <span class="title class_">JSON</span>.<span class="title function_">parse</span>(message.<span class="property">candidate</span>);</span><br><span class="line"></span><br><span class="line">    candidateParams.<span class="property">candidate</span> = candidateParams.<span class="property">candidate</span>.<span class="title function_">replace</span>(<span class="regexp">/a=/g</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">    candidateParams.<span class="property">sdpMLineIndex</span> = <span class="built_in">parseInt</span>(candidateParams.<span class="property">sdpMLineIndex</span>, <span class="number">10</span>);</span><br><span class="line">    <span class="keyword">const</span> candidate = <span class="keyword">new</span> <span class="title class_">RTCIceCandidate</span>(candidateParams);</span><br><span class="line">    <span class="comment">// 收到ICE候选</span></span><br><span class="line">    peerConnection.<span class="title function_">addIceCandidate</span>(candidate)</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;成功添加ICE候选！&#x27;</span>);</span><br><span class="line">      &#125;)</span><br><span class="line">      .<span class="title function_">catch</span>(<span class="function">(<span class="params">error</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;添加ICE候选失败：&#x27;</span>, error);</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="说明-3"><a href="#说明-3" class="headerlink" title="说明"></a>说明</h4><p>上面的代码演示了如何使用 <code>WebSocket</code> 进行信令交换。客户端通过 <code>WebSocket</code> 连接到信令服务器，并监听来自服务器的消息。当收到对方发送的 <code>Offer</code>、<code>Answer</code> 或 <code>ICE</code> 候选时，客户端需要相应地处理并执行相应的操作，以建立和管理通信会话。</p>
<h3 id="NAT穿越（NAT-Traversal）"><a href="#NAT穿越（NAT-Traversal）" class="headerlink" title="NAT穿越（NAT Traversal）"></a>NAT穿越（NAT Traversal）</h3><p><code>NAT（Network Address Translation）</code> 穿越是指在 <code>NAT</code> 环境下，通过一系列的技术手段实现两个位于私有网络中的计算机或设备之间的直接通信。<code>WebRTC</code> 通过使用 <code>STUN</code> 和 <code>TURN</code> 服务器来实现 <code>NAT</code> 穿越，以确保在各种网络环境下都能够正常进行实时通信。</p>
<h4 id="示例代码-4"><a href="#示例代码-4" class="headerlink" title="示例代码"></a>示例代码</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 配置ICE服务器</span></span><br><span class="line"><span class="keyword">const</span> configuration = &#123;</span><br><span class="line">  <span class="attr">iceServers</span>: [</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;stun:stun.l.google.com:19302&#x27;</span> &#125;,</span><br><span class="line">    &#123; <span class="attr">urls</span>: <span class="string">&#x27;turn:your-turn-server.com&#x27;</span>, <span class="attr">username</span>: <span class="string">&#x27;username&#x27;</span>, <span class="attr">credential</span>: <span class="string">&#x27;password&#x27;</span> &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建RTCPeerConnection对象</span></span><br><span class="line"><span class="keyword">const</span> peerConnection = <span class="keyword">new</span> <span class="title class_">RTCPeerConnection</span>(configuration);</span><br></pre></td></tr></table></figure>

<h3 id="添加传输通道"><a href="#添加传输通道" class="headerlink" title="添加传输通道"></a>添加传输通道</h3><p>当通道和管理通信会话建立成功后，我们需要将我们本地的音视频流传输到远端的 <code>RTCPeerConnection</code> 中，所以我们需要调用 <code>RTCPeerConnection.addTransceiver</code> 方法。</p>
<p><code>addTransceiver()</code> 方法用于向对等连接（<code>RTCPeerConnection</code> 对象）添加传输通道（transceiver），以便在单个轨道上发送和接收媒体流。通过这种方式，您可以更灵活地控制对等连接的行为，并更精细地管理媒体流的传输。</p>
<p>该方法接受一个或多个参数，具体取决于您要添加的传输通道的类型和配置。通常情况下，<code>addTransceiver()</code> 方法用于以下两种情况：</p>
<ol>
<li><strong>添加本地传输通道（用于发送）</strong>：您可以通过将本地媒体轨道（例如音频或视频轨道）添加到对等连接中来创建一个新的传输通道，以便将该媒体流发送给远端。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> transceivers = [];</span><br><span class="line">localStream.<span class="title function_">getTracks</span>().<span class="title function_">forEach</span>(<span class="keyword">async</span> (track) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> options = &#123;</span><br><span class="line">    <span class="attr">streams</span>: [localStream],</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="keyword">if</span> (track.<span class="property">kind</span> === <span class="string">&#x27;video&#x27;</span>) &#123;</span><br><span class="line">    options = &#123;</span><br><span class="line">      <span class="comment">// 生成视频流编码的参数</span></span><br><span class="line">      <span class="attr">sendEncodings</span>: <span class="title function_">generateEncoderParameters</span>(),</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 需要保存传输通道，在不需要传输的时候，方便停止传输</span></span><br><span class="line">  <span class="keyword">const</span> transceiver = peerConnection.<span class="title function_">addTransceiver</span>(track, options);</span><br><span class="line">  transceivers.<span class="title function_">push</span>(transceiver);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>当需要移除的时候</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">transceivers.<span class="title function_">forEach</span>(<span class="function">(<span class="params">transceiver</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">debug</span>(<span class="string">&#x27;Stopping transceiver&#x27;</span>, transceiver);</span><br><span class="line">  <span class="comment">// Don&#x27;t remove the tagged m section, which is the first one (mid=0).</span></span><br><span class="line">  <span class="keyword">if</span> (transceiver.<span class="property">mid</span> === <span class="string">&#x27;0&#x27;</span>) &#123;</span><br><span class="line">    peerConnection.<span class="title function_">removeTrack</span>(transceiver.<span class="property">sender</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    transceiver.<span class="title function_">stop</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>添加远程传输通道（用于接收）</strong>：当您接收到远端对等连接发送的媒体流时，<code>WebRTC</code> 会自动为每个远程媒体轨道创建传输通道，并将其添加到对等连接中。</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">peerConnection.<span class="property">ontrack</span> = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> remoteTrack = event.<span class="property">track</span>;</span><br><span class="line">  <span class="keyword">if</span> (trackEvt.<span class="property">streams</span>.<span class="property">length</span> !== <span class="number">1</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">warning</span>(<span class="string">&#x27;More that one mediaStream associated with track!&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 远端的流</span></span><br><span class="line">  <span class="keyword">const</span> stream = trackEvt.<span class="property">streams</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// 监听流移除轨道事件</span></span><br><span class="line">  stream.<span class="property">onremovetrack</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 不存在音频和视频</span></span><br><span class="line">    <span class="keyword">if</span> (stream.<span class="title function_">getTracks</span>().<span class="property">length</span> === <span class="number">0</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="title class_">ConnectionEvent</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;remove-stream&#x27;</span>, stream &#125;));</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="title function_">emit</span>(<span class="title class_">ConnectionEvent</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;add-stream&#x27;</span>, stream &#125;));</span><br><span class="line">  <span class="comment">// 处理远程视频轨道</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="说明-4"><a href="#说明-4" class="headerlink" title="说明"></a>说明</h4><p>上面的代码示例中，我们通过配置 <code>ICE</code> 服务器来实现 <code>NAT</code> 穿越。其中，<code>STUN</code> 服务器用于获取公网 <code>IP</code> 地址和端口，而 <code>TURN</code> 服务器则用于在无法直接通信的情况下进行中转。通过合理配置 <code>ICE</code> 服务器，我们可以在不同的网络环境中都能够顺利地进行实时通信。</p>
<h3 id="设置-Codec-编解码器"><a href="#设置-Codec-编解码器" class="headerlink" title="设置 Codec 编解码器"></a>设置 Codec 编解码器</h3><h4 id="获取可用-Codec"><a href="#获取可用-Codec" class="headerlink" title="获取可用 Codec"></a>获取可用 Codec</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> supportsSetCodecPreferences = <span class="variable language_">window</span>.<span class="property">RTCRtpTransceiver</span> &amp;&amp; <span class="string">&#x27;setCodecPreferences&#x27;</span> <span class="keyword">in</span> <span class="variable language_">window</span>.<span class="property">RTCRtpTransceiver</span>.<span class="property"><span class="keyword">prototype</span></span>;</span><br></pre></td></tr></table></figure>

<h4 id="获取-Codec"><a href="#获取-Codec" class="headerlink" title="获取 Codec"></a>获取 Codec</h4><p>通过 <code>RTCRtpSender.getCapabilities(&#39;video&#39;)</code> 获取可支持的 <code>codec</code>。然后把它们放进列表 <code>codecPreferences</code> 里，通过 <code>Select</code> 元素展示，让用户选择想使用的 <code>codec</code>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (supportsSetCodecPreferences) &#123;</span><br><span class="line">    <span class="keyword">const</span> &#123; codecs &#125; = <span class="title class_">RTCRtpSender</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;video&#x27;</span>);</span><br><span class="line">    <span class="keyword">const</span> codecPreferences = [];</span><br><span class="line">    codecs.<span class="title function_">forEach</span>(<span class="function"><span class="params">codec</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> ([<span class="string">&#x27;video/red&#x27;</span>, <span class="string">&#x27;video/ulpfec&#x27;</span>, <span class="string">&#x27;video/rtx&#x27;</span>].<span class="title function_">includes</span>(codec.<span class="property">mimeType</span>)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      codecPreferences.<span class="title function_">push</span>(&#123; ...codec, <span class="attr">value</span>: (codec.<span class="property">mimeType</span> + <span class="string">&#x27; &#x27;</span> + (codec.<span class="property">sdpFmtpLine</span> || <span class="string">&#x27;&#x27;</span>)).<span class="title function_">trim</span>() &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="配置-Codec"><a href="#配置-Codec" class="headerlink" title="配置 Codec"></a>配置 Codec</h4><p>找到用户选择的 <code>Codec</code>。调用 <code>transceiver.setCodecPreferences(codecs) </code>，把选中的 <code>Codec</code> 交给 <code>transceiver</code> 最上面，优先使用。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (supportsSetCodecPreferences) &#123;</span><br><span class="line">    <span class="comment">// 获取选择的codec</span></span><br><span class="line">    <span class="keyword">let</span> selectedIndex = <span class="number">1</span></span><br><span class="line">    <span class="keyword">const</span> preferredCodec = codecPreferences[selectedIndex];</span><br><span class="line">    <span class="keyword">if</span> (preferredCodec.<span class="property">value</span> !== <span class="string">&#x27;&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> [mimeType, sdpFmtpLine] = preferredCodec.<span class="property">value</span>.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> &#123; codecs &#125; = <span class="title class_">RTCRtpSender</span>.<span class="title function_">getCapabilities</span>(<span class="string">&#x27;video&#x27;</span>);</span><br><span class="line">      <span class="keyword">const</span> selectedCodecIndex = codecs.<span class="title function_">findIndex</span>(<span class="function"><span class="params">c</span> =&gt;</span> c.<span class="property">mimeType</span> === mimeType &amp;&amp; c.<span class="property">sdpFmtpLine</span> === sdpFmtpLine);</span><br><span class="line">      <span class="keyword">const</span> selectedCodec = codecs[selectedCodecIndex];</span><br><span class="line">      <span class="comment">// 先移除</span></span><br><span class="line">      codecs.<span class="title function_">splice</span>(selectedCodecIndex, <span class="number">1</span>);</span><br><span class="line">      <span class="comment">// 插入第一个</span></span><br><span class="line">      codecs.<span class="title function_">unshift</span>(selectedCodec);</span><br><span class="line">      <span class="keyword">const</span> transceiver = pc1.<span class="title function_">getTransceivers</span>().<span class="title function_">find</span>(<span class="function"><span class="params">t</span> =&gt;</span> t.<span class="property">sender</span> &amp;&amp; t.<span class="property">sender</span>.<span class="property">track</span> === localStream.<span class="title function_">getVideoTracks</span>()[<span class="number">0</span>]);</span><br><span class="line">      transceiver.<span class="title function_">setCodecPreferences</span>(codecs);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>


<h2 id="WebRTC的应用场景"><a href="#WebRTC的应用场景" class="headerlink" title="WebRTC的应用场景"></a>WebRTC的应用场景</h2><p><code>WebRTC</code> 技术已经被广泛应用于多个领域，包括：</p>
<ol>
<li><p>视频会议<br><code>WebRTC</code> 使得在网页浏览器中进行高清视频会议成为可能，用户可以通过浏览器直接加入会议室，与其他参与者进行实时视频通话。</p>
</li>
<li><p>在线教育<br>教育机构可以利用 <code>WebRTC</code> 技术搭建在线教育平台，让老师和学生之间进行实时的远程教学，实现互动和教学资源共享。</p>
</li>
<li><p>社交应用<br>社交应用程序可以利用 <code>WebRTC</code> 技术实现实时语音和视频通话功能，让用户之间进行更加直观和自然的交流。</p>
</li>
<li><p>远程医疗<br>医疗机构可以利用 <code>WebRTC</code> 技术搭建远程医疗平台，实现医生和患者之间的远程会诊和医疗服务，提高医疗资源的利用效率。</p>
</li>
</ol>
<h2 id="WebRTC的未来发展趋势"><a href="#WebRTC的未来发展趋势" class="headerlink" title="WebRTC的未来发展趋势"></a>WebRTC的未来发展趋势</h2><p>随着实时通信需求的不断增加，<code>WebRTC</code> 技术也在不断发展和完善。未来，我们可以期待以下几个方面的发展趋势：</p>
<ol>
<li><p>网络性能的提升<br>随着网络基础设施的不断改善和网络带宽的增加，<code>WebRTC</code> 技术将能够实现更高质量、更稳定的实时通信体验。</p>
</li>
<li><p>新的应用场景<br>随着 <code>WebRTC</code> 技术的成熟和普及，我们可以预见到它将被应用于更多领域，如工业控制、智能家居和虚拟现实等。</p>
</li>
<li><p>标准化和开放性<br><code>WebRTC</code> 作为一个开放标准的实时通信技术，将继续推动标准化工作的进行，以确保不同厂商和平台之间的互操作性和兼容性。</p>
</li>
<li><p>安全性和隐私保护<br>随着个人隐私和数据安全意识的提高，<code>WebRTC</code> 技术将会加强对通信内容的加密和隐私保护，以确保用户数据的安全性。</p>
</li>
</ol>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p><code>WebRTC</code> 技术的出现为实时通信应用提供了强大的支持，使得开发者可以轻松构建具有高质量和稳定性的实时通信应用。随着技术的不断发展和完善，我们有理由相信 <code>WebRTC</code> 将会在未来的数字化世界中扮演越来越重要的角色，为用户带来更丰富、更便捷的通信体验。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/webrtc/" rel="tag">webrtc</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/16/webrtc/" data-id="clw71kuva004vqqoq4grr1w88" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-fontend-optimize-indicators" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/14/fontend-optimize-indicators/" class="article-date">
  <time datetime="2024-04-14T12:12:12.000Z" itemprop="datePublished">2024-04-14</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/14/fontend-optimize-indicators/">Web前端最新优化指标：从FP到FPS的全面解析</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="Web前端最新优化指标：从FP到FPS的全面解析"><a href="#Web前端最新优化指标：从FP到FPS的全面解析" class="headerlink" title="Web前端最新优化指标：从FP到FPS的全面解析"></a>Web前端最新优化指标：从FP到FPS的全面解析</h2><h3 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h3><p>在当今互联网时代，Web前端性能优化是网站开发中至关重要的一环。随着技术的不断发展，出现了一系列新的性能指标，如<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等。本文将深入探讨这些最新的Web前端优化指标，详细介绍获取和优化的方法，并提供丰富的实例和技巧，帮助开发者全面了解和应用于实践中。</p>
<h3 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h3><p>随着Web技术的不断发展，用户对网页加载速度和性能的要求越来越高。为了提供更好的用户体验，出现了一系列新的Web前端优化指标，如<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等。本文将深入探讨这些指标的含义、获取方法以及优化技巧，帮助开发者更好地理解和应用于实践中。</p>
<h3 id="DOMContentLoaded-事件"><a href="#DOMContentLoaded-事件" class="headerlink" title="DOMContentLoaded 事件"></a>DOMContentLoaded 事件</h3><p><code>DOMContentLoaded</code> 事件，当 <code>HTML</code> 文档被完全加载和解析完成之后，<code>DOMContentLoaded</code> 事件被触发，无需等待样式表、图像和子框架的完成加载。</p>
<h4 id="获取-DOMContentLoaded-事件的方法："><a href="#获取-DOMContentLoaded-事件的方法：" class="headerlink" title="获取 DOMContentLoaded 事件的方法："></a>获取 DOMContentLoaded 事件的方法：</h4><p>通过监听 <code>document</code> 对象上的 <code>DOMContentLoaded</code> 事件获得：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;DOMContentLoaded&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<h4 id="DOMContentLoaded-事件持续时间"><a href="#DOMContentLoaded-事件持续时间" class="headerlink" title="DOMContentLoaded 事件持续时间"></a>DOMContentLoaded 事件持续时间</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>DOMContentLoaded</code> 事件的开始和结束时间，如<code>performance.timing.domContentLoadedEventEnd</code>和<code>performance.timing.domContentLoadedEventStart</code>，两者相差就为持续时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 计算规则</span></span><br><span class="line"><span class="keyword">const</span> dclTime = performance.<span class="property">timing</span>.<span class="property">domContentLoadedEventEnd</span> - performance.<span class="property">timing</span>.<span class="property">domContentLoadedEventStart</span></span><br></pre></td></tr></table></figure>

<h3 id="load-事件"><a href="#load-事件" class="headerlink" title="load 事件"></a>load 事件</h3><p><code>load</code> 事件，当页面中依赖的所有资源：DOM、图片、CSS、Flash、javascript 等都加载完后，执行完后会在 <code>window</code> 对象上触发对应的事件，</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><code>window.onload</code> 注册的回调就会在 <code>load</code> 事件触发时候被调用，或者通过 <code>window.addEventListener</code> 来进行监听。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">onload</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// or</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;load&#x27;</span>, <span class="keyword">function</span>(<span class="params"></span>) &#123;&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure>

<h4 id="load-事件持续时间"><a href="#load-事件持续时间" class="headerlink" title="load 事件持续时间"></a>load 事件持续时间</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>load</code> 事件的开始和结束时间，如<code>performance.timing.loadEventEnd</code>和<code>performance.timing.loadEventStart</code>，两者相差就为持续时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> loadTime = performance.<span class="property">timing</span>.<span class="property">loadEventEnd</span> - performance.<span class="property">timing</span>.<span class="property">loadEventStart</span>;</span><br></pre></td></tr></table></figure>

<h3 id="FP（First-Paint）"><a href="#FP（First-Paint）" class="headerlink" title="FP（First Paint）"></a>FP（First Paint）</h3><p>FP是指浏览器首次将像素呈现到屏幕上的时间点，即首次绘制。它标志着页面开始加载的时间，但并不表示页面内容已经完全可见。下面是获取和优化FP的方法：</p>
<h4 id="获取FP的方法："><a href="#获取FP的方法：" class="headerlink" title="获取FP的方法："></a>获取FP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FP时间，如<code>performance.timing.navigationStart</code>和<code>performance.getEntriesByType(&#39;paint&#39;)</code>等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FP时间</span></span><br><span class="line"><span class="keyword">const</span> entries = performance.<span class="title function_">getEntriesByType</span>(<span class="string">&#x27;paint&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">  <span class="comment">// 首次渲染</span></span><br><span class="line">  <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// FP开始时间</span></span><br><span class="line">    <span class="keyword">const</span> fpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FP时间：&quot;</span>, fpTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FP（First-Paint）持续时间"><a href="#FP（First-Paint）持续时间" class="headerlink" title="FP（First Paint）持续时间"></a>FP（First Paint）持续时间</h4><p>FP持续时间是指从页面开始加载到首次绘制内容到屏幕上的时间间隔。可以通过 <code>PerformanceObserver</code> 对象，通过监听 <code>paint</code> 类型来获取，还能获得 <code>FP（First Paint）</code> 所花费的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// 首次渲染</span></span><br><span class="line">    <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-paint&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// FP开始时间</span></span><br><span class="line">      <span class="keyword">const</span> fpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">      <span class="comment">// 持续时间</span></span><br><span class="line">      <span class="keyword">const</span> duration = entry.<span class="property">duration</span>;</span><br><span class="line">      <span class="comment">// FP结束时间</span></span><br><span class="line">      <span class="keyword">const</span> fpDurationTime = fpTime + duration;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FP持续时间：&quot;</span>, fpDurationTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FP的方法："><a href="#优化FP的方法：" class="headerlink" title="优化FP的方法："></a>优化FP的方法：</h4><p>优化FP可以通过减少页面加载时间和优化渲染流程来实现。例如，通过合并和压缩CSS、JavaScript文件，减少网络请求次数和文件大小，以加快页面加载速度。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 合并和压缩CSS文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;styles.css&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 合并和压缩JavaScript文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;scripts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="FCP（First-Contentful-Paint）"><a href="#FCP（First-Contentful-Paint）" class="headerlink" title="FCP（First Contentful Paint）"></a>FCP（First Contentful Paint）</h3><p>FCP是指浏览器首次绘制来自DOM的内容的时间点，即首次内容绘制。它表示页面开始显示内容的时间，但并不表示所有内容都已加载完毕。下面是获取和优化FCP的方法：</p>
<h4 id="获取FCP的方法："><a href="#获取FCP的方法：" class="headerlink" title="获取FCP的方法："></a>获取FCP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FCP时间，如 <code>performance.timing.navigationStart</code> 和 <code>performance.timing.getEntriesByType(&#39;paint&#39;)</code> 等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FP时间</span></span><br><span class="line"><span class="keyword">const</span> entries = performance.<span class="title function_">getEntriesByType</span>(<span class="string">&#x27;paint&#x27;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">  <span class="comment">// 首次渲染</span></span><br><span class="line">  <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-contentful-paint&#x27;</span>) &#123;</span><br><span class="line">    <span class="comment">// FCP开始时间</span></span><br><span class="line">    <span class="keyword">const</span> fcpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FCP时间：&quot;</span>, fcpTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="FCP（First-Contentful-Paint）持续时间"><a href="#FCP（First-Contentful-Paint）持续时间" class="headerlink" title="FCP（First Contentful Paint）持续时间"></a>FCP（First Contentful Paint）持续时间</h4><p>FCP持续时间是指从页面开始加载到首次绘制来自DOM的内容的时间间隔。可以通过 <code>PerformanceObserver</code> 对象，通过监听 <code>paint</code> 类型来获取，还能获得 <code>FCP（First Contentful Paint）</code> 所花费的时间。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取FCP时间</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">const</span> entry <span class="keyword">of</span> entries) &#123;</span><br><span class="line">    <span class="comment">// 首次渲染</span></span><br><span class="line">    <span class="keyword">if</span> (entry.<span class="property">name</span> === <span class="string">&#x27;first-contentful-paint&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">// FCP开始时间</span></span><br><span class="line">      <span class="keyword">const</span> fcpTime = entry.<span class="property">startTime</span>;</span><br><span class="line">      <span class="comment">// 持续时间</span></span><br><span class="line">      <span class="keyword">const</span> duration = entry.<span class="property">duration</span>;</span><br><span class="line">      <span class="comment">// FCP持续时间</span></span><br><span class="line">      <span class="keyword">const</span> fcpDurationTime = fcpTime + duration;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FCP持续时间：&quot;</span>, fcpDurationTime);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FCP的方法："><a href="#优化FCP的方法：" class="headerlink" title="优化FCP的方法："></a>优化FCP的方法：</h4><p>优化FCP可以通过减少关键资源的加载时间和优化关键路径资源来实现。例如，通过预加载关键资源、懒加载技术和延迟加载非关键资源等。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 预加载关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;preload&quot;</span> <span class="attr">href</span>=<span class="string">&quot;critical.css&quot;</span> <span class="attr">as</span>=<span class="string">&quot;style&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 懒加载非关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;placeholder.jpg&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="FMP（First-Meaningful-Paint）"><a href="#FMP（First-Meaningful-Paint）" class="headerlink" title="FMP（First Meaningful Paint）"></a>FMP（First Meaningful Paint）</h3><p>FMP是指浏览器首次绘制页面主要内容的时间点，即首次有意义的绘制。它表示用户认为页面已经有用的时间点。下面是获取和优化FMP的方法：</p>
<h4 id="获取FMP的方法："><a href="#获取FMP的方法：" class="headerlink" title="获取FMP的方法："></a>获取FMP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FMP时间，如 <code>PerformanceObserver</code> 接口监听 <code>paint</code> 事件，判断首次有意义的绘制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FMP计算比较复杂，lighthouse的计算的大体思路是，将页面中最大布局变化后的第一次渲染事件作为FMP事件，并且计算中考虑到了可视区的因素。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FMP计算过于复杂，没有现成的performance API，如果希望在监控中上报这个指标，可以自己使用MutationObserver计算。</span></span><br></pre></td></tr></table></figure>

<h4 id="FMP（First-Meaningful-Paint）持续时间"><a href="#FMP（First-Meaningful-Paint）持续时间" class="headerlink" title="FMP（First Meaningful Paint）持续时间"></a>FMP（First Meaningful Paint）持续时间</h4><p>FMP持续时间是指从页面开始加载到首次绘制页面主要内容的时间间隔。可以通过监测FMP事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// FMP计算过于复杂，没有现成的performance API，如果希望在监控中上报这个指标，可以自己使用MutationObserver计算。</span></span><br></pre></td></tr></table></figure>

<h4 id="优化FMP的方法："><a href="#优化FMP的方法：" class="headerlink" title="优化FMP的方法："></a>优化FMP的方法：</h4><p>优化FMP可以通过减少关键资源的加载时间和提高关键路径资源加载速度来实现。例如，使用HTTP&#x2F;2多路复用和服务器推送技术，以及使用CDN加速关键资源加载。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用CDN加速关键资源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.example.com/scripts.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="LCP（Largest-Contentful-Paint）"><a href="#LCP（Largest-Contentful-Paint）" class="headerlink" title="LCP（Largest Contentful Paint）"></a>LCP（Largest Contentful Paint）</h3><p>LCP是指浏览器在视觉上渲染的最大内容元素的时间点，即最大内容渲染时间点。它衡量的是页面主要内容加载完成的时间点。下面是获取和优化LCP的方法：</p>
<h4 id="获取LCP的方法："><a href="#获取LCP的方法：" class="headerlink" title="获取LCP的方法："></a>获取LCP的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取 <code>LCP</code> 时间，如 <code>PerformanceObserver</code> 接口监听 <code>largest-contentful-paint</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听LCP事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> lcpTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;LCP时间：&quot;</span>, lcpTime);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;largest-contentful-paint&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="LCP（Largest-Contentful-Paint）持续时间"><a href="#LCP（Largest-Contentful-Paint）持续时间" class="headerlink" title="LCP（Largest Contentful Paint）持续时间"></a>LCP（Largest Contentful Paint）持续时间</h4><p>LCP持续时间是指从页面开始加载到最大内容元素被渲染完成的时间间隔。可以通过监测LCP事件和页面开始加载之间的时间差来计算。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 计算最大的内容</span></span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>().<span class="title function_">sort</span>(<span class="function">(<span class="params">pre, next</span>) =&gt;</span> next.<span class="property">size</span> - pre.<span class="property">size</span>);</span><br><span class="line">  <span class="comment">// LCP开始事件</span></span><br><span class="line">  <span class="keyword">const</span> lcpTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="comment">// 持续时间</span></span><br><span class="line">  <span class="keyword">const</span> duration = entries[<span class="number">0</span>].<span class="property">duration</span>;</span><br><span class="line">  <span class="comment">// FCP持续时间</span></span><br><span class="line">  <span class="keyword">const</span> lcpDuration = lcpTime + duration;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;LCP持续时间：&#x27;</span>, lcpDuration);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&#x27;largest-contentful-paint&#x27;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化LCP的方法："><a href="#优化LCP的方法：" class="headerlink" title="优化LCP的方法："></a>优化LCP的方法：</h4><p>优化LCP可以通过优化关键路径资源的加载顺序和减少页面主要内容的渲染时间来实现。例如，使用懒加载技术延迟加载非关键内容，以及减少渲染阻塞资源的加载。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用懒加载延迟加载非关键内容 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;placeholder.jpg&quot;</span> <span class="attr">data-src</span>=<span class="string">&quot;image.jpg&quot;</span> <span class="attr">loading</span>=<span class="string">&quot;lazy&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="TTI（Time-to-Interactive）"><a href="#TTI（Time-to-Interactive）" class="headerlink" title="TTI（Time to Interactive）"></a>TTI（Time to Interactive）</h3><p>TTI是指页面变得可交互的时间点，即用户可以与页面进行交互的时间点。它是衡量页面可用性的重要指标。下面是获取和优化TTI的方法：</p>
<h4 id="获取TTI的方法："><a href="#获取TTI的方法：" class="headerlink" title="获取TTI的方法："></a>获取TTI的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取TTI时间，通过 <code>performance.timing.domInteractive</code> 和 <code>performance.timing.fetchStart</code> 的时间差来获得。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听TTI事件</span></span><br><span class="line"><span class="keyword">const</span> timeToInteractive = performance.<span class="property">timing</span>.<span class="property">domInteractive</span> - performance.<span class="property">timing</span>.<span class="property">fetchStart</span>;</span><br></pre></td></tr></table></figure>

<h4 id="优化TTI的方法："><a href="#优化TTI的方法：" class="headerlink" title="优化TTI的方法："></a>优化TTI的方法：</h4><p>优化TTI可以通过减少主线程阻塞时间和延迟加载非关键资源来实现。例如，通过减少JavaScript执行时间、使用服务端渲染技术和懒加载技术等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用懒加载延迟加载非关键资源</span></span><br><span class="line"><span class="keyword">const</span> image = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;img&quot;</span>);</span><br><span class="line">image.<span class="property">src</span> = <span class="string">&quot;image.jpg&quot;</span>;</span><br><span class="line">image.<span class="property">loading</span> = <span class="string">&quot;lazy&quot;</span>;</span><br><span class="line"><span class="variable language_">document</span>.<span class="property">body</span>.<span class="title function_">appendChild</span>(image);</span><br></pre></td></tr></table></figure>

<h3 id="CLS（Cumulative-Layout-Shift）"><a href="#CLS（Cumulative-Layout-Shift）" class="headerlink" title="CLS（Cumulative Layout Shift）"></a>CLS（Cumulative Layout Shift）</h3><p>CLS是指页面在加载过程中发生的所有不良布局变化的总和，即累积布局偏移。它衡量的是页面的视觉稳定性。发生的每次布局变化中的最大幅度的布局变化得分的指标。为了提供良好的用户体验，站点应该努力使 CLS 分数达到 <strong>0.1</strong> 或更低。下面是获取和优化CLS的方法：</p>
<h4 id="获取CLS的方法："><a href="#获取CLS的方法：" class="headerlink" title="获取CLS的方法："></a>获取CLS的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取CLS值，如 <code>PerformanceObserver</code> 接口监听 <code>layout-shift</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听CLS事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> clsValue = entries.<span class="title function_">reduce</span>(<span class="function">(<span class="params">acc, entry</span>) =&gt;</span> acc + entry.<span class="property">value</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;CLS值：&quot;</span>, clsValue);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;layout-shift&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;); <span class="comment">// 必须加上 buffered: true</span></span><br></pre></td></tr></table></figure>

<h4 id="优化CLS的方法："><a href="#优化CLS的方法：" class="headerlink" title="优化CLS的方法："></a>优化CLS的方法：</h4><p>优化CLS可以通过避免页面元素的不稳定布局和动态元素的尺寸变化来实现。例如，指定图片和媒体元素的尺寸、避免动态插入内容导致页面布局变化等。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 指定图片和媒体元素的尺寸 */</span></span><br><span class="line"><span class="selector-tag">img</span>, <span class="selector-tag">video</span> &#123;</span><br><span class="line">  <span class="attribute">width</span>: <span class="number">100%</span>;</span><br><span class="line">  <span class="attribute">height</span>: auto;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="FID（First-Input-Delay）"><a href="#FID（First-Input-Delay）" class="headerlink" title="FID（First Input Delay）"></a>FID（First Input Delay）</h3><p>FID是指用户首次与页面交互到浏览器响应交互的时间间隔，即首次输入延迟。它衡量的是页面的交互性能。</p>
<p>第一次输入延迟，用于测量可交互性。FID 衡量的是从用户第一次与页面交互（例如，当他们点击链接，点击按钮，或使用自定义的 JavaScript 驱动的控件）到浏览器实际能够开始响应该交互的时间，为了提供良好的用户体验，站点应该努力使 FID 保持在 <strong>100</strong> 毫秒以内。</p>
<p>下面是获取和优化FID的方法：</p>
<h4 id="获取FID的方法："><a href="#获取FID的方法：" class="headerlink" title="获取FID的方法："></a>获取FID的方法：</h4><p>可以通过 <code>Performance API</code> 中的相关接口来获取FID值，如 <code>PerformanceObserver</code> 接口监听 <code>first-input</code> 事件。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 监听FID事件</span></span><br><span class="line"><span class="keyword">const</span> observer = <span class="keyword">new</span> <span class="title class_">PerformanceObserver</span>(<span class="function">(<span class="params">list</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> entries = list.<span class="title function_">getEntries</span>();</span><br><span class="line">  <span class="keyword">const</span> fidTime = entries[<span class="number">0</span>].<span class="property">startTime</span>;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;FID值：&quot;</span>, fidTime);</span><br><span class="line">&#125;);</span><br><span class="line">observer.<span class="title function_">observe</span>(&#123; <span class="attr">type</span>: <span class="string">&quot;first-input&quot;</span>, <span class="attr">buffered</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h4 id="优化FID的方法："><a href="#优化FID的方法：" class="headerlink" title="优化FID的方法："></a>优化FID的方法：</h4><p>优化FID可以通过减少主线程阻塞时间和优化JavaScript执行时间来实现。例如，减少长任务的执行时间、优化事件处理程序的性能等。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 优化事件处理程序的性能</span></span><br><span class="line"><span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;button&quot;</span>).<span class="title function_">addEventListener</span>(<span class="string">&quot;click&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// 执行优化后的代码</span></span><br><span class="line">&#125;, &#123; <span class="attr">passive</span>: <span class="literal">true</span> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="FPS（Frames-per-Second）"><a href="#FPS（Frames-per-Second）" class="headerlink" title="FPS（Frames per Second）"></a>FPS（Frames per Second）</h3><p>FPS是指页面在每秒钟内渲染的帧数，即每秒钟刷新的次数。它衡量的是页面的流畅度和动画效果。下面是获取和优化FPS的方法：</p>
<h4 id="获取FPS的方法："><a href="#获取FPS的方法：" class="headerlink" title="获取FPS的方法："></a>获取FPS的方法：</h4><p>可以通过浏览器的性能监控工具或第三方工具来获取页面的FPS值，如 <code>Chrome DevTools</code> 或 <code>WebPageTest</code> 等。</p>
<h4 id="FPS（Frames-per-Second）持续时间"><a href="#FPS（Frames-per-Second）持续时间" class="headerlink" title="FPS（Frames per Second）持续时间"></a>FPS（Frames per Second）持续时间</h4><p>FPS持续时间是指页面在每秒内渲染的帧数。可以通过监测页面的渲染性能并计算平均帧率来获取。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 使用requestAnimationFrame来监测FPS</span></span><br><span class="line"><span class="keyword">let</span> fps = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">let</span> lastTime = performance.<span class="title function_">now</span>();</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> currentTime = performance.<span class="title function_">now</span>();</span><br><span class="line">  <span class="keyword">const</span> elapsedTime = currentTime - lastTime;</span><br><span class="line">  fps = <span class="number">1000</span> / elapsedTime;</span><br><span class="line">  lastTime = currentTime;</span><br><span class="line">  <span class="title function_">requestAnimationFrame</span>(loop);</span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">loop</span>();</span><br></pre></td></tr></table></figure>

<h4 id="优化FPS的方法："><a href="#优化FPS的方法：" class="headerlink" title="优化FPS的方法："></a>优化FPS的方法：</h4><p>优化FPS可以通过减少页面渲染的复杂度和优化动画效果来实现。例如，使用CSS3动画代替JavaScript动画、避免频繁的重绘和重排等。</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 使用CSS3动画 */</span></span><br><span class="line"><span class="selector-class">.element</span> &#123;</span><br><span class="line">  <span class="attribute">animation</span>: slide-in <span class="number">1s</span> ease-in-out infinite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@keyframes</span> slide-in &#123;</span><br><span class="line">  <span class="selector-tag">from</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateX</span>(-<span class="number">100%</span>); &#125;</span><br><span class="line">  <span class="selector-tag">to</span> &#123; <span class="attribute">transform</span>: <span class="built_in">translateX</span>(<span class="number">0</span>); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>本文详细介绍了Web前端最新优化指标，包括<code>FP</code>、<code>FCP</code>、<code>FMP</code>、<code>LCP</code>、<code>TTI</code>、<code>CLS</code>、<code>FID</code>、<code>FPS</code>等，并提供了获取和优化的方法和实例。这些指标不仅帮助开发者更好地评估和优化网页性能，也有助于提升用户体验和网站竞争力。我们可以参考这些指标对网站的性能进行相关的优化。优化是一把双刃剑，有好的一面也有坏的一面，请谨慎优化。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/optimize/" rel="tag">optimize</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/14/fontend-optimize-indicators/" data-id="clw71kutz0008qqoqcbajg8gp" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-abort-controller" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/12/abort-controller/" class="article-date">
  <time datetime="2024-04-12T10:00:00.000Z" itemprop="datePublished">2024-04-12</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/12/abort-controller/">使用 AbortController 实现异步操作控制</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-AbortController-实现异步操作控制"><a href="#使用-AbortController-实现异步操作控制" class="headerlink" title="使用 AbortController 实现异步操作控制"></a>使用 AbortController 实现异步操作控制</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>在 <code>JavaScript</code> 中，我们经常需要执行一些异步操作，例如发起网络请求、执行定时任务等。然而，有时候我们希望能够在某些条件下中止这些异步操作，以节省资源或提高用户体验。这时候，<code>AbortController</code> 就派上了用场。</p>
<p><code>AbortController</code> 是一个可以用来控制异步操作的对象，它可以与 <code>Promise</code>、<code>Fetch API</code> 等配合使用，实现在异步操作进行中中止操作的功能。本文将介绍 <code>AbortController</code> 的基本用法，并提供详细的示例来说明其在实际场景中的应用。</p>
<h3 id="基本用法"><a href="#基本用法" class="headerlink" title="基本用法"></a>基本用法</h3><p><code>AbortController</code> 提供了两个主要的方法：<code>abort()</code> 和 <code>signal</code> 属性。</p>
<ul>
<li><strong>abort()</strong>: 调用该方法可以中止与 <code>AbortController</code> 相关联的异步操作。</li>
<li><strong>signal</strong>: 这是一个只读属性，它返回一个 <code>AbortSignal</code> 对象，用于监听异步操作的中止状态。<br>下面是一个基本的示例：</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听中止信号</span></span><br><span class="line">signal.<span class="title function_">addEventListener</span>(<span class="string">&#x27;abort&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Operation aborted&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5秒后中止操作</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并从中获取了 <code>signal</code> 属性。然后，我们通过 <code>setTimeout()</code> 函数设定了一个 <code>5</code> 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止操作。同时，我们通过 <code>signal.addEventListener()</code> 方法监听了中止信号，并在中止时输出了一条日志。</p>
<h3 id="结合-Fetch-API"><a href="#结合-Fetch-API" class="headerlink" title="结合 Fetch API"></a>结合 Fetch API</h3><p><code>AbortController</code> 最常见的用法之一是与 <code>Fetch API</code> 结合使用，实现中止网络请求的功能。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetch</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, &#123; signal &#125;)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> response.<span class="title function_">json</span>())</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request aborted&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 10秒后中止请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并将其与 <code>Fetch API</code> 中的 <code>signal</code> 属性关联起来。然后，我们发起了一个网络请求，当请求完成时输出了返回的数据，如果请求被中止，则捕获到 <code>AbortError</code> 并输出一条相应的日志。最后，我们设置了一个 10 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止网络请求。</p>
<h3 id="结合-Promise"><a href="#结合-Promise" class="headerlink" title="结合 Promise"></a>结合 Promise</h3><p>除了与 <code>Fetch API</code> 结合使用外，<code>AbortController</code> 还可以与 <code>Promise</code> 结合使用，实现中止 <code>Promise</code> 执行的功能。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fetchData</span>(<span class="params">signal</span>) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (signal.<span class="property">aborted</span>) &#123;</span><br><span class="line">        <span class="title function_">reject</span>(<span class="keyword">new</span> <span class="title class_">DOMException</span>(<span class="string">&#x27;AbortError&#x27;</span>, <span class="string">&#x27;AbortError&#x27;</span>));</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(<span class="string">&#x27;Data fetched successfully&#x27;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, <span class="number">3000</span>);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> controller = <span class="keyword">new</span> <span class="title class_">AbortController</span>();</span><br><span class="line"><span class="keyword">const</span> signal = controller.<span class="property">signal</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_">fetchData</span>(signal)</span><br><span class="line">  .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> <span class="variable language_">console</span>.<span class="title function_">log</span>(data))</span><br><span class="line">  .<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (error.<span class="property">name</span> === <span class="string">&#x27;AbortError&#x27;</span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Operation aborted&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 5秒后中止操作</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  controller.<span class="title function_">abort</span>();</span><br><span class="line">&#125;, <span class="number">5000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们定义了一个 <code>fetchData()</code> 函数，该函数返回一个 <code>Promise</code> 对象，在一定时间后返回数据或者中止操作。然后，我们创建了一个 <code>AbortController</code> 对象 <code>controller</code>，并将其与 <code>Promise</code> 关联起来。最后，我们设置了一个 <code>5</code> 秒后的定时任务，当定时任务执行时，调用了 <code>controller.abort()</code> 方法来中止 <code>Promise</code> 执行。</p>
<h3 id="Axios-请求通过-CancelToken-来取消请求"><a href="#Axios-请求通过-CancelToken-来取消请求" class="headerlink" title="Axios 请求通过 CancelToken 来取消请求"></a>Axios 请求通过 CancelToken 来取消请求</h3><p><code>Axios</code> 自带有取消请求的借口，在 <code>Axios</code> 中通过 <code>CancelToken</code> 取消请求发送。下面是一个示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/ 引入 <span class="title class_">Axios</span> 库</span><br><span class="line"><span class="keyword">const</span> axios = <span class="built_in">require</span>(<span class="string">&#x27;axios&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 CancelToken.source 对象</span></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">CancelToken</span>, axiosInstance &#125; = axios;</span><br><span class="line"><span class="keyword">const</span> source = <span class="title class_">CancelToken</span>.<span class="title function_">source</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建一个 Axios 请求</span></span><br><span class="line"><span class="keyword">const</span> request = axiosInstance.<span class="title function_">get</span>(<span class="string">&#x27;https://api.example.com/data&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">cancelToken</span>: source.<span class="property">token</span> <span class="comment">// 传递 CancelToken 对象到请求配置中</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个定时器，在 3 秒后取消请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  source.<span class="title function_">cancel</span>(<span class="string">&#x27;Request canceled due to timeout&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发起请求并处理响应</span></span><br><span class="line">request.<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Response:&#x27;</span>, response.<span class="property">data</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (axios.<span class="title function_">isCancel</span>(error)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request canceled:&#x27;</span>, error.<span class="property">message</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们首先引入 <code>Axios</code> 库，并创建了一个 <code>CancelToken.source</code> 对象 <code>source</code>。然后，我们发起一个 <code>GET</code> 请求，并在请求配置中传递了 <code>cancelToken: source.token</code>，以便 <code>Axios</code> 知道我们要使用哪个 <code>CancelToken</code> 来取消请求。</p>
<p>接着，我们设置了一个定时器，在 <code>3</code> 秒后调用 <code>source.cancel()</code> 方法取消请求，并传递了一个取消原因。最后，我们发起请求，并在 <code>.then()</code> 和 <code>.catch()</code> 方法中分别处理响应和错误。如果请求被取消，我们通过 <code>axios.isCancel(error)</code> 来检查错误类型，并输出相应的日志。</p>
<h3 id="XMLHttpRequest-通过-abort-来取消请求"><a href="#XMLHttpRequest-通过-abort-来取消请求" class="headerlink" title="XMLHttpRequest 通过 abort 来取消请求"></a>XMLHttpRequest 通过 abort 来取消请求</h3><p>在现代浏览器环境中，我们可以使用 <code>XMLHttpRequest（XHR）</code> 对象来发起网络请求，<code>XHR</code> 里面存在 <code>abort</code> 能用来取消这些请求。以下是一个使用XHR取消请求的示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建一个XHR对象</span></span><br><span class="line"><span class="keyword">const</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 监听请求状态变化</span></span><br><span class="line">xhr.<span class="property">onreadystatechange</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="comment">// 请求完成并且响应状态为200时，处理响应</span></span><br><span class="line">  <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="title class_">XMLHttpRequest</span>.<span class="property">DONE</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Response:&#x27;</span>, xhr.<span class="property">responseText</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 准备发送请求，但不发送</span></span><br><span class="line">xhr.<span class="title function_">open</span>(<span class="string">&#x27;GET&#x27;</span>, <span class="string">&#x27;https://api.example.com/data&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 发送请求</span></span><br><span class="line">xhr.<span class="title function_">send</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置一个定时器，在3秒后取消请求</span></span><br><span class="line"><span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  xhr.<span class="title function_">abort</span>();</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Request canceled&#x27;</span>);</span><br><span class="line">&#125;, <span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p>在这个示例中，我们首先创建了一个 <code>XMLHttpRequest</code> 对象 <code>xhr</code>，并设置了它的 <code>onreadystatechange</code> 事件处理程序来监听请求状态变化。然后，我们调用 <code>xhr.open()</code> 方法来准备发送一个 <code>GET</code> 请求到指定的 <code>URL</code>，但并不发送请求。接着，我们调用 <code>xhr.send()</code> 方法来实际发送请求。</p>
<p>同时，我们设置了一个定时器，在3秒后调用 <code>xhr.abort()</code> 方法来取消请求。当调用 <code>xhr.abort()</code> 方法时，<code>XHR</code> 对象将会立即终止当前的网络请求。</p>
<p>最后，当请求完成并且响应状态为 <code>200</code> 时，我们通过 <code>xhr.responseText</code> 属性获取响应数据，并输出到控制台。</p>
<h3 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h3><p><code>AbortController</code> 是一个非常有用的工具，它为我们提供了在异步操作进行中中止操作的能力。通过结合 <code>Fetch API</code>、<code>Promise</code> 等，我们可以在网络请求、定时任务等场景中灵活地使用 <code>AbortController</code>，从而提高代码的可控性和可靠性。希望本文的介绍能够帮助你更好地理解和应用 <code>AbortController</code>。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/html5/" rel="tag">html5</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/12/abort-controller/" data-id="clw71kutp0000qqoq3o8t3w0x" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-optimize-miniprogram" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/10/optimize-miniprogram/" class="article-date">
  <time datetime="2024-04-10T08:50:26.000Z" itemprop="datePublished">2024-04-10</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/10/optimize-miniprogram/">小程序性能优化实践指南</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="小程序性能优化实践指南"><a href="#小程序性能优化实践指南" class="headerlink" title="小程序性能优化实践指南"></a>小程序性能优化实践指南</h2><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着移动互联网的发展，小程序已经成为了许多企业和开发者的首选平台之一。然而，随着小程序功能的不断丰富和用户需求的增加，小程序的性能优化变得愈发重要。本文将介绍一些常见的小程序性能优化实践，并提供详细的例子来说明如何在实际项目中进行优化。</p>
<h3 id="性能指标"><a href="#性能指标" class="headerlink" title="性能指标"></a>性能指标</h3><p>小程序（或微信小程序）的性能优化是确保小程序在用户设备上以流畅、快速的方式运行的重要方面之一。以下是一些常见的小程序性能指标：</p>
<h4 id="LoadPackage"><a href="#LoadPackage" class="headerlink" title="LoadPackage"></a>LoadPackage</h4><p>指小程序代码包下载阶段。在此阶段，小程序需要从服务器下载代码包以执行后续的逻辑。代码包大小和下载速度会影响小程序的启动性能。</p>
<p>获取方式： 可通过网络监控工具或浏览器开发者工具查看网络请求的时间和代码包大小等信息。</p>
<h4 id="First-Paint-FP"><a href="#First-Paint-FP" class="headerlink" title="First Paint (FP)"></a>First Paint (FP)</h4><p>页面首次绘制是浏览器开始将内容呈现在屏幕上的时间点。此时用户无法与页面交互，但首次绘制仍可显示部分内容，向用户展示页面正在加载。</p>
<p>获取方式： 通过浏览器性能分析工具或 <code>Performance API</code> 来捕获此事件，并了解页面渲染启动时间。</p>
<h4 id="First-Contentful-Paint-FCP"><a href="#First-Contentful-Paint-FCP" class="headerlink" title="First Contentful Paint (FCP)"></a>First Contentful Paint (FCP)</h4><p>页面的第一个内容块被绘制到屏幕上的时间点。用户可以看到页面的某些部分，但是页面尚未完全加载。</p>
<p>获取方式： 通过 <code>Chrome DevTools</code> 的 <code>Performance</code> 面板或 <code>Lighthouse</code> 等工具可以获取该指标。</p>
<h4 id="First-Meaningful-Paint-FMP"><a href="#First-Meaningful-Paint-FMP" class="headerlink" title="First Meaningful Paint (FMP)"></a>First Meaningful Paint (FMP)</h4><p>用户认为有用内容被展示在屏幕上的时间点。FMP 更准确地反映用户感知到的页面加载速度，因为它考虑了页面加载时的实际内容。</p>
<p>获取方式： 通过用户体验监控工具、<code>Web Vitals</code> 库或<code>Chrome User Experience Report</code> 等方式可以收集数据并分析用户感知到的页面加载速度。</p>
<h4 id="Largest-Contentful-Paint-LCP"><a href="#Largest-Contentful-Paint-LCP" class="headerlink" title="Largest Contentful Paint (LCP)"></a>Largest Contentful Paint (LCP)</h4><p>页面中最大的内容元素（如图片、文本等）被绘制到屏幕上且变得可见的时间点。<code>LCP</code> 是衡量用户认为页面已可交互的重要指标之一，优化 <code>LCP</code> 可提升用户体验和页面加载速度。</p>
<p>获取方式： 通过 <code>Chrome DevTools</code> 的 <code>Performance</code> 面板、<code>Web Vitals</code> 库或 <code>PageSpeed Insights</code> 等工具来获取和分析 <code>LCP</code> 数据。</p>
<p>这些指标参数是小程序性能优化的重要参考，通过监控和优化这些参数，可以提升小程序的性能，提升用户体验。</p>
<h3 id="具体措施"><a href="#具体措施" class="headerlink" title="具体措施"></a>具体措施</h3><h4 id="图片优化"><a href="#图片优化" class="headerlink" title="图片优化"></a>图片优化</h4><p>图片是小程序中常见的资源，但过多或未经优化的图片会增加页面加载时间和用户流量消耗。以下是一些图片优化的实践：</p>
<p><strong>使用适当的图片格式：</strong></p>
<ul>
<li><code>JPEG</code> 格式适合照片和渐变色图片。</li>
<li><code>PNG</code> 格式适合图标和带有透明背景的图片。</li>
<li><code>WebP</code> 格式是一种新的图片格式，具有更好的压缩率和质量，但需要注意兼容性。</li>
</ul>
<p><strong>压缩图片大小：</strong></p>
<ul>
<li>使用工具如 <code>TinyPNG</code>、<code>ImageOptim</code> 等对图片进行压缩，减小图片文件大小。</li>
<li>避免在小程序中直接使用大图，尽量将图片压缩至合适的尺寸。</li>
</ul>
<p><strong>懒加载图片：</strong></p>
<ul>
<li>当页面中存在大量图片时，可以使用懒加载技术，延迟加载图片，减少页面加载时间。</li>
<li>通过小程序的 <code>wx.createIntersectionObserver()</code> 方法监听图片元素是否进入视窗，然后动态加载图片。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 示例：图片懒加载</span></span><br><span class="line"><span class="keyword">const</span> observer = wx.<span class="title function_">createIntersectionObserver</span>();</span><br><span class="line">observer.<span class="title function_">relativeToViewport</span>().<span class="title function_">observe</span>(<span class="string">&#x27;.lazy-img&#x27;</span>, <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (res.<span class="property">intersectionRatio</span> &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> lazyImg = res.<span class="property">dataset</span>.<span class="property">lazyImg</span>;</span><br><span class="line">    <span class="comment">// 加载图片</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">      <span class="attr">imgUrl</span>: lazyImg</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">// 停止观察</span></span><br><span class="line">    observer.<span class="title function_">disconnect</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="数据缓存和请求优化"><a href="#数据缓存和请求优化" class="headerlink" title="数据缓存和请求优化"></a>数据缓存和请求优化</h4><p>小程序中频繁的网络请求会增加用户等待时间和服务器负载，因此优化数据请求和缓存是提升小程序性能的关键。</p>
<p><strong>使用缓存：</strong></p>
<ul>
<li>对于频繁使用的数据，可以使用小程序的本地缓存功能，如 <code>wx.setStorageSync()</code> 和 <code>wx.getStorageSync()</code>，将数据存储在本地缓存中，减少网络请求。</li>
<li>对于需要实时更新的数据，可以设置合适的缓存过期时间，避免数据过期而导致的不一致性。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：数据缓存</span></span><br><span class="line"><span class="keyword">const</span> key = <span class="string">&#x27;userData&#x27;</span>;</span><br><span class="line"><span class="keyword">const</span> data = wx.<span class="title function_">getStorageSync</span>(key);</span><br><span class="line"><span class="keyword">if</span> (data) &#123;</span><br><span class="line">  <span class="comment">// 从缓存中获取数据</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data from cache:&#x27;</span>, data);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="comment">// 发起网络请求获取数据</span></span><br><span class="line">  wx.<span class="title function_">request</span>(&#123;</span><br><span class="line">    <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/user&#x27;</span>,</span><br><span class="line">    <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> userData = res.<span class="property">data</span>;</span><br><span class="line">      <span class="comment">// 将数据存入缓存</span></span><br><span class="line">      wx.<span class="title function_">setStorageSync</span>(key, userData);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data from network:&#x27;</span>, userData);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>合并请求：</strong></p>
<ul>
<li>尽量减少网络请求的次数，可以将多个请求合并为一个请求，减少请求的重复和消耗。</li>
<li>使用小程序的 <code>wx.request()</code> 方法发送请求，并通过 <code>Promise.all()</code> 方法等待所有请求完成。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：合并请求</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>([</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data1&#x27;</span> &#125;),</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data2&#x27;</span> &#125;),</span><br><span class="line">  wx.<span class="title function_">request</span>(&#123; <span class="attr">url</span>: <span class="string">&#x27;https://api.example.com/data3&#x27;</span> &#125;)</span><br><span class="line">]).<span class="title function_">then</span>(<span class="function">(<span class="params">[res1, res2, res3]</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 1:&#x27;</span>, res1.<span class="property">data</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 2:&#x27;</span>, res2.<span class="property">data</span>);</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Data 3:&#x27;</span>, res3.<span class="property">data</span>);</span><br><span class="line">&#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;Error:&#x27;</span>, error);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="页面渲染优化"><a href="#页面渲染优化" class="headerlink" title="页面渲染优化"></a>页面渲染优化</h4><p>页面渲染是影响用户体验的重要因素，优化页面渲染可以提高小程序的性能和流畅度。</p>
<p><strong>使用 WXML 和 WXSS：</strong></p>
<ul>
<li>尽量避免使用复杂的 <code>HTML</code> 和 <code>CSS</code> 样式，可以使用小程序的 <code>WXML</code> 和 <code>WXSS</code> 实现相同的效果，减少页面渲染时间。</li>
<li>避免使用嵌套过深的结构，尽量保持页面结构简洁。</li>
</ul>
<p><strong>减少 DOM 操作：</strong></p>
<ul>
<li>减少在页面渲染过程中对 <code>DOM</code> 的操作，例如频繁的节点添加、删除和更新。</li>
<li>使用小程序的数据绑定功能，在数据变化时自动更新页面，避免手动操作 <code>DOM</code>。</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例：数据绑定</span></span><br><span class="line"><span class="title class_">Page</span>(&#123;</span><br><span class="line">  <span class="attr">data</span>: &#123;</span><br><span class="line">    <span class="attr">userInfo</span>: &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="title function_">onLoad</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 获取用户信息</span></span><br><span class="line">    wx.<span class="title function_">getUserInfo</span>(&#123;</span><br><span class="line">      <span class="attr">success</span>: <span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 更新页面数据</span></span><br><span class="line">        <span class="variable language_">this</span>.<span class="title function_">setData</span>(&#123;</span><br><span class="line">          <span class="attr">userInfo</span>: res.<span class="property">userInfo</span></span><br><span class="line">        &#125;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="代码包体积优化"><a href="#代码包体积优化" class="headerlink" title="代码包体积优化"></a>代码包体积优化</h4><p>当小程序项目过大时，可以将不同功能模块分包加载，按需加载页面和资源，减少初始化时间和页面首次加载时间。</p>
<h5 id="分包策略"><a href="#分包策略" class="headerlink" title="分包策略"></a>分包策略</h5><p>独立分包允许小程序页面独立运行，无需依赖主包或其他分包。当从独立分包页面进入小程序时，用户无需等待主包下载，从而显著提升了启动速度。</p>
<ul>
<li><strong>主包</strong>：包含小程序的初始启动逻辑、基础框架和一些常用页面等内容。用户打开小程序时会首先下载主包。</li>
<li><strong>分包</strong>：除了主包以外的其他代码包，每个分包可以包含若干个页面或组件。分包相对独立于主包运行，可以根据业务逻辑将相关页面或组件划分到不同的分包中。</li>
</ul>
<h5 id="分包异步化"><a href="#分包异步化" class="headerlink" title="分包异步化"></a>分包异步化</h5><p>分包异步化进一步细化了小程序的分包粒度，从页面级别深入到组件甚至文件级别。这使得原本只能放在主包内的部分插件、组件和代码逻辑得以剥离到分包中，并在运行时异步加载。这一技术有效解决了主包过度膨胀的问题，进一步降低了启动时的代码加载量。</p>
<p><strong>app.json 配置：</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;subpackages&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">  <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;root&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pages/goods/&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;goods&quot;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>

<p><strong>动态引入：</strong></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">wx.<span class="title function_">loadSubPackage</span>(&#123;</span><br><span class="line">  <span class="attr">root</span>: <span class="string">&#x27;pages/goods/&#x27;</span>,</span><br><span class="line">  <span class="attr">success</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="comment">// 分包加载成功后的回调</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">fail</span>: <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">    <span class="comment">// 分包加载失败处理</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="分包预下载机制"><a href="#分包预下载机制" class="headerlink" title="分包预下载机制"></a>分包预下载机制</h5><p>尽管分包加载能够提升启动速度，但当用户跳转到分包内页面时，仍需等待分包下载，这可能导致页面切换的延迟。为解决这一问题，需要引入了分包预下载机制。该机制允许小程序在后台预先下载分包，确保用户在首次进入分包页面时无需等待下载，从而提升了页面切换的流畅性。</p>
<p><strong>预下载原理：</strong></p>
<p>分包预下载机制利用小程序框架的预加载能力，在用户打开小程序时提前加载分包资源，使得当用户需要访问对应分包页面时，可以更快地展示内容，减少加载等待时间。</p>
<p>预下载机制通常会在主包的某些关键页面或事件触发时开始执行，提前下载分包所需的资源文件，如 <code>JS</code>、<code>CSS</code>、图片等。</p>
<p><strong>实现步骤：</strong></p>
<ul>
<li><p><code>识别关键页面</code>：需要确定哪些页面是用户经常访问的重要页面，这些页面通常会被定义为关键页面，可以考虑在这些页面触发时启动预下载机制。</p>
</li>
<li><p><code>触发预下载</code>：在合适的时机，例如用户打开小程序时或进入关键页面时，调用相应的预下载函数或方法，开始下载分包资源。</p>
</li>
<li><p><code>资源加载</code>：下载完成后，将分包资源缓存至本地，以便在用户访问分包页面时直接使用已下载的资源，避免重新下载。</p>
</li>
</ul>
<p><strong>实际项目场景：</strong></p>
<ul>
<li><p><code>图片密集页面</code>：对于包含大量图片的分包页面（如相册、产品展示页），通过预下载图片资源可以提高用户体验。</p>
</li>
<li><p><code>复杂交互页面</code>：对于交互复杂的分包页面（如地图、视频播放页），提前加载相关组件和数据能够加快页面展示速度。</p>
</li>
</ul>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>小程序性能优化是一个持续改进的过程，通过合理的设计和优化，可以提高小程序的用户体验和性能表现。本文介绍了一些常见的小程序性能优化实践，包括图片优化、数据缓存和请求优化、页面渲染优化等方面的内容，并提供了详细的示例来说明如何在实际项目中进行优化。希望本文能够帮助开发者更好地优化自己的小程序项目，提升用户满意度和使用体验。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/miniprogram/" rel="tag">miniprogram</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/optimize/" rel="tag">optimize</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/10/optimize-miniprogram/" data-id="clw71kuud0010qqoqbmob2n19" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-action-docker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/08/github-action-docker/" class="article-date">
  <time datetime="2024-04-08T13:38:20.000Z" itemprop="datePublished">2024-04-08</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/08/github-action-docker/">使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-GitHub-Actions-自动化部署-Nuxt3-应用到-Docker-容器中"><a href="#使用-GitHub-Actions-自动化部署-Nuxt3-应用到-Docker-容器中" class="headerlink" title="使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中"></a>使用 GitHub Actions 自动化部署 Nuxt3 应用到 Docker 容器中</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><p>在当今的软件开发中，自动化部署是提高生产效率和保证代码质量的关键步骤之一。<code>GitHub Actions</code> 是一个强大的持续集成和持续部署工具，而 <code>Docker</code> 则提供了一种轻量级、可移植的容器化解决方案。本文将介绍如何结合 <code>GitHub Actions</code> 和 <code>Docker</code>，自动化部署一个基于 <code>Nuxt.js 3</code> 的应用到 <code>Docker</code> 容器中。</p>
<h3 id="前提条件"><a href="#前提条件" class="headerlink" title="前提条件"></a>前提条件</h3><p>在开始之前，请确保您已经具备以下环境和工具：</p>
<ul>
<li>一个 <code>GitHub</code> 账号，并且在该账号下创建了一个仓库用于存放您的 <code>Nuxt.js 3</code> 项目。</li>
<li>一个 <code>Docker Hub</code> 账号，用于存放您的 <code>Docker</code> 镜像。</li>
<li>安装了 <code>Docker</code> 和 <code>Docker Compose</code> 的开发环境。</li>
</ul>
<h4 id="步骤一：准备-Nuxt-js-3-项目"><a href="#步骤一：准备-Nuxt-js-3-项目" class="headerlink" title="步骤一：准备 Nuxt.js 3 项目"></a>步骤一：准备 Nuxt.js 3 项目</h4><p>首先，您需要有一个基于 <code>Nuxt.js 3</code> 的项目。如果还没有，可以通过以下命令创建一个新的 <code>Nuxt.js 3</code> 项目：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Copy code</span><br><span class="line">npx create-nuxt-app@latest my-nuxt-app</span><br></pre></td></tr></table></figure>

<p>按照提示选择项目配置，然后进入项目目录。</p>
<h4 id="步骤二：编写-Dockerfile"><a href="#步骤二：编写-Dockerfile" class="headerlink" title="步骤二：编写 Dockerfile"></a>步骤二：编写 Dockerfile</h4><p>接下来，我们需要创建一个 <code>Dockerfile</code> 文件，用于构建 <code>Docker</code> 镜像。在项目根目录下创建一个名为 <code>Dockerfile</code> 的文件，并添加以下内容：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用 Node 18 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> node:<span class="number">18</span> AS builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置工作目录</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> /app</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 package.json 和 package-lock.json 到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> package*.json ./</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装依赖</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝源代码到工作目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> . .</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 构建应用</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> npm run build</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 使用 Nginx 作为基础镜像</span></span><br><span class="line"><span class="keyword">FROM</span> nginx:alpine</span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 Nuxt.js 应用到 Nginx 静态文件目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=builder /app/dist /usr/share/nginx/html</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 暴露 80 端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动 Nginx</span></span><br><span class="line"><span class="keyword">CMD</span><span class="language-bash"> [<span class="string">&quot;nginx&quot;</span>, <span class="string">&quot;-g&quot;</span>, <span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<p>该 <code>Dockerfile</code> 文件中定义了两个阶段的构建过程。第一阶段使用 <code>Node 14</code> 作为基础镜像，用于构建 <code>Nuxt.js</code> 应用；第二阶段使用 <code>Nginx</code> 作为基础镜像，用于运行 <code>Nuxt.js</code> 应用。</p>
<h3 id="步骤三：编写-Docker-Compose-文件"><a href="#步骤三：编写-Docker-Compose-文件" class="headerlink" title="步骤三：编写 Docker Compose 文件"></a>步骤三：编写 <code>Docker Compose</code> 文件</h3><p>为了简化 <code>Docker</code> 容器的管理，我们可以使用 <code>Docker Compose</code> 来定义和运行多个容器。在项目根目录下创建一个名为 <code>docker-compose.yml</code> 的文件，并添加以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">app:</span></span><br><span class="line">    <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&#x27;3000:80&#x27;</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NODE_ENV=production</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>

<p>该 <code>Docker Compose</code> 文件定义了一个名为 <code>app</code> 的服务，使用了刚才编写的 <code>Dockerfile</code> 来构建镜像，并将容器的 <code>80</code> 端口映射到宿主机的 <code>3000</code> 端口。另外，设置了 NODE_ENV 环境变量为 <code>production</code>，并且设置容器始终在退出时重新启动。</p>
<h4 id="步骤四：配置-GitHub-Actions"><a href="#步骤四：配置-GitHub-Actions" class="headerlink" title="步骤四：配置 GitHub Actions"></a>步骤四：配置 GitHub Actions</h4><p>接下来，我们将配置 <code>GitHub Actions</code>，使其在每次推送代码到仓库时自动构建并部署应用到 <code>Docker</code> 容器中。</p>
<p>在项目根目录下创建一个名为 <code>.github/workflows</code> 的目录，并在该目录下创建一个名为 <code>deploy.yml</code> 的文件，并添加以下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">Docker</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">repository</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Set</span> <span class="string">up</span> <span class="string">Docker</span> <span class="string">Buildx</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/setup-buildx-action@v1</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Log</span> <span class="string">in</span> <span class="string">to</span> <span class="string">Docker</span> <span class="string">Hub</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/login-action@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_USERNAME</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_PASSWORD</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span> <span class="string">and</span> <span class="string">push</span> <span class="string">Docker</span> <span class="string">image</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">docker/build-push-action@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">context:</span> <span class="string">.</span></span><br><span class="line">          <span class="attr">file:</span> <span class="string">./Dockerfile</span></span><br><span class="line">          <span class="attr">push:</span> <span class="literal">true</span></span><br><span class="line">          <span class="attr">tags:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.DOCKER_USERNAME</span> <span class="string">&#125;&#125;/my-nuxt-app:latest</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">to</span> <span class="string">Docker</span> <span class="string">Compose</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">appleboy/ssh-action@master</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">host:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_HOST</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_USERNAME</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.SSH_PRIVATE_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">script:</span> <span class="string">docker-compose</span> <span class="string">pull</span> <span class="string">&amp;&amp;</span> <span class="string">docker-compose</span> <span class="string">up</span> <span class="string">-d</span></span><br></pre></td></tr></table></figure>

<p>该 <code>GitHub Actions</code> 配置文件定义了一个名为 <code>Deploy to Docker</code> 的工作流，在代码推送到 <code>master</code> 分支时触发。它包含了以下几个步骤：</p>
<ul>
<li>检出仓库代码。</li>
<li>设置 <code>Docker Buildx</code>，以便支持多平台构建。</li>
<li>登录到 <code>Docker Hub</code>。</li>
<li>构建并推送 <code>Docker</code> 镜像到 <code>Docker Hub</code>。</li>
<li>使用 <code>SSH</code> 连接到部署目标主机，并执行 <code>docker-compose pull</code> 和 <code>docker-compose up -d</code> 命令来更新容器。</li>
</ul>
<h4 id="步骤五：配置-Secrets"><a href="#步骤五：配置-Secrets" class="headerlink" title="步骤五：配置 Secrets"></a>步骤五：配置 Secrets</h4><p>为了安全地管理敏感信息，如 <code>Docker Hub</code> 和部署目标主机的凭据，我们需要在 <code>GitHub</code> 仓库的 <code>Settings -&gt; Secrets</code> 页面中添加这些凭据。</p>
<p>添加以下凭据：</p>
<ul>
<li><strong>DOCKER_USERNAME</strong>: 您的 <code>Docker Hub</code> 用户名。</li>
<li><strong>DOCKER_PASSWORD</strong>: 您的 <code>Docker Hub</code> 密码或访问令牌。</li>
<li><strong>SSH_HOST</strong>: 部署目标主机的 <code>IP</code> 地址或域名。</li>
<li><strong>SSH_USERNAME</strong>: 部署目标主机的用户名。</li>
<li><strong>SSH_PRIVATE_KEY</strong>: <code>SSH</code> 私钥，用于与部署目标主机建立安全连接。</li>
</ul>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>通过结合 <code>GitHub Actions</code>、<code>Docker</code> 和 <code>Docker Compose</code>，我们成功实现了一个自动化部署流程，可以在每次代码更新时自动构建并部署 <code>Nuxt.js 3</code> 应用到 <code>Docker</code> 容器中。这种自动化流程可以大大提高开发团队的生产效率，并且确保了部署的一致性和可靠性。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/docker/" rel="tag">docker</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/08/github-action-docker/" data-id="clw71kuu2000cqqoqer0j02ha" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
    <article id="post-github-action-publish-package" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <h3 href="/2024/04/06/github-action-publish-package/" class="article-date">
  <time datetime="2024-04-06T20:22:20.000Z" itemprop="datePublished">2024-04-06</time>
</h3>
    
  </div>
  <div class="article-inner">
  <div class="curve-down">
  <div class="fill-content fill-content-true">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2024/04/06/github-action-publish-package/">使用 GitHub Action 实现自动化发布 npm 包</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <h2 id="使用-GitHub-Action-实现自动化发布-npm-包"><a href="#使用-GitHub-Action-实现自动化发布-npm-包" class="headerlink" title="使用 GitHub Action 实现自动化发布 npm 包"></a>使用 GitHub Action 实现自动化发布 npm 包</h2><p>在开发 <code>JavaScript</code> 应用程序或库时，发布到 <code>npm</code> 上是一种常见的方式来分享和分发你的代码。手动发布 <code>npm</code> 包可能会变得繁琐和容易出错，因此自动化这个过程是非常有帮助的。</p>
<p><code>GitHub Actions</code> 是一个功能强大的工具，它可以帮助你实现自动化发布 <code>npm</code> 包的流程。在本文中，我们将学习如何使用 <code>GitHub Action</code> 实现自动化发布 <code>npm</code> 包的步骤。</p>
<h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol>
<li>确保你有一个 <a href="https://www.npmjs.com/"><code>npm</code> 账号</a>，并且已经登录到 <code>npm</code>。</li>
<li>创建一个 <code>GitHub</code> 仓库用于存储你的 <code>npm</code> 包的代码。</li>
</ol>
<h3 id="设置-GitHub-Action"><a href="#设置-GitHub-Action" class="headerlink" title="设置 GitHub Action"></a>设置 GitHub Action</h3><ol>
<li>在你的 GitHub 仓库中，创建一个名为 <code>.github/workflows/npm-publish.yml</code> 的文件，用于存储 GitHub Action 的配置。</li>
<li>在 <code>npm-publish.yml</code> 中添加以下内容：</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Publish</span> <span class="string">to</span> <span class="string">npm</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="comment"># 触发ci/cd的代码分支</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="comment"># 指定操作系统</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="comment"># 将代码拉到虚拟机</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">获取源码</span> <span class="string">🛎️</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">      <span class="comment"># 指定node版本</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Node环境版本</span> <span class="string">🗜️</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="number">18</span></span><br><span class="line">          <span class="attr">registry-url:</span> <span class="string">&#x27;https://registry.npmjs.org&#x27;</span></span><br><span class="line">      <span class="comment"># 依赖缓存策略</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Npm缓存</span> <span class="string">📁</span></span><br><span class="line">        <span class="attr">id:</span> <span class="string">cache-dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            **/node_modules</span></span><br><span class="line"><span class="string"></span>          <span class="attr">key:</span> <span class="string">$&#123;&#123;runner.OS&#125;&#125;-$&#123;&#123;hashFiles(&#x27;**/package-lock.json&#x27;)&#125;&#125;</span></span><br><span class="line">      <span class="comment"># 依赖下载</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">安装依赖</span> <span class="string">📦</span></span><br><span class="line">        <span class="attr">if:</span> <span class="string">steps.cache-dependencies.outputs.cache-hit</span> <span class="type">!=</span> <span class="string">&#x27;true&#x27;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="comment"># 打包</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">打包</span> <span class="string">🏗️</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="comment"># 测试</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">测试</span> <span class="string">💣</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">test</span></span><br><span class="line">      <span class="comment"># 发布</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">发布</span> <span class="string">🚀</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">publish</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">NPM_TOKEN:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.NPM_TOKEN</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="申请-npm-访问令牌"><a href="#申请-npm-访问令牌" class="headerlink" title="申请 npm 访问令牌"></a>申请 npm 访问令牌</h3><ol>
<li>登录 <code>npm</code> 官网，登录成功后，点开右上角头像，并点击 <code>Access Tokens</code> 选项。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/2b9ae517-3e57-417a-a00d-d9721a25c4c1" alt="image"></p>
<ol start="2">
<li>点开 <code>Generate New Token</code> 下拉框，点击 <code>Classic Token</code> 选项。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/b7bdbfd5-4a5f-483c-a795-08bb29d8f35e" alt="image"></p>
<ol start="3">
<li>创建一个名称为 <code>GITHUB_PUBLISH_TOKEN</code> 的令牌，并选择 <code>publish 发布</code>权限。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/922f2bca-5b37-4863-acd4-121e75e4388a" alt="image"></p>
<ol start="4">
<li>复制新生成的访问令牌。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/0eef68e5-8adf-483e-90dc-94ac12a45db9" alt="image"></p>
<h3 id="配置-npm-访问令牌"><a href="#配置-npm-访问令牌" class="headerlink" title="配置 npm 访问令牌"></a>配置 npm 访问令牌</h3><ol>
<li>进入项目仓库，点击仓库tab选项卡的 <code>Settings</code> ，点开 <code>Secrets and variables</code> 选项卡，点击 <code>Actions</code> 选项，点击对应页面的 <code>&quot;New repository secret&quot;</code> 按钮。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/6d4b0fd4-5f03-4ffc-a464-115a66ebfdcd" alt="image"></p>
<ol start="2">
<li>新建名称为 <code>NPM_TOKEN</code>的 <code>secret</code>, 并将刚刚申请到的<code>GITHUB_PUBLISH_TOKEN</code>填入 <code>secret</code> 字段。</li>
</ol>
<p><img src="https://github.com/hankliu62/hankliu62.github.com/assets/8088864/09de4a85-e1b9-4a10-98e5-1cf8bf2aec9e" alt="image"></p>
<h3 id="发布-npm-包"><a href="#发布-npm-包" class="headerlink" title="发布 npm 包"></a>发布 npm 包</h3><ol>
<li>在你的代码中做任何更改。</li>
<li>提交这些更改并创建一个新的 <code>Release</code>。</li>
<li><code>GitHub Action</code> 将自动触发并自动构建、测试和发布你的 <code>npm</code> 包。</li>
</ol>
<p>通过以上步骤，你已经成功地设置了 <code>GitHub Action</code> 来实现自动化发布 <code>npm</code> 包的流程。现在，每当你创建一个新的 <code>Release</code>，你的代码将自动发布到 <code>npm</code> 上，让你的开发流程更加高效和方便。</p>

      
    </div>
    <footer class="article-footer">
      <div class="article-footer-content">
        
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/blog/" rel="tag">blog</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/git/" rel="tag">git</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/github/" rel="tag">github</a></li></ul>

        <a data-url="https://hankliu62.github.io/2024/04/06/github-action-publish-package/" data-id="clw71kuu3000eqqoq460r4pec" class="article-share-link">Share</a>
        
      </div>
    </footer>
  </div>
  </div>
  </div>
  
</article>



  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  
</section>
      
      <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/05/12/typescript-config/">TypeScript 配置详解</a>
          </li>
        
          <li>
            <a href="/2024/05/02/github-action-auto-git-tag/">使用 GitHub Actions 自动推送 Git Tag</a>
          </li>
        
          <li>
            <a href="/2024/04/24/react-fiber-struct/">浅入解析 React Fiber 结构</a>
          </li>
        
          <li>
            <a href="/2024/04/20/communication-across-browser-tabs/">跨浏览器标签页进行通讯的方式简介</a>
          </li>
        
          <li>
            <a href="/2024/04/16/webrtc/">WebRTC:实时通信的未来</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/blog/" rel="tag">blog</a><span class="tag-list-count">12</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/canvas/" rel="tag">canvas</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/csrf/" rel="tag">csrf</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/css/" rel="tag">css</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/debugging/" rel="tag">debugging</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/docker/" rel="tag">docker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/git/" rel="tag">git</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github/" rel="tag">github</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/github-pages/" rel="tag">github pages</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/hexo/" rel="tag">hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/homebrew/" rel="tag">homebrew</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html/" rel="tag">html</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/html5/" rel="tag">html5</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/interview/" rel="tag">interview</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/javascript/" rel="tag">javascript</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/loader/" rel="tag">loader</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/miniprogram/" rel="tag">miniprogram</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/mobile/" rel="tag">mobile</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/network/" rel="tag">network</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/nginx/" rel="tag">nginx</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/optimize/" rel="tag">optimize</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/react/" rel="tag">react</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/reptile/" rel="tag">reptile</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/security/" rel="tag">security</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/service-worker/" rel="tag">service worker</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shell/" rel="tag">shell</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sql/" rel="tag">sql</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/tag/" rel="tag">tag</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/translate/" rel="tag">translate</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/typeScript/" rel="tag">typeScript</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ubuntu/" rel="tag">ubuntu</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vitepress/" rel="tag">vitepress</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webpack/" rel="tag">webpack</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webrtc/" rel="tag">webrtc</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/webworker/" rel="tag">webworker</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/weinre/" rel="tag">weinre</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/xss/" rel="tag">xss</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/yuv/" rel="tag">yuv</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">五月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/04/">四月 2024</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/03/">三月 2024</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">二月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">一月 2024</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">十二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/02/">二月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">一月 2023</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">十二月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">七月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">四月 2022</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">十二月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">九月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">三月 2021</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">十二月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">五月 2019</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">十一月 2018</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">九月 2017</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">十二月 2015</a><span class="archive-list-count">3</span></li></ul>
    </div>
  </div>

  
</aside>
      
    </div>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2024 HankLiu, Inc. All rights reserved.<br>
    </div>
  </div>
</footer>
  </div>
  <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">主页</a>
  
    <a href="/archives" class="mobile-nav-link">文章</a>
  
    <a href="/toolkit" class="mobile-nav-link">小工具</a>
  
    <a href="/resume" class="mobile-nav-link">小简介</a>
  
    <a href="/about" class="mobile-nav-link">小关于</a>
  
  <a href="#search" class="mobile-nav-link st-search-show-outputs">Search</a>
</nav>
  

<!-- totop start -->
<div id="totop">
	<a title="To Top"></a>
</div>
<!-- totop end -->

<!-- swiftype search start -->

<!-- swiftype search end -->



<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/lrsjng.jquery-qrcode/0.12.0/jquery.qrcode.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>


</div>
</body>
</html>
